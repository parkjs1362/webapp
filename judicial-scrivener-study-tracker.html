<!DOCTYPE html>
<html lang="ko">
<!--
    ?쒗뿕 ?꾨왂???숈뒿 ?쒖뒪??    Version: 2.6.0
    Last Updated: 2025-10-16

    Changes in v2.6.0 - UX Improvements & Feature Updates:
    - FEATURE: Added manual subject time editing functionality
      * Click edit button (?륅툘) next to each subject in time chart to manually adjust hours
      * Manual time data stored separately and persists across sessions
      * Clear visual indicator showing manually edited subjects
      * Edit modal with current time display and validation
    - UI CLEANUP: Removed "吏묒쨷 ?꾩슂 怨쇰ぉ" (Weak Subjects) section
      * Simplified dashboard by removing redundant priority indicators
      * Users can assess subject priority through progress charts directly
    - UI CLEANUP: Removed "?ㅻ뒛???숈뒿 異붿쿇" (Smart Recommendations) section
      * Streamlined interface by removing auto-generated suggestions
      * Focus on user-driven study planning through time blocks and goals
    - ENHANCEMENT: Improved D-day date text visibility
      * Increased font size from 0.85rem to 1.1rem (29% larger)
      * Increased opacity from 0.85 to 1.0 for better contrast
      * Added semi-bold weight (600) for improved readability
      * Better visibility in both light and dark modes
    - ENHANCEMENT: Improved dynamic chart scaling
      * Charts now scale based on actual maximum value in dataset
      * Added visual max value indicator at top of charts
      * Minimum bar height ensures small values remain visible
      * Better proportional representation of data differences

    Changes in v2.5.3 - CRITICAL BUG FIXES:
    - CRITICAL FIX: Chart bars now properly visible with fallback colors and better initialization
      * Added fallback hex colors for gradient backgrounds to ensure cross-browser compatibility
      * Fixed bar height initialization to ensure bars are immediately visible
      * Added debug logging to track chart rendering issues
      * Enhanced error handling in chart rendering functions
    - CRITICAL FIX: Exam type switching (1李?2李? now properly syncs ALL dashboard components
      * Fixed setExamType() to update analytics charts (subject time, mock scores)
      * Fixed weak subjects list to update when switching exam types
      * Fixed smart recommendations to reflect current exam type
      * Fixed streak stats and all metrics to sync with selected exam
    - ACCESSIBILITY IMPROVEMENTS:
      * Enhanced focus indicators with 3px solid outline for better visibility
      * Improved color contrast ratios to meet WCAG AA standards (4.5:1 minimum)
      * Added visible focus states for all interactive elements
      * Ensured all touch targets meet 44x44px minimum requirement
    - CHART USABILITY ENHANCEMENTS:
      * Added percentage display alongside hours in tooltips
      * Improved bar scaling for better readability of small values
      * Enhanced visual hierarchy with clearer labels
      * Better responsive behavior on mobile devices

    Changes in v2.5.2 - Font & Chart Visualization Improvements:
    - Changed font to Noto Sans KR from Google Fonts for better Korean readability
    - CRITICAL: Fixed chart visibility issues in analytics dashboard
      * Added minimum height (20px) for small data values to ensure all bars are visible
      * Increased chart height from 200px to 240px for better clarity
      * Added grid lines at 25% intervals for easier reading
      * Improved bar value label positioning (centered on bar, above for small bars)
      * Added 3-tier color coding for mock exam scores (green 60+, orange 40-59, red <40)
      * Implemented trend indicators showing score changes
      * Added sequential animations with stagger timing (50ms for subjects, 80ms for scores)
      * Enhanced tooltips with full subject names on hover
    - Created comprehensive USER_GUIDE.md documentation with detailed logic explanations
    - Improved chart accessibility with better contrast and text shadows
    - Enhanced gradient colors for better visual differentiation
    - Fixed empty state messages for charts when no data is available


    Changes in v2.5.1 - Analytics Enhancement, Dark Mode & UX Improvements:
    Changes in v2.5.1 - Dark Mode Critical Fix:
    - CRITICAL FIX: Added missing body selector that was breaking entire CSS cascade
    - Fixed dark mode by replacing all hardcoded white backgrounds with CSS variables
    - Added --success-bg and --error-bg variables for state-based backgrounds
    - Replaced hardcoded hex colors (#E6FFFA, #FFF5F5) with dark mode compatible variables
    - Added overlay variables for semi-transparent backgrounds
    - All UI components now properly respond to dark mode toggle
    - Dark mode toggle button fully functional with persistent state

    - CRITICAL: Fixed analytics dashboard to use REAL user data instead of sample data
      * Subject time distribution now calculates from actual time blocks, timer, and progress
      * Mock exam score chart displays real user scores, not hardcoded samples
      * All metrics (total hours, daily average, overall progress) based on actual data
    - Implemented complete DARK MODE with smooth transitions
      * Toggle switch in header with moon/sun icon
      * Dark color palette with proper contrast ratios
      * Saved to localStorage with auto-load on page load
      * All components styled for dark mode (cards, modals, buttons, charts)
    - Enhanced subject focus logic ("吏묒쨷 ?꾩슂 怨쇰ぉ")
      * Priority based on progress percentage, rotation count, and mock exam performance
      * Clear visual indicators (red/orange/yellow badges)
      * Sorted by actual priority (lowest progress first)
      * Shows success message when all subjects on track
    - Added professional SVG-based favicon (book with checkmark icon)
    - Updated all "踰뺣Т?? references to "?쒗뿕" for generic exam tracking
    - Improved chart visualizations with better animations and responsiveness
    - Enhanced real-time analytics updates when user adds data
    - Better error handling and edge case management
    - Optimized performance for chart rendering

Changes in v2.4.0 - Professional Design System & Data Management (ACTUAL IMPLEMENTATION):
    - CRITICAL: Added comprehensive Import/Export functionality for all study data
      * Export data to JSON file (study-data-YYYY-MM-DD.json)
      * Import data with validation and preview modal
      * Automatic backup to session storage before import
      * Comprehensive error handling and recovery
    - Implemented dedicated Data Management section with gradient card design
    - Enhanced CSS design system with complete color palette and spacing variables
    - Added import preview modal with detailed data statistics
    - Improved button system with glassmorphism effects for data management
    - Enhanced mobile responsiveness with 56px/60px touch targets for data buttons
    - Added loading states and smooth animations for import/export operations
    - Implemented professional typography scale and spacing system
    - Enhanced accessibility with better focus states and ARIA labels
    - Added comprehensive data validation and error handling
    - Improved visual hierarchy with gradient backgrounds for data management
    - Better user feedback with toast notifications for all operations

    Changes in v2.3.0 - UX/UI Major Upgrade:
    - CRITICAL: Completely replaced all alert()/prompt()/confirm() with modern modal dialogs
    - Added separate D-day counters for both 1李?and 2李?exams with editable dates
    - Implemented visual urgency indicators (color changes as exam approaches)
    - Added comprehensive toast notification system (non-blocking, auto-dismiss)
    - Modal-based editing for ALL operations (subject progress, time blocks, mock scores, goals)
    - All edit forms now show multiple fields in ONE modal (no more sequential prompts)
    - Enhanced keyboard shortcuts (ESC to close modals, better accessibility)
    - Improved mobile responsiveness with better touch targets
    - Added form validation with clear error messages
    - Better visual feedback for all user actions
    - Removed redundant Pomodoro timer (regular timer serves same purpose)
    - Improved loading states and error handling throughout

    Changes in v2.2.0:
    - Added Pomodoro timer (25min work / 5min break) with visual & audio notifications
    - Enhanced time block completion to use actual hours instead of hardcoded 2 hours
    - Added customizable target problem count per subject
    - Added hours field to time blocks for accurate time tracking
    - Corrected 2李?exam subjects based on official 踰뺣Т??exam structure
    - Removed study mode selector (吏곸옣???꾩뾽/二쇰쭚?꾩궗 modes)
    - Improved UX with better time tracking and progress customization

    Changes in v2.1.0:
    - Added comprehensive Study Analytics Dashboard with visual charts
    - Added Goal Setting & Milestone tracking system
    - Added Weak Subject Identifier with priority recommendations
    - Added Study Streak Tracker with gamification elements
    - Added Smart Study Recommendations based on patterns
    - Enhanced UI with collapsible sections and improved data visualization

    Changes in v2.0.0:
    - Added support for 2李?(secondary) exam subjects
    - Fixed subject progress editing functionality
    - Fixed mock exam score delete functionality (always visible now)
    - Fixed study strategy (time blocks) edit/delete functionality
    - Improved event handlers to use proper onclick bindings
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>?쒗뿕 ?꾨왂???숈뒿 ?쒖뒪??(1李?2李? v2.5.3</title>
    <!-- Favicon: Book with checkmark icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='15' width='60' height='70' rx='3' fill='%233182CE'/%3E%3Cpath d='M25 20h50v60H25z' fill='%23fff'/%3E%3Cpath d='M30 30h40M30 40h35M30 50h40M30 60h30' stroke='%233182CE' stroke-width='2' fill='none'/%3E%3Ccircle cx='75' cy='75' r='18' fill='%2348BB78'/%3E%3Cpath d='M67 75l6 6 12-12' stroke='%23fff' stroke-width='3' fill='none'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='15' width='60' height='70' rx='3' fill='%233182CE'/%3E%3Cpath d='M25 20h50v60H25z' fill='%23fff'/%3E%3Cpath d='M30 30h40M30 40h35M30 50h40M30 60h30' stroke='%233182CE' stroke-width='2' fill='none'/%3E%3Ccircle cx='75' cy='75' r='18' fill='%2348BB78'/%3E%3Cpath d='M67 75l6 6 12-12' stroke='%23fff' stroke-width='3' fill='none'/%3E%3C/svg%3E">
    <!-- Google Fonts - Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Accessibility - Universal Focus Styles */
        *:focus-visible {
            outline: 3px solid var(--accent-color, #3182CE);
            outline-offset: 2px;
        }

        /* Ensure high contrast for focus in dark mode */
        [data-theme="dark"] *:focus-visible {
            outline-color: var(--accent-light, #63B3ED);
        }

        /* Remove default focus outline (we use focus-visible instead) */
        *:focus:not(:focus-visible) {
            outline: none;
        }

        :root {
            /* Color Palette */
            --primary-color: #4A5568;
            --primary-dark: #2D3748;
            --primary-light: #718096;
            --accent-color: #3182CE;
            --accent-dark: #2C5AA0;
            --accent-light: #63B3ED;
            --success-color: #48BB78;
            --success-dark: #38A169;
            --success-light: #9AE6B4;
            --warning-color: #F6AD55;
            --warning-dark: #DD6B20;
            --warning-light: #FBD38D;
            --danger-color: #F56565;
            --danger-dark: #E53E3E;
            --danger-light: #FC8181;
            --info-color: #4299E1;

            --success-bg: #E6FFFA;
            --error-bg: #FFF5F5;
            --overlay-light: rgba(255, 255, 255, 0.8);
            --overlay-medium: rgba(255, 255, 255, 0.5);
            /* Background Colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F7FAFC;
            --bg-tertiary: #EDF2F7;
            --bg-light: #F7FAFC;
            --bg-dark: #1A202C;

            /* Text Colors */
            --text-primary: #1A202C;
            --text-secondary: #718096;
            --text-tertiary: #A0AEC0;
            --text-light: #FFFFFF;

            /* Border & Shadow */
            --border-color: #E2E8F0;
            --border-light: #F7FAFC;
            --border-dark: #CBD5E0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.12);

            /* Spacing Scale */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --spacing-3xl: 64px;

            /* Typography Scale */
            --font-size-xs: 0.75rem;    /* 12px */
            --font-size-sm: 0.875rem;   /* 14px */
            --font-size-base: 1rem;      /* 16px */
            --font-size-lg: 1.125rem;    /* 18px */
            --font-size-xl: 1.25rem;     /* 20px */
            --font-size-2xl: 1.5rem;     /* 24px */
            --font-size-3xl: 1.875rem;   /* 30px */
            --font-size-4xl: 2.25rem;    /* 36px */
            --font-size-5xl: 3rem;       /* 48px */

            /* Line Heights */
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 150ms;
            --transition-base: 250ms;
            --transition-slow: 350ms;

            /* Z-index Scale */
            --z-base: 1;
            --z-dropdown: 100;
            --z-sticky: 200;
            --z-modal: 1000;
            --z-toast: 2000;
            --z-tooltip: 3000;

            /* Legacy support (maintain backwards compatibility) */
            --primary: var(--primary-color);
            --accent: var(--accent-color);
            --success: var(--success-color);
            --warning: var(--warning-color);
            --danger: var(--danger-color);
            --text-primary: var(--text-primary);
            --text-secondary: var(--text-secondary);
            --border: var(--border-color);
        }

        /* Dark Mode Color Palette */
        [data-theme="dark"] {
            /* Dark Background Colors */
            --bg-primary: #1A1A1A;
            --bg-secondary: #2D2D2D;
            --bg-tertiary: #3A3A3A;
            --bg-light: #2D2D2D;
            --bg-dark: #0A0A0A;

            /* Dark Text Colors */
            --text-primary: #E5E5E5;
            --text-secondary: #A0A0A0;
            --text-tertiary: #707070;
            --text-light: #FFFFFF;

            /* Dark Border & Shadow */
            --border-color: #404040;
            --border-light: #3A3A3A;
            --border-dark: #505050;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.5);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.6);

            /* Adjusted colors for dark mode */
            --primary-color: #6B7280;
            --primary-dark: #E5E5E5;
            --accent-color: #60A5FA;
            --success-color: #34D399;
            --warning-color: #FBBF24;
            --danger-color: #F87171;
            --success-bg: #1A3A2F;
            --error-bg: #3A1A1A;
            --overlay-light: rgba(0, 0, 0, 0.4);
            --overlay-medium: rgba(0, 0, 0, 0.6);
        }

        /* Dark mode transitions */
        body, .card, .modal-content, .time-block, .subject-rotation,
        .score-entry, .goal-item, .weak-subject, .form-input, .form-select {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Dark mode toggle button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: var(--accent-color);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-xl);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ?ㅻ뜑 ?ㅽ???*/
        .header {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .d-day-badge {
            background: var(--danger);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .study-mode-selector {
            display: flex;
            gap: 10px;
            background: var(--bg-light);
            padding: 5px;
            border-radius: 8px;
        }
        
        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .mode-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* ??쒕낫??洹몃━??*/
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg-light);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            background: var(--accent);
            color: white;
        }

        .action-btn:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        .action-btn.edit:hover {
            background: var(--warning);
        }

        .action-btn.edit:focus {
            outline: 3px solid var(--warning-color);
            outline-offset: 2px;
        }

        .action-btn.delete:hover {
            background: var(--danger);
        }

        .action-btn.delete:focus {
            outline: 3px solid var(--danger-color);
            outline-offset: 2px;
        }
        
        /* ?ㅻ뒛???숈뒿 怨꾪쉷 */
        .today-plan {
            grid-column: span 2;
        }
        
        .time-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .time-block {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            transition: all 0.3s;
            position: relative;
        }
        
        .time-block.completed {
            background: var(--success-bg);
            border-left-color: var(--success);
        }
        
        .time-block:hover {
            transform: translateX(5px);
        }
        
        .time-block-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .time-block-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: var(--overlay-light);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s;
        }
        
        .time-block-btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .time-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .time-subject {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .time-detail {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .check-btn {
            margin-top: 10px;
            padding: 6px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .check-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .check-btn.checked {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* ?щえ?꾨줈 ??대㉧ */
        .pomodoro-display {
            text-align: center;
            padding: 20px 0;
        }

        .pomodoro-mode {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .pomodoro-mode.break {
            color: var(--success);
        }

        .pomodoro-mode.work {
            color: var(--danger);
        }

        .pomodoro-session-count {
            margin-top: 15px;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .pomodoro-session-count span {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.2rem;
        }

        /* 湲곗텧臾몄젣 ?뚮룆 ?몃옒而?*/
        .rotation-tracker {
            margin-top: 15px;
        }
        
        .subject-rotation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .subject-name {
            font-weight: 600;
            flex: 1;
            cursor: pointer;
        }
        
        .rotation-circles {
            display: flex;
            gap: 8px;
        }
        
        .rotation-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .rotation-circle.completed {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .rotation-circle.current {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* ?숈뒿 ??대㉧ */
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-family: 'SF Mono', monospace;
            color: var(--primary-dark);
        }
        
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .timer-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .timer-btn.start {
            background: var(--success);
            color: white;
        }
        
        .timer-btn.pause {
            background: var(--warning);
            color: white;
        }
        
        .timer-btn.reset {
            background: var(--danger);
            color: white;
        }
        
        .timer-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* 二쇨컙 ?숈뒿 ?듦퀎 */
        .weekly-stats {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .day-stat {
            text-align: center;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .day-stat.today {
            background: var(--accent);
            color: white;
        }
        
        .day-stat.completed {
            background: var(--success);
            color: white;
        }
        
        .day-name {
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .day-hours {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* 怨쇰ぉ蹂?吏꾨룄 */
        .subject-progress {
            margin-top: 15px;
        }
        
        .progress-item {
            margin-bottom: 15px;
            position: relative;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .progress-label {
            font-weight: 600;
        }
        
        .progress-value {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 20px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* 紐⑥쓽怨좎궗 ?먯닔 ?몃옒而?*/
        .mock-scores {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .score-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 8px;
            position: relative;
        }
        
        .score-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .score-value {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            background: var(--bg-primary);
        }
        
        .score-value.pass {
            color: var(--success);
            border: 2px solid var(--success);
        }
        
        .score-value.fail {
            color: var(--danger);
            border: 2px solid var(--danger);
        }
        
        .score-actions {
            position: absolute;
            right: 80px;
            display: flex;
            gap: 5px;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .score-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .score-action-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }
        
        /* 紐⑤떖 ?ㅽ???*/
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal.show {
            display: block;
        }
        
        .modal-content {
            background-color: var(--bg-primary);
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .modal-close {
            width: 30px;
            height: 30px;
            border: none;
            background: var(--bg-light);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .modal-close:hover {
            background: var(--danger);
            color: white;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            background: var(--bg-primary);
            cursor: pointer;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.cancel {
            background: var(--bg-light);
            color: var(--text-primary);
        }
        
        .modal-btn.save {
            background: var(--accent);
            color: white;
        }
        
        .modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* ?명듃 ?뱀뀡 */
        .notes-section {
            margin-top: 20px;
        }
        
        .notes-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .notes-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }
        
        .notes-toolbar {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .notes-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .notes-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        /* 諛섏쓳???붿옄??*/
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .today-plan {
                grid-column: span 1;
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .weekly-stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .time-blocks {
                grid-template-columns: 1fr;
            }
        }
        
        /* ?좎뒪???뚮┝ - Enhanced */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-dark);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 2000;
            animation: slideInToast 0.3s ease;
            min-width: 300px;
            max-width: 500px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--accent);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-message {
            flex: 1;
        }

        @keyframes slideInToast {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutToast {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* D-Day 移대뱶 ?ㅽ???- Enhanced */
        .dday-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .dday-card {
            flex: 1;
            min-width: 250px;
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .dday-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .dday-card.urgent {
            background: linear-gradient(135deg, #F56565 0%, #FC8181 100%);
            color: white;
        }

        .dday-card.warning {
            background: linear-gradient(135deg, #F6AD55 0%, #FBD38D 100%);
            color: white;
        }

        .dday-card.normal {
            background: linear-gradient(135deg, #48BB78 0%, #68D391 100%);
            color: white;
        }

        .dday-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .dday-value {
            font-size: var(--font-size-5xl);
            font-weight: 800;
            margin: var(--spacing-md) 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            letter-spacing: -1px;
        }

        .dday-date {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 1.0;
            margin-top: 8px;
            letter-spacing: 0.3px;
        }

        .dday-edit-btn {
            margin-top: 10px;
            padding: 6px 12px;
            background: var(--overlay-light);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            color: inherit;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .dday-edit-btn:hover {
            background: var(--overlay-light);
            border-color: rgba(255,255,255,0.5);
        }

        /* Import/Export Buttons */
        .data-management {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            margin-top: var(--spacing-lg);
        }

        .btn-primary {
            padding: 12px 24px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 44px;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 44px;
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: var(--font-size-lg);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* ?뺤씤 紐⑤떖 ?ㅽ???*/
        .confirm-modal .modal-content {
            max-width: 400px;
        }

        .confirm-message {
            padding: 20px 0;
            font-size: 1.1rem;
            text-align: center;
            color: var(--text-primary);
        }

        /* ?ㅽ듃由??몃옒而??ㅽ???*/
        .streak-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFD93D 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 15px;
        }

        .streak-number {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .streak-label {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .streak-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .streak-stat-item {
            text-align: center;
        }

        .streak-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .streak-stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* 遺꾩꽍 ??쒕낫???ㅽ???*/
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .analytics-stat {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--accent);
            transition: transform 0.3s;
        }

        .analytics-stat:hover {
            transform: translateY(-3px);
        }

        .analytics-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
        }

        .analytics-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* 李⑦듃 ?ㅽ???- Enhanced for visibility */
        .chart-container {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 240px;
            padding: 10px;
            position: relative;
            background-image:
                linear-gradient(to right, transparent 0%, transparent 100%),
                repeating-linear-gradient(
                    to top,
                    transparent,
                    transparent calc(25% - 1px),
                    var(--border) calc(25% - 1px),
                    var(--border) 25%
                );
            background-size: 100% 100%;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 5px;
            position: relative;
            z-index: 1;
        }

        .bar {
            width: 100%;
            min-height: 30px; /* Increased from 20px for better visibility */
            max-width: 60px;
            min-width: 44px; /* WCAG 2.5.5 touch target minimum */
            /* Fallback colors for cross-browser compatibility */
            background: linear-gradient(to top, #3182CE, #48BB78);
            background: linear-gradient(to top, var(--accent-color, #3182CE), var(--success-color, #48BB78));
            border-radius: 4px 4px 0 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            /* Ensure visibility - critical fixes */
            opacity: 1 !important;
            display: block !important;
            visibility: visible !important;
            outline: none;
            /* Ensure bars are always visible with minimum dimensions */
            flex-shrink: 0;
        }

        .bar:hover {
            opacity: 0.85;
            transform: scaleY(1.05) scaleX(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .bar:focus {
            outline: 3px solid var(--accent-color, #3182CE);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.2), 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .bar-label {
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }

        .bar-value {
            position: absolute;
            top: -45px; /* Increased to accommodate two lines */
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-primary);
            background: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            white-space: normal; /* Allow line breaks */
            pointer-events: none;
            z-index: 10;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            text-align: center;
            line-height: 1.3;
            min-width: 42px; /* Minimum touch target width */
        }

        .bar[data-small="true"] .bar-value {
            /* Same positioning for consistency */
            font-size: 0.7rem;
            padding: 2px 6px;
        }

        /* Chart Controls */
        .chart-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .chart-control-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-right: 5px;
        }

        .chart-control-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            min-width: 44px; /* Touch target */
            min-height: 32px;
        }

        .chart-control-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-1px);
        }

        .chart-control-btn:focus {
            outline: 3px solid var(--accent-light);
            outline-offset: 2px;
        }

        .chart-control-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            box-shadow: var(--shadow-sm);
        }

        /* Chart Tooltip */
        .bar-tooltip {
            position: fixed;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            animation: tooltipFadeIn 0.2s forwards;
            max-width: 250px;
        }

        @keyframes tooltipFadeIn {
            to {
                opacity: 1;
            }
        }

        .bar-tooltip strong {
            display: block;
            margin-bottom: 6px;
            font-size: 0.95rem;
            color: var(--accent-color);
        }

        .bar-tooltip-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            gap: 15px;
        }

        /* Accessibility: Screen reader only text */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* 紐⑺몴 ?ㅼ젙 ?ㅽ???*/
        .goal-item {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--warning);
            transition: all 0.3s;
        }

        .goal-item.achieved {
            border-left-color: var(--success);
            background: var(--success-bg);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-title {
            font-weight: 600;
            flex: 1;
        }

        .goal-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .goal-progress-bar {
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--warning), var(--success));
            transition: width 0.5s ease;
        }

        .goal-actions {
            display: flex;
            gap: 5px;
        }

        .goal-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .goal-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* ?쎌젏 怨쇰ぉ ?ㅽ???*/
        .weak-subject {
            background: var(--error-bg);
            border: 2px solid var(--danger);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .weak-subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .weak-subject-name {
            font-weight: 600;
            color: var(--danger);
            font-size: 1.1rem;
        }

        .priority-badge {
            background: var(--danger);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .weak-subject-info {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .recommendation {
            background: var(--bg-primary);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            border-left: 3px solid var(--warning);
        }

        /* 異붿쿇 ?ы빆 ?ㅽ???*/
        .recommendation-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .recommendation-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            line-height: 1.5;
        }

        .recommendation-list li:before {
            content: '??;
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* ?묒쓣 ???덈뒗 ?뱀뀡 */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .collapse-icon {
            transition: transform 0.3s;
            font-size: 1.2rem;
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        /* ?곗씠??愿由??뱀뀡 */
        .data-management-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-top: var(--spacing-lg);
        }

        .data-management-card .card-title {
            color: white;
        }

        .data-management-section {
            padding: var(--spacing-md) 0;
        }

        .data-management-desc {
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
        }

        .data-management-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .data-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            color: white;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 56px;
        }

        .data-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .data-btn:active {
            transform: translateY(0);
        }

        .data-btn .btn-icon {
            font-size: 1.5rem;
        }

        .data-btn .btn-text {
            font-size: var(--font-size-lg);
        }

        .export-btn:hover {
            background: rgba(72, 187, 120, 0.3);
            border-color: var(--success-light);
        }

        .import-btn:hover {
            background: rgba(66, 153, 225, 0.3);
            border-color: var(--info-color);
        }

        .data-management-info {
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.9);
            line-height: var(--line-height-relaxed);
        }

        .data-management-info small {
            font-size: var(--font-size-sm);
            line-height: 1.8;
        }

        /* Import Preview Modal */
        .import-preview {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            max-height: 300px;
            overflow-y: auto;
        }

        .import-preview-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .import-preview-item:last-child {
            border-bottom: none;
        }

        .import-preview-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .import-preview-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Loading state */
        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid white;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }

        /* Mobile optimizations for data management */
        @media (max-width: 600px) {
            .data-management-actions {
                grid-template-columns: 1fr;
            }

            .data-btn {
                min-height: 60px;
                font-size: var(--font-size-lg);
            }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-md);
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.6;
        }

        .empty-state-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state-description {
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-lg);
            line-height: var(--line-height-relaxed);
        }

        .empty-state-action {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--accent-color);
            color: white;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-base);
            cursor: pointer;
            border: none;
        }

        .empty-state-action:hover {
        
        /* Utility Classes for Inline Styles */
        .motivation-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .error-notice {
            background: var(--error-bg);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--danger-color);
            margin-top: 15px;
        }
        
        .note-preview {
            margin-bottom: 15px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
        }
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Button Consistency */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 44px; /* Touch target size */
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-dark);
        }

        .btn-secondary:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-dark);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: var(--danger-dark);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-sm);
            min-height: 36px;
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-lg);
            min-height: 56px;
        }

        /* Focus states for accessibility */
        .btn:focus-visible,
        .data-btn:focus-visible,
        .action-btn:focus-visible,
        .modal-btn:focus-visible {
            outline: 3px solid var(--accent-light);
            outline-offset: 2px;
        }

        /* Improved Card Shadows */
        .card {
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        /* Loading Spinner for Better Feedback */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spinner 0.6s linear infinite;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .modal-content {
                max-width: 95%;
                margin: 20px auto;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .title {
                font-size: var(--font-size-xl);
            }

            .card-title {
                font-size: var(--font-size-base);
            }

            /* Larger touch targets on mobile */
            .action-btn,
            .rotation-circle,
            .check-btn {
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* Smooth Transitions for Better UX */
        * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Better Visual Hierarchy */
        h1, h2, h3, h4 {
            line-height: var(--line-height-tight);
            font-weight: 700;
        }

        p {
            line-height: var(--line-height-relaxed);
        }
    </style>
</head>
<body>

    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        <span id="theme-icon">?뙔</span>
    </button>

    <div class="container">
        <!-- ?ㅻ뜑 -->
        <div class="header">
            <div class="header-top">
                <h1 class="title">?렞 ?쒗뿕 ?꾨왂???숈뒿 ?쒖뒪??v2.6.0</h1>
            </div>

            <!-- D-Day 移댁슫??(1李?2李? -->
            <div class="dday-container">
                <div class="dday-card" id="dday-1st-card" onclick="editExamDate('1李?)">
                    <div class="dday-label">?뱴 1李??쒗뿕</div>
                    <div class="dday-value" id="dday-1st-value">D-?</div>
                    <div class="dday-date" id="dday-1st-date">?좎쭨 誘몄꽕??/div>
                    <button class="dday-edit-btn" onclick="event.stopPropagation(); editExamDate('1李?)">?좎쭨 ?ㅼ젙</button>
                </div>
                <div class="dday-card" id="dday-2nd-card" onclick="editExamDate('2李?)">
                    <div class="dday-label">?랃툘 2李??쒗뿕</div>
                    <div class="dday-value" id="dday-2nd-value">D-?</div>
                    <div class="dday-date" id="dday-2nd-date">?좎쭨 誘몄꽕??/div>
                    <button class="dday-edit-btn" onclick="event.stopPropagation(); editExamDate('2李?)">?좎쭨 ?ㅼ젙</button>
                </div>
            </div>

            <div class="study-mode-selector">
                <button class="mode-btn" onclick="setExamType('1李?)">1李??쒗뿕</button>
                <button class="mode-btn" onclick="setExamType('2李?)">2李??쒗뿕</button>
            </div>
        </div>
        
        <!-- ?숈뒿 ?ㅽ듃由?(理쒖긽??媛뺤“) -->
        <div class="dashboard-grid">
            <!-- ?숈뒿 ?ㅽ듃由??몃옒而?-->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?뵦 ?숈뒿 ?ㅽ듃由?/h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="resetStreak()">?봽</button>
                    </div>
                </div>
                <div class="streak-display">
                    <div class="streak-label">?꾩옱 ?곗냽 ?숈뒿??/div>
                    <div class="streak-number" id="current-streak">0</div>
                    <div class="streak-label">???곗냽 ?뵦</div>
                    <div class="streak-stats">
                        <div class="streak-stat-item">
                            <div class="streak-stat-value" id="longest-streak">0</div>
                            <div class="streak-stat-label">理쒖옣 湲곕줉</div>
                        </div>
                        <div class="streak-stat-item">
                            <div class="streak-stat-value" id="total-study-days">0</div>
                            <div class="streak-stat-label">珥??숈뒿??/div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ?숈뒿 遺꾩꽍 ??쒕낫??-->
        <div class="card">
            <div class="card-header collapsible-header" onclick="toggleCollapse('analytics-section')">
                <h2 class="card-title">?뱤 ?숈뒿 遺꾩꽍 ??쒕낫??/h2>
                <span class="collapse-icon" id="analytics-icon">??/span>
            </div>
            <div class="collapsible-content" id="analytics-section">
                <div class="analytics-grid">
                    <div class="analytics-stat">
                        <div class="analytics-label">珥??숈뒿 ?쒓컙</div>
                        <div class="analytics-value" id="total-study-hours">0h</div>
                    </div>
                    <div class="analytics-stat">
                        <div class="analytics-label">?쇳룊洹??숈뒿</div>
                        <div class="analytics-value" id="avg-daily-hours">0h</div>
                    </div>
                    <div class="analytics-stat">
                        <div class="analytics-label">?꾩껜 吏꾨룄??/div>
                        <div class="analytics-value" id="overall-progress">0%</div>
                    </div>
                    <div class="analytics-stat">
                        <div class="analytics-label">紐⑥쓽怨좎궗 ?됯퇏</div>
                        <div class="analytics-value" id="avg-mock-score">0??/div>
                    </div>
                </div>

                <!-- 怨쇰ぉ蹂??숈뒿 ?쒓컙 李⑦듃 -->
                <div class="chart-container">
                    <h3 id="subject-chart-title" style="margin-bottom: 15px; font-size: 1rem;">怨쇰ぉ蹂??숈뒿 ?쒓컙 遺꾪룷</h3>
                    <div class="chart-controls">
                        <span class="chart-control-label">?뺣젹:</span>
                        <button class="chart-control-btn active" data-sort="time" aria-label="?쒓컙???뺣젹">?쒓컙??/button>
                        <button class="chart-control-btn" data-sort="name" aria-label="?대쫫???뺣젹">?대쫫??/button>
                        <span class="chart-control-label" style="margin-left: 15px;">?쒖떆:</span>
                        <button class="chart-control-btn active" data-view="hours" aria-label="?쒓컙 ?⑥쐞濡??쒖떆">?쒓컙</button>
                        <button class="chart-control-btn" data-view="percentage" aria-label="鍮꾩쑉濡??쒖떆">鍮꾩쑉</button>
                    </div>
                    <div class="bar-chart"
                         id="subject-time-chart"
                         role="img"
                         aria-labelledby="subject-chart-title"
                         aria-describedby="subject-chart-desc"
                         tabindex="0">
                        <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                    </div>
                    <div id="subject-chart-desc" class="sr-only">
                        怨쇰ぉ蹂??숈뒿 ?쒓컙??留됰? 洹몃옒?꾨줈 ?쒖떆?⑸땲?? 媛?留됰?瑜??좏깮?섎㈃ ?곸꽭 ?뺣낫瑜??뺤씤?????덉뒿?덈떎.
                    </div>
                </div>

                <!-- 紐⑥쓽怨좎궗 ?먯닔 異붿씠 李⑦듃 -->
                <div class="chart-container">
                    <h3 id="mock-chart-title" style="margin-bottom: 15px; font-size: 1rem;">紐⑥쓽怨좎궗 ?먯닔 異붿씠</h3>
                    <div class="bar-chart"
                         id="mock-score-chart"
                         role="img"
                         aria-labelledby="mock-chart-title"
                         aria-describedby="mock-chart-desc"
                         tabindex="0">
                        <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                    </div>
                    <div id="mock-chart-desc" class="sr-only">
                        紐⑥쓽怨좎궗 ?먯닔 異붿씠瑜?留됰? 洹몃옒?꾨줈 ?쒖떆?⑸땲?? 60???댁긽? ?뱀깋, 40-59?먯? 二쇳솴?? 40??誘몃쭔? 鍮④컙?됱쑝濡??쒖떆?⑸땲??
                    </div>
                </div>
            </div>
        </div>

        <!-- 紐⑺몴 愿由?-->
        <div class="dashboard-grid">
            <!-- 紐⑺몴 ?ㅼ젙 & 留덉씪?ㅽ넠 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?렞 ?숈뒿 紐⑺몴</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="addGoal()">??/button>
                    </div>
                </div>
                <div id="goals-container">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
            </div>
        </div>

        <!-- ??쒕낫??洹몃━??-->
        <div class="dashboard-grid">
            <!-- ?ㅻ뒛???숈뒿 怨꾪쉷 -->
            <div class="card today-plan">
                <div class="card-header">
                    <h2 class="card-title">?뱴 ?ㅻ뒛???숈뒿 ?꾨왂</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="addTimeBlock()">??/button>
                    </div>
                </div>
                <div class="time-blocks" id="time-blocks-container">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
                <div style="background: var(--error-bg); padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger); margin-top: 15px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--danger);">?뮕 ?⑷꺽???됯퇏 (吏곸옣蹂묓뻾 湲곗?)</div>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                        ???쇱씪 ?숈뒿?쒓컙: ?됱씪 4-5?쒓컙<br>
                        ??湲곗텧臾몄젣 ?뚮룆: 怨쇰ぉ??6-7??br>
                        ??1李?以鍮꾧린媛? 12-18媛쒖썡
                    </div>
                </div>
            </div>
            
            <!-- 湲곗텧臾몄젣 ?뚮룆 ?몃옒而?-->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?봽 湲곗텧臾몄젣 ?뚮룆 ?꾪솴</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="resetRotations()">?봽</button>
                    </div>
                </div>
                <div class="rotation-tracker" id="rotation-tracker">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
            </div>
            
            <!-- ?숈뒿 ??대㉧ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?깍툘 ?ㅻ뒛???숈뒿 ?쒓컙</h2>
                </div>
                <div class="timer-display" id="timer">00:00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start" onclick="startTimer()">?쒖옉</button>
                    <button class="timer-btn pause" onclick="pauseTimer()">?쇱떆?뺤?</button>
                    <button class="timer-btn reset" onclick="resetTimer()">由ъ뀑</button>
                </div>
                <div class="weekly-stats" id="weekly-stats">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
            </div>
            
            <!-- ?щえ?꾨줈 ??대㉧ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?뛿 ?щえ?꾨줈 ??대㉧</h2>
                </div>
                <div class="pomodoro-display">
                    <div class="pomodoro-mode" id="pomodoro-mode">?묒뾽 ?몄뀡</div>
                    <div class="timer-display" id="pomodoro-timer">25:00</div>
                    <div class="pomodoro-session-count">
                        ?꾨즺???몄뀡: <span id="pomodoro-count">0</span>媛?                    </div>
                </div>
                <div class="timer-controls">
                    <button class="timer-btn start" id="pomodoro-start" onclick="startPomodoro()">?쒖옉</button>
                    <button class="timer-btn pause" id="pomodoro-pause" onclick="pausePomodoro()" style="display:none;">?쇱떆?뺤?</button>
                    <button class="timer-btn reset" onclick="resetPomodoro()">由ъ뀑</button>
                </div>
            </div>

            <!-- 怨쇰ぉ蹂?吏꾨룄 ?꾪솴 -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?뱤 怨쇰ぉ蹂?吏꾨룄??/h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="updateAllProgress()">?륅툘</button>
                    </div>
                </div>
                <div class="subject-progress" id="subject-progress">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
            </div>
            
            <!-- 紐⑥쓽怨좎궗 ?먯닔 ?몃옒而?-->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">?뱷 紐⑥쓽怨좎궗 ?먯닔 異붿씠</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="showScoreModal()">??/button>
                    </div>
                </div>
                <div class="mock-scores" id="mock-scores">
                    <!-- ?숈쟻?쇰줈 ?앹꽦?⑸땲??-->
                </div>
            </div>
            
            <!-- ?숆린遺??移대뱶 -->
            <div class="card">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 1.1rem; font-style: italic; margin-bottom: 10px;" id="motivation-quote">
                        "?ш린?섏? ?딆쑝硫?諛섎뱶???⑷꺽?쒕떎. ?쒗뿕? ?앷퉴吏 踰꾪떚??寃껋엯?덈떎."
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">- 29???⑷꺽??-</div>
                </div>
                <div style="background: var(--error-bg); padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger); margin-top: 15px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--danger);">?룇 ?⑷꺽??議곗뼵</div>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                        ??湲곗텧臾몄젣 6-7?뚮룆???듭떖<br>
                        ??理쒖떊?먮???諛섎뱶??泥댄겕<br>
                        ??紐⑥쓽怨좎궗 ?먯닔???곗뿰?섏? 留?寃?br>
                        ??留ㅼ씪 袁몄??덇? ?듭엯?덈떎
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ?숈뒿 ?명듃 ?뱀뀡 -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">?뱷 ?ㅻ뒛???숈뒿 ?명듃</h2>
            </div>
            <div class="notes-section">
                <textarea class="notes-input" placeholder="?ㅻ뒛 ?숈뒿???듭떖 ?댁슜, ?由?臾몄젣, ?룰컝由щ뒗 媛쒕뀗???뺣━?섏꽭??.." id="study-notes"></textarea>
                <div class="notes-toolbar">
                    <button class="notes-btn" onclick="saveNotes()">???/button>
                    <button class="notes-btn" onclick="showPreviousNotes()">?댁쟾 ?명듃</button>
                    <button class="notes-btn" onclick="exportNotes()">?대낫?닿린</button>
                    <button class="notes-btn" onclick="addErrorNote()">?ㅻ떟?명듃 異붽?</button>
                    <button class="notes-btn" onclick="clearNotes()">珥덇린??/button>
                </div>
            </div>
        </div>

        <!-- ?곗씠??愿由??뱀뀡 -->
        <div class="card data-management-card">
            <div class="card-header">
                <h2 class="card-title">?뮶 ?곗씠??愿由?/h2>
            </div>
            <div class="data-management-section">
                <p class="data-management-desc">?숈뒿 ?곗씠?곕? ?덉쟾?섍쾶 諛깆뾽?섍퀬 ?ㅻⅨ 湲곌린?먯꽌 遺덈윭?????덉뒿?덈떎</p>
                <div class="data-management-actions">
                    <button class="data-btn export-btn" onclick="exportData()">
                        <span class="btn-icon">燧뉛툘</span>
                        <span class="btn-text">?곗씠???대낫?닿린</span>
                    </button>
                    <button class="data-btn import-btn" onclick="document.getElementById('importFileInput').click()">
                        <span class="btn-icon">燧놅툘</span>
                        <span class="btn-text">?곗씠??媛?몄삤湲?/span>
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
                <div class="data-management-info">
                    <small>?대낫?닿린: 紐⑤뱺 ?숈뒿 ?곗씠?곕? JSON ?뚯씪濡???ν빀?덈떎</small><br>
                    <small>媛?몄삤湲? ?댁쟾????ν븳 ?곗씠?곕? 遺덈윭?듬땲??(?꾩옱 ?곗씠?곕뒗 ?泥대맗?덈떎)</small>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 0.85rem;">
            ?쒗뿕 ?꾨왂???숈뒿 ?쒖뒪??v2.5.2 | 1李?2李??쒗뿕 吏??| 李⑦듃 ?쒓컖??媛쒖꽑 | ?ㅽ겕 紐⑤뱶 | ?곗씠??Import/Export
        </div>
    </div>
    
    <!-- 紐⑤떖??-->
    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">紐⑥쓽怨좎궗 ?먯닔 異붽?</h3>
                <button class="modal-close" onclick="closeModal('scoreModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">?쒗뿕 ?좎쭨</label>
                    <input type="date" class="form-input" id="scoreDate">
                </div>
                <div class="form-group">
                    <label class="form-label">?먯닔</label>
                    <input type="number" step="0.5" class="form-input" id="scoreValue" placeholder="?? 58.5">
                </div>
                <div class="form-group">
                    <label class="form-label">硫붾え (?좏깮)</label>
                    <input type="text" class="form-input" id="scoreMemo" placeholder="?? 3李?紐⑥쓽怨좎궗">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('scoreModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveScore()">???/button>
            </div>
        </div>
    </div>
    
    <div id="timeBlockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">?숈뒿 ?쒓컙 釉붾줉 異붽?</h3>
                <button class="modal-close" onclick="closeModal('timeBlockModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">?쒓컙?</label>
                    <input type="text" class="form-input" id="blockTime" placeholder="?? 06:00-08:00">
                </div>
                <div class="form-group">
                    <label class="form-label">怨쇰ぉ</label>
                    <select class="form-select" id="blockSubject">
                        <optgroup label="1李??쒗뿕">
                            <option value="?뚮쾿">?뚮쾿</option>
                            <option value="誘쇰쾿">誘쇰쾿</option>
                            <option value="?곷쾿">?곷쾿</option>
                            <option value="誘쇱궗吏묓뻾踰?>誘쇱궗吏묓뻾踰?/option>
                            <option value="遺?숈궛?깃린踰?>遺?숈궛?깃린踰?/option>
                            <option value="?곸뾽?깃린踰?>?곸뾽?깃린踰?/option>
                            <option value="怨듯긽踰?>怨듯긽踰?/option>
                        </optgroup>
                        <optgroup label="2李??쒗뿕">
                            <option value="誘쇰쾿 (2李?">誘쇰쾿 (2李?</option>
                            <option value="?뺣쾿 (2李?">?뺣쾿 (2李?</option>
                            <option value="?뺤궗?뚯넚踰?(2李?">?뺤궗?뚯넚踰?(2李?</option>
                            <option value="誘쇱궗?뚯넚踰?(2李?">誘쇱궗?뚯넚踰?(2李?</option>
                            <option value="誘쇱궗?ш굔?쒕쪟?묒꽦 (2李?">誘쇱궗?ш굔?쒕쪟?묒꽦 (2李?</option>
                            <option value="遺?숈궛?깃린踰?(2李?">遺?숈궛?깃린踰?(2李?</option>
                            <option value="?깃린?좎껌?쒕쪟?묒꽦 (2李?">?깃린?좎껌?쒕쪟?묒꽦 (2李?</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">?덉긽 ?숈뒿 ?쒓컙 (?쒓컙)</label>
                    <input type="number" class="form-input" id="blockHours" placeholder="?? 2" min="0.5" step="0.5" value="2">
                </div>
                <div class="form-group">
                    <label class="form-label">?숈뒿 ?댁슜</label>
                    <input type="text" class="form-input" id="blockDetail" placeholder="?? 湲곗텧臾몄젣 #201-250">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('timeBlockModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveTimeBlock()">???/button>
            </div>
        </div>
    </div>

    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">?숈뒿 紐⑺몴 異붽?</h3>
                <button class="modal-close" onclick="closeModal('goalModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">紐⑺몴 ?댁슜</label>
                    <input type="text" class="form-input" id="goalTitle" placeholder="?? 誘쇰쾿 3?뚮룆 ?꾨즺">
                </div>
                <div class="form-group">
                    <label class="form-label">紐⑺몴 ?좎쭨</label>
                    <input type="date" class="form-input" id="goalDate">
                </div>
                <div class="form-group">
                    <label class="form-label">?꾩옱 吏꾨룄 (%)</label>
                    <input type="number" min="0" max="100" class="form-input" id="goalProgress" placeholder="0-100" value="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('goalModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveGoal()">???/button>
            </div>
        </div>
    </div>

    <!-- ?쒗뿕 ?좎쭨 ?ㅼ젙 紐⑤떖 -->
    <div id="examDateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="examDateModalTitle">?쒗뿕 ?좎쭨 ?ㅼ젙</h3>
                <button class="modal-close" onclick="closeModal('examDateModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">?쒗뿕 ?좎쭨</label>
                    <input type="date" class="form-input" id="examDateInput">
                </div>
                <div class="form-group">
                    <label class="form-label">硫붾え (?좏깮)</label>
                    <input type="text" class="form-input" id="examDateMemo" placeholder="?? ?꾧린?쒗뿕">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('examDateModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveExamDate()">???/button>
            </div>
        </div>
    </div>

    <!-- 怨쇰ぉ 吏꾨룄 ?섏젙 紐⑤떖 -->
    <div id="subjectProgressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="subjectProgressModalTitle">怨쇰ぉ 吏꾨룄 ?섏젙</h3>
                <button class="modal-close" onclick="closeModal('subjectProgressModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">?꾨즺 臾몄젣??/label>
                    <input type="number" class="form-input" id="subjectCompleted" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">紐⑺몴 臾몄젣??/label>
                    <input type="number" class="form-input" id="subjectTotal" min="1">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('subjectProgressModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveSubjectProgress()">???/button>
            </div>
        </div>
    </div>

    <!-- 二쇨컙 ?숈뒿 ?쒓컙 ?섏젙 紐⑤떖 -->
    <div id="weeklyHoursModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="weeklyHoursModalTitle">?숈뒿 ?쒓컙 ?섏젙</h3>
                <button class="modal-close" onclick="closeModal('weeklyHoursModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">?숈뒿 ?쒓컙 (?쒓컙)</label>
                    <input type="number" class="form-input" id="weeklyHoursInput" min="0" step="0.5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('weeklyHoursModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveWeeklyHours()">???/button>
            </div>
        </div>
    </div>

    <!-- ?뺤씤 紐⑤떖 (confirm ?泥? -->
    <div id="confirmModal" class="modal confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmModalTitle">?뺤씤</h3>
                <button class="modal-close" onclick="closeModal('confirmModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="confirm-message" id="confirmMessage">?뺣쭚 ?ㅽ뻾?섏떆寃좎뒿?덇퉴?</div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('confirmModal')">痍⑥냼</button>
                <button class="modal-btn save" id="confirmOkBtn">?뺤씤</button>
            </div>
        </div>
    </div>

    <!-- ?由?臾몄젣 ?명듃 紐⑤떖 -->
    <div id="wrongNoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">?由?臾몄젣 ?명듃 異붽?</h3>
                <button class="modal-close" onclick="closeModal('wrongNoteModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">怨쇰ぉ紐?/label>
                    <input type="text" class="form-input" id="wrongSubject" placeholder="?? 誘쇰쾿">
                </div>
                <div class="form-group">
                    <label class="form-label">?由?臾몄젣 踰덊샇 ?먮뒗 ?댁슜</label>
                    <input type="text" class="form-input" id="wrongQuestion" placeholder="?? 2024??1??35踰?>
                </div>
                <div class="form-group">
                    <label class="form-label">?由??댁쑀</label>
                    <textarea class="form-input" id="wrongReason" rows="3" placeholder="?댁쑀瑜??낅젰?섏꽭??></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('wrongNoteModal')">痍⑥냼</button>
                <button class="modal-btn save" onclick="saveWrongNote()">???/button>
            </div>
        </div>
    </div>

    <!-- ?곗씠??媛?몄삤湲??뺤씤 紐⑤떖 -->
    <div id="importConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">?곗씠??媛?몄삤湲??뺤씤</h3>
                <button class="modal-close" onclick="closeModal('importConfirmModal')">??/button>
            </div>
            <div class="modal-body">
                <div class="confirm-message" style="margin-bottom: 20px; color: var(--warning-dark); font-weight: 600;">
                    ?좑툘 ?꾩옱 ?곗씠?곕? 媛?몄삩 ?곗씠?곕줈 援먯껜?섏떆寃좎뒿?덇퉴?<br>
                    <span style="font-size: 0.9rem; color: var(--danger-color);">?꾩옱 ?곗씠?곕뒗 ?꾩쟾????젣?섎ŉ 蹂듦뎄?????놁뒿?덈떎.</span>
                </div>
                <div class="import-preview" id="importPreviewContainer">
                    <!-- 媛?몄삱 ?곗씠??誘몃━蹂닿린媛 ?ш린???쒖떆?⑸땲??-->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('importConfirmModal')">痍⑥냼</button>
                <button class="modal-btn save" id="confirmImportBtn" style="background: var(--danger-color);">?뺤씤 諛?媛?몄삤湲?/button>
            </div>
        </div>
    </div>

    <!-- ?좎뒪???뚮┝ 而⑦뀒?대꼫 -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // ?곗씠??珥덇린??        let studyData = {
            examType: localStorage.getItem('examType') || '1李?,
            examDates: {
                '1李?: null,  // Format: 'YYYY-MM-DD'
                '2李?: null
            },
            timer: {
                seconds: 0,
                isRunning: false,
                interval: null
            },
            pomodoro: {
                seconds: 1500, // 25 minutes
                isRunning: false,
                interval: null,
                mode: 'work', // 'work' or 'break'
                completedSessions: 0
            },
            subjects1st: [
                { name: '?뚮쾿', total: 500, completed: 320, rotations: [true, true, false, false, false, false, false] },
                { name: '誘쇰쾿', total: 800, completed: 580, rotations: [true, true, true, false, false, false, false] },
                { name: '?곷쾿', total: 500, completed: 280, rotations: [true, true, false, false, false, false, false] },
                { name: '誘쇱궗吏묓뻾踰?, total: 400, completed: 180, rotations: [true, false, false, false, false, false, false] },
                { name: '遺?숈궛?깃린踰?, total: 500, completed: 420, rotations: [true, true, true, true, false, false, false] },
                { name: '?곸뾽?깃린踰?, total: 300, completed: 150, rotations: [true, false, false, false, false, false, false] },
                { name: '怨듯긽踰?, total: 300, completed: 200, rotations: [true, true, false, false, false, false, false] }
            ],
            subjects2nd: [
                { name: '誘쇰쾿 (2李?', total: 100, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '?뺣쾿 (2李?', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '?뺤궗?뚯넚踰?(2李?', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '誘쇱궗?뚯넚踰?(2李?', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '誘쇱궗?ш굔?쒕쪟?묒꽦 (2李?', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '遺?숈궛?깃린踰?(2李?', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: '?깃린?좎껌?쒕쪟?묒꽦 (2李?', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] }
            ],
            subjects: [],  // Will be set dynamically based on examType
            timeBlocks: [],
            mockScores: [],
            weeklyHours: {},
            notes: {},
            // New features data
            streak: {
                current: 0,
                longest: 0,
                lastStudyDate: null,
                totalDays: 0
            },
            goals: [],
            subjectTimeSpent: {},  // Track time spent per subject
            studyHistory: [],  // Daily study records
            manualSubjectTime: {}  // Manually edited time per subject (overrides calculated time)
        };
        
        // 濡쒖뺄 ?ㅽ넗由ъ??먯꽌 ?곗씠??濡쒕뱶
        function loadData() {
            const saved = localStorage.getItem('studyData');
            if (saved) {
                const loadedData = JSON.parse(saved);
                studyData = { ...studyData, ...loadedData };

                // 2李?怨쇰ぉ???녾굅??援щ쾭?꾩씤 寃쎌슦 ?덈줈??湲곕낯媛??ㅼ젙
                if (!studyData.subjects2nd || studyData.subjects2nd.length === 4) {
                    studyData.subjects2nd = [
                        { name: '誘쇰쾿 (2李?', total: 100, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '?뺣쾿 (2李?', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '?뺤궗?뚯넚踰?(2李?', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '誘쇱궗?뚯넚踰?(2李?', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '誘쇱궗?ш굔?쒕쪟?묒꽦 (2李?', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '遺?숈궛?깃린踰?(2李?', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: '?깃린?좎껌?쒕쪟?묒꽦 (2李?', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] }
                    ];
                }

                // 1李?怨쇰ぉ???놁쑝硫?湲곕낯媛??ㅼ젙 (援щ쾭???명솚??
                if (!studyData.subjects1st && studyData.subjects) {
                    studyData.subjects1st = studyData.subjects;
                }
            }

            // ?쒗뿕 ??낆뿉 ?곕씪 怨쇰ぉ ?ㅼ젙
            // ?쒗뿕 ?좏삎 臾몄옄???뺢퇋??(?몄퐫???댁뒋 ?鍮?
            if (!studyData.examType || (studyData.examType + '').trim() === '') {
                studyData.examType = '1李?;
            } else {
                studyData.examType = (studyData.examType + '').trim().includes('2') ? '2李? : '1李?;
            }

            // ?쒗뿕 ?쇱젙 ??蹂댁젙
            if (!studyData.examDates || typeof studyData.examDates !== 'object') {
                studyData.examDates = { '1李?: null, '2李?: null };
            }

            updateSubjectsByExamType();

            // ?ㅻ뒛 ??대㉧ ?곗씠??濡쒕뱶
            const today = new Date().toISOString().split('T')[0];
            const todayTimer = localStorage.getItem(`timer_${today}`);
            if (todayTimer) {
                studyData.timer.seconds = parseInt(todayTimer);
            }
        }

        // ?쒗뿕 ??낆뿉 ?곕씪 怨쇰ぉ ?ㅼ젙
        function updateSubjectsByExamType() {
            if (studyData.examType === '2李?) {
                studyData.subjects = studyData.subjects2nd;
            } else {
                studyData.subjects = studyData.subjects1st;
            }
        }
        
        // ?곗씠?????        function saveData() {
            localStorage.setItem('studyData', JSON.stringify(studyData));
            
            // ?ㅻ뒛 ??대㉧ 蹂꾨룄 ???            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem(`timer_${today}`, studyData.timer.seconds);
        }
        
        // 珥덇린???⑥닔
        function init() {
            loadData();
            updateDDay();
            updateStreak();
            renderTimeBlocks();
            renderRotationTracker();
            renderWeeklyStats();
            renderSubjectProgress();
            renderMockScores();
            updateTimerDisplay();
            updatePomodoroDisplay();
            document.getElementById('pomodoro-count').textContent = studyData.pomodoro.completedSessions || 0;
            loadTodayNotes();
            rotateMotivation();
            renderAnalytics();
            renderGoals();

            // ?쒗뿕 ???諛?紐⑤뱶 ?ㅼ젙
            document.querySelectorAll('.mode-btn').forEach(btn => {
                const btnText = btn.textContent.trim();
                // ?쒗뿕 ???踰꾪듉
                if (btnText === '1李??쒗뿕' || btnText === '2李??쒗뿕') {
                    btn.classList.remove('active');
                    if (btnText === studyData.examType + ' ?쒗뿕') {
                        btn.classList.add('active');
                    }
                }
                // ?숈뒿 紐⑤뱶 踰꾪듉
                else {
                    btn.classList.remove('active');
                    if(btnText.includes(studyData.mode)) {
                        btn.classList.add('active');
                    }
                }
            });
            
            // 湲곕낯 ?쒓컙 釉붾줉???놁쑝硫?異붽?
            if (studyData.timeBlocks.length === 0) {
                studyData.timeBlocks = [
                    { id: Date.now(), time: '05:00-07:00', subject: '誘쇰쾿', detail: '湲곗텧臾몄젣 #201-250', completed: false },
                    { id: Date.now() + 1, time: '19:00-22:00', subject: '?뚮쾿', detail: '理쒖떊?먮? + 湲곗텧 ?뚮룆', completed: false }
                ];
                saveData();
                renderTimeBlocks();
            }
            
            // 湲곕낯 ?먯닔媛 ?놁쑝硫?異붽?
            if (studyData.mockScores.length === 0) {
                studyData.mockScores = [
                    { id: Date.now(), date: '2024-09-29', score: 52.5, memo: '1李?紐⑥쓽' },
                    { id: Date.now() + 1, date: '2024-10-06', score: 55.0, memo: '2李?紐⑥쓽' },
                    { id: Date.now() + 2, date: '2024-10-13', score: 58.5, memo: '3李?紐⑥쓽' }
                ];
                saveData();
                renderMockScores();
            }
        }
        
        // D-Day 怨꾩궛 諛??낅뜲?댄듃 (1李?2李?
        function updateDDay() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // 1李??쒗뿕 D-day
            const exam1stDate = studyData.examDates?.['1李?];
            const card1st = document.getElementById('dday-1st-card');
            if (exam1stDate) {
                const targetDate = new Date(exam1stDate);
                targetDate.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

                let ddayText, urgencyClass;
                if (diffDays > 0) {
                    ddayText = `D-${diffDays}`;
                    urgencyClass = diffDays <= 30 ? 'urgent' : (diffDays <= 90 ? 'warning' : 'normal');
                } else if (diffDays === 0) {
                    ddayText = 'D-Day';
                    urgencyClass = 'urgent';
                } else {
                    ddayText = `D+${Math.abs(diffDays)}`;
                    urgencyClass = 'normal';
                }

                document.getElementById('dday-1st-value').textContent = ddayText;
                document.getElementById('dday-1st-date').textContent = exam1stDate;
                card1st.className = `dday-card ${urgencyClass}`;
            } else {
                document.getElementById('dday-1st-value').textContent = 'D-?';
                document.getElementById('dday-1st-date').textContent = '?좎쭨 誘몄꽕??;
                card1st.className = 'dday-card';
            }

            // 2李??쒗뿕 D-day
            const exam2ndDate = studyData.examDates?.['2李?];
            const card2nd = document.getElementById('dday-2nd-card');
            if (exam2ndDate) {
                const targetDate = new Date(exam2ndDate);
                targetDate.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

                let ddayText, urgencyClass;
                if (diffDays > 0) {
                    ddayText = `D-${diffDays}`;
                    urgencyClass = diffDays <= 30 ? 'urgent' : (diffDays <= 90 ? 'warning' : 'normal');
                } else if (diffDays === 0) {
                    ddayText = 'D-Day';
                    urgencyClass = 'urgent';
                } else {
                    ddayText = `D+${Math.abs(diffDays)}`;
                    urgencyClass = 'normal';
                }

                document.getElementById('dday-2nd-value').textContent = ddayText;
                document.getElementById('dday-2nd-date').textContent = exam2ndDate;
                card2nd.className = `dday-card ${urgencyClass}`;
            } else {
                document.getElementById('dday-2nd-value').textContent = 'D-?';
                document.getElementById('dday-2nd-date').textContent = '?좎쭨 誘몄꽕??;
                card2nd.className = 'dday-card';
            }
        }

        // ?쒗뿕 ?좎쭨 ?ㅼ젙 紐⑤떖
        let editingExamType = null;

        function editExamDate(examType) {
            editingExamType = examType;
            document.getElementById('examDateModalTitle').textContent = `${examType} ?쒗뿕 ?좎쭨 ?ㅼ젙`;

            const currentDate = studyData.examDates?.[examType];
            document.getElementById('examDateInput').value = currentDate || '';
            document.getElementById('examDateMemo').value = '';

            document.getElementById('examDateModal').classList.add('show');
        }

        function saveExamDate() {
            if (!editingExamType) return;

            const dateValue = document.getElementById('examDateInput').value;

            if (dateValue) {
                if (!studyData.examDates) studyData.examDates = {};
                studyData.examDates[editingExamType] = dateValue;

                saveData();
                updateDDay();
                closeModal('examDateModal');
                showToast(`${editingExamType} ?쒗뿕 ?좎쭨媛 ?ㅼ젙?섏뿀?듬땲??);

                editingExamType = null;
            } else {
                showToast('?쒗뿕 ?좎쭨瑜??낅젰?댁＜?몄슂', 'error');
            }
        }
        
        // ?쒗뿕 ????ㅼ젙
        function setExamType(type) {
            console.log(`[Exam Type] Switching to ${type}`);
            studyData.examType = type;
            localStorage.setItem('examType', type);

            // 怨쇰ぉ ?낅뜲?댄듃
            updateSubjectsByExamType();

            saveData();

            // Update button states
            document.querySelectorAll('.mode-btn').forEach(btn => {
                if (btn.textContent.includes('?쒗뿕')) {
                    btn.classList.remove('active');
                    if (btn.textContent === type + ' ?쒗뿕') {
                        btn.classList.add('active');
                    }
                }
            });

            // CRITICAL FIX: Update ALL UI components to sync with exam type
            console.log(`[Exam Type] Updating all dashboard components`);

            // Update subject-related components
            renderRotationTracker();
            renderSubjectProgress();

            // Update analytics dashboard (CRITICAL - was missing!)
            renderSubjectTimeChart();
            renderMockScoreChart();

            // Analytics updated above

            // Update time blocks (filter by current exam type if needed)
            renderTimeBlocks();

            // Update streak and stats
            updateStreak();

            console.log(`[Exam Type] All components updated for ${type}`);
            showToast(`${type} ?쒗뿕 紐⑤뱶濡?蹂寃쎈릺?덉뒿?덈떎. 紐⑤뱺 ?곗씠?곌? ?숆린?붾릺?덉뒿?덈떎.`, 'success');
        }

        // ?쒓컙 釉붾줉 ?뚮뜑留?        function renderTimeBlocks() {
            const container = document.getElementById('time-blocks-container');
            container.innerHTML = '';

            studyData.timeBlocks.forEach(block => {
                const blockEl = document.createElement('div');
                blockEl.className = `time-block ${block.completed ? 'completed' : ''}`;

                // ?≪뀡 踰꾪듉 而⑦뀒?대꼫
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'time-block-actions';

                // ?섏젙 踰꾪듉
                const editBtn = document.createElement('button');
                editBtn.className = 'time-block-btn';
                editBtn.textContent = '?륅툘';
                editBtn.onclick = () => editTimeBlock(block.id);

                // ??젣 踰꾪듉
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'time-block-btn';
                deleteBtn.textContent = '?뿊截?;
                deleteBtn.onclick = () => deleteTimeBlock(block.id);

                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);

                // ?쒓컙 ?쇰꺼
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                const hours = block.hours || 2;
                timeLabel.textContent = `??${block.time} (${hours}h)`;

                // 怨쇰ぉ紐?                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'time-subject';
                subjectDiv.textContent = block.subject;

                // ?곸꽭 ?댁슜
                const detailDiv = document.createElement('div');
                detailDiv.className = 'time-detail';
                detailDiv.textContent = block.detail;

                // ?꾨즺 踰꾪듉
                const checkBtn = document.createElement('button');
                checkBtn.className = `check-btn ${block.completed ? 'checked' : ''}`;
                checkBtn.textContent = block.completed ? '?꾨즺?? : '?꾨즺';
                checkBtn.onclick = () => toggleTimeBlock(block.id);

                // 紐⑤몢 異붽?
                blockEl.appendChild(actionsDiv);
                blockEl.appendChild(timeLabel);
                blockEl.appendChild(subjectDiv);
                blockEl.appendChild(detailDiv);
                blockEl.appendChild(checkBtn);

                container.appendChild(blockEl);
            });
        }
        
        // ?쒓컙 釉붾줉 ?좉?
        function toggleTimeBlock(id) {
            const block = studyData.timeBlocks.find(b => b.id === id);
            if (block) {
                block.completed = !block.completed;
                const hours = block.hours || 2; // Default to 2 hours if not set (legacy compatibility)
                const seconds = hours * 3600;

                if (block.completed) {
                    studyData.timer.seconds += seconds;
                    updateTimerDisplay();
                    showToast(`?숈뒿 ?꾨즺! ${hours}?쒓컙??異붽??섏뿀?듬땲???몡`);
                } else {
                    studyData.timer.seconds = Math.max(0, studyData.timer.seconds - seconds);
                    updateTimerDisplay();
                }
                saveData();
                renderTimeBlocks();
            }
        }
        
        // ?쒓컙 釉붾줉 異붽?
        function addTimeBlock() {
            document.getElementById('timeBlockModal').classList.add('show');
        }
        
        // ?쒓컙 釉붾줉 ???        function saveTimeBlock() {
            const time = document.getElementById('blockTime').value;
            const subject = document.getElementById('blockSubject').value;
            const hours = parseFloat(document.getElementById('blockHours').value) || 2;
            const detail = document.getElementById('blockDetail').value;

            if (time && subject && detail) {
                if (editingBlockId) {
                    // ?섏젙 紐⑤뱶
                    const block = studyData.timeBlocks.find(b => b.id === editingBlockId);
                    if (block) {
                        block.time = time;
                        block.subject = subject;
                        block.hours = hours;
                        block.detail = detail;
                        showToast('?숈뒿 釉붾줉???섏젙?섏뿀?듬땲??);
                    }
                    editingBlockId = null;
                } else {
                    // 異붽? 紐⑤뱶
                    studyData.timeBlocks.push({
                        id: Date.now(),
                        time,
                        subject,
                        hours,
                        detail,
                        completed: false
                    });
                    showToast('?숈뒿 釉붾줉??異붽??섏뿀?듬땲??);
                }
                saveData();
                renderTimeBlocks();
                closeModal('timeBlockModal');

                // Reset form
                document.getElementById('blockTime').value = '';
                document.getElementById('blockDetail').value = '';
                document.getElementById('blockHours').value = '2';
                document.querySelector('#timeBlockModal .modal-title').textContent = '?숈뒿 ?쒓컙 釉붾줉 異붽?';
            }
        }
        
        // ?쒓컙 釉붾줉 ??젣
        function deleteTimeBlock(id) {
            showConfirm('?뺣쭚 ??젣?섏떆寃좎뒿?덇퉴?', () => {
                studyData.timeBlocks = studyData.timeBlocks.filter(b => b.id !== id);
                saveData();
                renderTimeBlocks();
                showToast('??젣?섏뿀?듬땲??);
            });
        }
        
        // ?쒓컙 釉붾줉 ?섏젙 (紐⑤떖 ?ъ슜)
        let editingBlockId = null;

        function editTimeBlock(id) {
            const block = studyData.timeBlocks.find(b => b.id === id);
            if (block) {
                editingBlockId = id;
                document.getElementById('blockTime').value = block.time;
                document.getElementById('blockSubject').value = block.subject;
                document.getElementById('blockHours').value = block.hours || 2;
                document.getElementById('blockDetail').value = block.detail;
                document.querySelector('#timeBlockModal .modal-title').textContent = '?숈뒿 ?쒓컙 釉붾줉 ?섏젙';
                document.getElementById('timeBlockModal').classList.add('show');
            }
        }
        
        // ?뚮룆 ?몃옒而??뚮뜑留?        function renderRotationTracker() {
            const container = document.getElementById('rotation-tracker');
            container.innerHTML = '';
            
            studyData.subjects.forEach((subject, idx) => {
                const div = document.createElement('div');
                div.className = 'subject-rotation';
                
                let circlesHtml = '';
                subject.rotations.forEach((completed, i) => {
                    const isCurrent = completed && !subject.rotations[i + 1];
                    circlesHtml += `
                        <div class="rotation-circle ${completed ? 'completed' : ''} ${isCurrent ? 'current' : ''}" 
                             onclick="toggleRotation(${idx}, ${i})">
                            ${i + 1}
                        </div>
                    `;
                });
                
                div.innerHTML = `
                    <span class="subject-name">${subject.name}</span>
                    <div class="rotation-circles">${circlesHtml}</div>
                `;
                container.appendChild(div);
            });
        }
        
        // ?뚮룆 ?좉?
        function toggleRotation(subjectIdx, rotationIdx) {
            const subject = studyData.subjects[subjectIdx];
            subject.rotations[rotationIdx] = !subject.rotations[rotationIdx];
            
            // ?댁쟾 ?뚮룆???꾨즺?섏? ?딆븯?쇰㈃ ?꾨즺 泥섎━
            for (let i = 0; i < rotationIdx; i++) {
                subject.rotations[i] = true;
            }
            
            saveData();
            renderRotationTracker();
            
            if (subject.rotations[rotationIdx]) {
                showToast(`${subject.name} ${rotationIdx + 1}?뚮룆 ?꾨즺! ?럦`);
            }
        }
        
        // ?뚮룆 珥덇린??        function resetRotations() {
            showConfirm('紐⑤뱺 ?뚮룆 湲곕줉??珥덇린?뷀븯?쒓쿋?듬땲源?', () => {
                studyData.subjects.forEach(subject => {
                    subject.rotations = [false, false, false, false, false, false, false];
                });
                saveData();
                renderRotationTracker();
                showToast('?뚮룆 湲곕줉??珥덇린?붾릺?덉뒿?덈떎');
            });
        }
        
        // ??대㉧ 湲곕뒫
        function startTimer() {
            if (!studyData.timer.isRunning) {
                studyData.timer.isRunning = true;
                studyData.timer.interval = setInterval(() => {
                    studyData.timer.seconds++;
                    updateTimerDisplay();
                    
                    // 30遺꾨쭏???먮룞 ???                    if (studyData.timer.seconds % 1800 === 0) {
                        saveData();
                        showToast('?숈뒿 吏꾨룄媛 ?먮룞 ??λ릺?덉뒿?덈떎');
                    }
                }, 1000);
            }
        }
        
        function pauseTimer() {
            studyData.timer.isRunning = false;
            clearInterval(studyData.timer.interval);
            saveData();
        }
        
        function resetTimer() {
            showConfirm('?뺣쭚 由ъ뀑?섏떆寃좎뒿?덇퉴?', () => {
                studyData.timer.isRunning = false;
                clearInterval(studyData.timer.interval);
                studyData.timer.seconds = 0;
                updateTimerDisplay();
                saveData();
                showToast('??대㉧媛 由ъ뀑?섏뿀?듬땲??);
            });
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(studyData.timer.seconds / 3600);
            const minutes = Math.floor((studyData.timer.seconds % 3600) / 60);
            const secs = studyData.timer.seconds % 60;

            document.getElementById('timer').textContent =
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // ?щえ?꾨줈 ??대㉧ 湲곕뒫
        function startPomodoro() {
            if (!studyData.pomodoro.isRunning) {
                studyData.pomodoro.isRunning = true;
                document.getElementById('pomodoro-start').style.display = 'none';
                document.getElementById('pomodoro-pause').style.display = 'inline-block';

                studyData.pomodoro.interval = setInterval(() => {
                    if (studyData.pomodoro.seconds > 0) {
                        studyData.pomodoro.seconds--;
                        updatePomodoroDisplay();
                    } else {
                        // Timer finished
                        playNotificationSound();
                        if (studyData.pomodoro.mode === 'work') {
                            // Work session completed
                            studyData.pomodoro.completedSessions++;
                            studyData.pomodoro.mode = 'break';
                            studyData.pomodoro.seconds = 300; // 5 minutes break
                            showToast('?묒뾽 ?몄뀡 ?꾨즺! 5遺??댁떇 ?쒖옉 ?럦');
                            document.getElementById('pomodoro-mode').textContent = '?댁떇 ?쒓컙';
                            document.getElementById('pomodoro-mode').className = 'pomodoro-mode break';
                        } else {
                            // Break completed
                            studyData.pomodoro.mode = 'work';
                            studyData.pomodoro.seconds = 1500; // 25 minutes work
                            showToast('?댁떇 ?꾨즺! ?덈줈???묒뾽 ?몄뀡 ?쒖옉 ?뮞');
                            document.getElementById('pomodoro-mode').textContent = '?묒뾽 ?몄뀡';
                            document.getElementById('pomodoro-mode').className = 'pomodoro-mode work';
                        }
                        updatePomodoroDisplay();
                        document.getElementById('pomodoro-count').textContent = studyData.pomodoro.completedSessions;
                        pausePomodoro(); // Auto pause after completion
                        saveData();
                    }
                }, 1000);
            }
        }

        function pausePomodoro() {
            studyData.pomodoro.isRunning = false;
            clearInterval(studyData.pomodoro.interval);
            document.getElementById('pomodoro-start').style.display = 'inline-block';
            document.getElementById('pomodoro-pause').style.display = 'none';
            saveData();
        }

        function resetPomodoro() {
            showConfirm('?щえ?꾨줈 ??대㉧瑜?由ъ뀑?섏떆寃좎뒿?덇퉴?', () => {
                pausePomodoro();
                studyData.pomodoro.seconds = 1500; // Reset to 25 minutes
                studyData.pomodoro.mode = 'work';
                studyData.pomodoro.completedSessions = 0;
                updatePomodoroDisplay();
                document.getElementById('pomodoro-count').textContent = '0';
                document.getElementById('pomodoro-mode').textContent = '?묒뾽 ?몄뀡';
                document.getElementById('pomodoro-mode').className = 'pomodoro-mode work';
                saveData();
                showToast('?щえ?꾨줈 ??대㉧媛 由ъ뀑?섏뿀?듬땲??);
            });
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(studyData.pomodoro.seconds / 60);
            const secs = studyData.pomodoro.seconds % 60;
            document.getElementById('pomodoro-timer').textContent =
                `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function playNotificationSound() {
            // Create a simple beep sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio notification not supported');
            }
        }

        // 二쇨컙 ?듦퀎 ?뚮뜑留?        function renderWeeklyStats() {
            const container = document.getElementById('weekly-stats');
            container.innerHTML = '';
            
            const days = ['??, '??, '??, '紐?, '湲?, '??, '??];
            const today = new Date().getDay();
            const adjustedToday = today === 0 ? 6 : today - 1;
            
            days.forEach((day, idx) => {
                const hours = studyData.weeklyHours[day] || 0;
                const isToday = idx === adjustedToday;
                const isCompleted = hours >= 4;
                
                const div = document.createElement('div');
                div.className = `day-stat ${isToday ? 'today' : ''} ${isCompleted ? 'completed' : ''}`;
                div.innerHTML = `
                    <div class="day-name">${day}</div>
                    <div class="day-hours">${hours}h</div>
                `;
                div.onclick = () => updateDayHours(day);
                container.appendChild(div);
            });
        }
        
        // ?쇱씪 ?쒓컙 ?낅뜲?댄듃 - 紐⑤떖 ?ъ슜
        let editingWeekDay = null;

        function updateDayHours(day) {
            editingWeekDay = day;
            document.getElementById('weeklyHoursModalTitle').textContent = `${day}?붿씪 ?숈뒿 ?쒓컙 ?섏젙`;
            document.getElementById('weeklyHoursInput').value = studyData.weeklyHours[day] || 0;
            document.getElementById('weeklyHoursModal').classList.add('show');
        }

        function saveWeeklyHours() {
            if (!editingWeekDay) return;

            const hours = parseFloat(document.getElementById('weeklyHoursInput').value);

            if (!isNaN(hours) && hours >= 0) {
                studyData.weeklyHours[editingWeekDay] = hours;
                saveData();
                renderWeeklyStats();
                updateAnalytics();
                closeModal('weeklyHoursModal');
                showToast(`${editingWeekDay}?붿씪 ?숈뒿 ?쒓컙???낅뜲?댄듃?섏뿀?듬땲??);
                editingWeekDay = null;
            } else {
                showToast('?щ컮瑜??쒓컙???낅젰?댁＜?몄슂', 'error');
            }
        }
        
        // 怨쇰ぉ蹂?吏꾨룄 ?뚮뜑留?        function renderSubjectProgress() {
            const container = document.getElementById('subject-progress');
            container.innerHTML = '';

            studyData.subjects.forEach((subject, idx) => {
                const percent = Math.round((subject.completed / subject.total) * 100);
                const div = document.createElement('div');
                div.className = 'progress-item';

                // ?ㅻ뜑 ?앹꽦
                const header = document.createElement('div');
                header.className = 'progress-header';
                header.innerHTML = `
                    <span class="progress-label">${subject.name}</span>
                    <span class="progress-value">${subject.completed}/${subject.total} 臾몄젣</span>
                `;
                header.onclick = () => updateProgress(idx);

                // ?꾨줈洹몃젅??諛??앹꽦
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.innerHTML = `
                    <div class="progress-fill" style="width: ${percent}%">${percent}%</div>
                `;
                progressBar.onclick = () => updateProgress(idx);

                div.appendChild(header);
                div.appendChild(progressBar);
                container.appendChild(div);
            });
        }

        // 吏꾨룄 ?낅뜲?댄듃 - 紐⑤떖 ?ъ슜
        let editingSubjectIdx = null;

        function updateProgress(idx) {
            const subject = studyData.subjects[idx];
            editingSubjectIdx = idx;

            document.getElementById('subjectProgressModalTitle').textContent = `${subject.name} 吏꾨룄 ?섏젙`;
            document.getElementById('subjectCompleted').value = subject.completed;
            document.getElementById('subjectTotal').value = subject.total;
            document.getElementById('subjectProgressModal').classList.add('show');
        }

        function saveSubjectProgress() {
            if (editingSubjectIdx === null) return;

            const completed = parseInt(document.getElementById('subjectCompleted').value);
            const total = parseInt(document.getElementById('subjectTotal').value);

            if (!isNaN(completed) && !isNaN(total) && total >= 1) {
                const subject = studyData.subjects[editingSubjectIdx];
                subject.completed = completed;
                subject.total = Math.max(total, 1);

                // ?ㅼ젣 ?곗씠???뚯뒪?먮룄 諛섏쁺
                if (studyData.examType === '2李?) {
                    studyData.subjects2nd[editingSubjectIdx] = subject;
                } else {
                    studyData.subjects1st[editingSubjectIdx] = subject;
                }

                saveData();
                renderSubjectProgress();
                closeModal('subjectProgressModal');
                showToast(`${subject.name} 吏꾨룄媛 ?낅뜲?댄듃?섏뿀?듬땲??(${subject.completed}/${subject.total})`);

                editingSubjectIdx = null;
            } else {
                showToast('?щ컮瑜??レ옄瑜??낅젰?댁＜?몄슂', 'error');
            }
        }
        
        // ?꾩껜 吏꾨룄 ?낅뜲?댄듃
        function updateAllProgress() {
            showToast('媛?怨쇰ぉ???대┃?섏뿬 吏꾨룄瑜??낅뜲?댄듃?섏꽭??);
        }
        
        // 紐⑥쓽怨좎궗 ?먯닔 ?뚮뜑留?        function renderMockScores() {
            const container = document.getElementById('mock-scores');
            container.innerHTML = '';

            studyData.mockScores.forEach(score => {
                const isPass = score.score >= 60;
                const div = document.createElement('div');
                div.className = 'score-entry';

                // ?좎쭨 諛?硫붾え ?쒖떆
                const dateSpan = document.createElement('span');
                dateSpan.className = 'score-date';
                dateSpan.textContent = `${score.date} ${score.memo ? `(${score.memo})` : ''}`;

                // ?≪뀡 踰꾪듉 而⑦뀒?대꼫
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'score-actions';

                // ?섏젙 踰꾪듉
                const editBtn = document.createElement('button');
                editBtn.className = 'score-action-btn';
                editBtn.textContent = '?륅툘';
                editBtn.onclick = () => editScore(score.id);

                // ??젣 踰꾪듉
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'score-action-btn';
                deleteBtn.textContent = '?뿊截?;
                deleteBtn.onclick = () => deleteScore(score.id);

                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);

                // ?먯닔 ?쒖떆
                const scoreSpan = document.createElement('span');
                scoreSpan.className = `score-value ${isPass ? 'pass' : 'fail'}`;
                scoreSpan.textContent = `${score.score}??;

                div.appendChild(dateSpan);
                div.appendChild(actionsDiv);
                div.appendChild(scoreSpan);

                container.appendChild(div);
            });

            // 紐⑺몴 ?먯닔 ?쒖떆
            const targetDiv = document.createElement('div');
            targetDiv.className = 'score-entry';
            targetDiv.innerHTML = `
                <span class="score-date">紐⑺몴 ?먯닔</span>
                <span class="score-value pass">65.0?먥넁</span>
            `;
            container.appendChild(targetDiv);
        }
        
        // ?먯닔 紐⑤떖 ?쒖떆
        function showScoreModal() {
            document.getElementById('scoreDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('scoreValue').value = '';
            document.getElementById('scoreMemo').value = '';
            document.getElementById('scoreModal').classList.add('show');
        }
        
        // ?먯닔 ???        function saveScore() {
            const date = document.getElementById('scoreDate').value;
            const scoreValue = parseFloat(document.getElementById('scoreValue').value);
            const memo = document.getElementById('scoreMemo').value;

            if (date && !isNaN(scoreValue)) {
                if (editingScoreId) {
                    // ?섏젙 紐⑤뱶
                    const score = studyData.mockScores.find(s => s.id === editingScoreId);
                    if (score) {
                        score.date = date;
                        score.score = scoreValue;
                        score.memo = memo;
                        showToast('?먯닔媛 ?섏젙?섏뿀?듬땲??);
                    }
                    editingScoreId = null;
                } else {
                    // 異붽? 紐⑤뱶
                    studyData.mockScores.push({
                        id: Date.now(),
                        date,
                        score: scoreValue,
                        memo
                    });
                    showToast(`${scoreValue}?먯씠 湲곕줉?섏뿀?듬땲??);
                }

                // ?좎쭨???뺣젹
                studyData.mockScores.sort((a, b) => new Date(a.date) - new Date(b.date));

                saveData();
                renderMockScores();
                closeModal('scoreModal');

                // Reset form and title
                document.getElementById('scoreDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('scoreValue').value = '';
                document.getElementById('scoreMemo').value = '';
                document.querySelector('#scoreModal .modal-title').textContent = '紐⑥쓽怨좎궗 ?먯닔 異붽?';
            } else {
                showToast('?좎쭨? ?먯닔瑜??щ컮瑜닿쾶 ?낅젰?댁＜?몄슂', 'error');
            }
        }
        
        // ?먯닔 ??젣
        function deleteScore(id) {
            showConfirm('?뺣쭚 ??젣?섏떆寃좎뒿?덇퉴?', () => {
                studyData.mockScores = studyData.mockScores.filter(s => s.id !== id);
                saveData();
                renderMockScores();
                showToast('??젣?섏뿀?듬땲??);
            });
        }
        
        // ?먯닔 ?섏젙 - 紐⑤떖 ?ъ슜
        let editingScoreId = null;

        function editScore(id) {
            const score = studyData.mockScores.find(s => s.id === id);
            if (score) {
                editingScoreId = id;
                document.getElementById('scoreDate').value = score.date;
                document.getElementById('scoreValue').value = score.score;
                document.getElementById('scoreMemo').value = score.memo || '';
                document.querySelector('#scoreModal .modal-title').textContent = '紐⑥쓽怨좎궗 ?먯닔 ?섏젙';
                document.getElementById('scoreModal').classList.add('show');
            }
        }
        
        // 紐⑤떖 ?リ린
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // ?뺤씤 紐⑤떖 ?ы띁 (confirm ?泥?
        function showConfirm(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('show');

            const confirmBtn = document.getElementById('confirmOkBtn');
            const newBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);

            newBtn.onclick = () => {
                closeModal('confirmModal');
                if (onConfirm) onConfirm();
            };
        }

        // 硫붿떆吏 紐⑤떖 ?ы띁 (alert ?泥?- HTML 吏??
        function showModalMessage(title, htmlContent) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">${title}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">??/button>
                    </div>
                    <div class="modal-body">
                        ${htmlContent}
                    </div>
                    <div class="modal-footer">
                        <button class="modal-btn save" onclick="this.closest('.modal').remove()">?뺤씤</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ?명듃 湲곕뒫
        function saveNotes() {
            const notes = document.getElementById('study-notes').value;
            const today = new Date().toISOString().split('T')[0];
            
            if (!studyData.notes) studyData.notes = {};
            studyData.notes[today] = {
                content: notes,
                timestamp: new Date().toISOString()
            };
            
            saveData();
            showToast('?명듃媛 ??λ릺?덉뒿?덈떎 ?뱷');
        }
        
        function loadTodayNotes() {
            const today = new Date().toISOString().split('T')[0];
            if (studyData.notes && studyData.notes[today]) {
                document.getElementById('study-notes').value = studyData.notes[today].content;
            }
        }
        
        function showPreviousNotes() {
            if (!studyData.notes) {
                showToast('??λ맂 ?명듃媛 ?놁뒿?덈떎');
                return;
            }
            
            const dates = Object.keys(studyData.notes).sort().reverse();
            if (dates.length === 0) {
                showToast('??λ맂 ?명듃媛 ?놁뒿?덈떎');
                return;
            }
            
            let notesList = '<h3 style="margin-bottom:15px">?뱴 理쒓렐 ?숈뒿 ?명듃</h3>';
            dates.slice(0, 7).forEach(date => {
                const content = studyData.notes[date].content;
                notesList += `<div style="margin-bottom:15px;padding:10px;background:#f7fafc;border-radius:6px">
                    <strong>?뱟 ${date}</strong><br>
                    ${content.substring(0, 150)}...
                </div>`;
            });

            showModalMessage('理쒓렐 ?숈뒿 ?명듃', notesList);
        }
        
        function exportNotes() {
            const dataStr = JSON.stringify(studyData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `study_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('?곗씠?곌? ?대낫?댁죱?듬땲???뮶');
        }
        
        function addErrorNote() {
            document.getElementById('wrongSubject').value = '';
            document.getElementById('wrongQuestion').value = '';
            document.getElementById('wrongReason').value = '';
            document.getElementById('wrongNoteModal').classList.add('show');
        }

        function saveWrongNote() {
            const subject = document.getElementById('wrongSubject').value;
            const question = document.getElementById('wrongQuestion').value;
            const reason = document.getElementById('wrongReason').value;

            if (subject && question && reason) {
                const errorNote = `\n\n[?ㅻ떟?명듃]\n怨쇰ぉ: ${subject}\n臾몄젣: ${question}\n?댁쑀: ${reason}\n`;
                document.getElementById('study-notes').value += errorNote;
                closeModal('wrongNoteModal');
                showToast('?ㅻ떟?명듃媛 異붽??섏뿀?듬땲??);
            } else {
                showToast('紐⑤뱺 ??ぉ???낅젰?댁＜?몄슂', 'error');
            }
        }
        
        function clearNotes() {
            showConfirm('?ㅻ뒛 ?명듃瑜?珥덇린?뷀븯?쒓쿋?듬땲源?', () => {
                document.getElementById('study-notes').value = '';
                showToast('?명듃媛 珥덇린?붾릺?덉뒿?덈떎');
            });
        }
        
        // ?숆린遺??臾멸뎄 濡쒗뀒?댁뀡
        function rotateMotivation() {
            const quotes = [
                "?ш린?섏? ?딆쑝硫?諛섎뱶???⑷꺽?쒕떎. ?쒗뿕? ?앷퉴吏 踰꾪떚??寃껋엯?덈떎.",
                "癒몃━蹂대떎 以묒슂??寃껋? ?됰뜦?대? ?ㅻ옒 遺숈씠怨??덉쓣 ???덈뒗 寃?",
                "吏곸옣蹂묓뻾?대씪??留ㅼ씪 袁몄????섎㈃ ?⑷꺽?????덉뒿?덈떎.",
                "紐⑥쓽怨좎궗 ?먯닔媛 ??븘???ш린?섏? 留덉꽭?? ?앷퉴吏 媛硫??⑸땲??",
                "湲곗텧臾몄젣瑜??꾩쟾????寃껋쑝濡?留뚮뱶??寃껋씠 ?⑷꺽??吏由꾧만?낅땲??",
                "?ㅻ뒛 紐삵븳 怨듬????댁씪 ??諛곌? ?⑸땲?? ?ㅻ뒛 ???쇱? ?ㅻ뒛!",
                "1??諛섏쓽 ?몃젰???됱깮???먭꺽利앹씠 ?⑸땲??",
                "?쒗뿕? ??紐⑤Ⅴ???곹깭?먯꽌 遺숇뒗 嫄곕떎.",
                "?⑤뱾???대졄?듬땲?? ?섎쭔 ?대젮??寃껋씠 ?꾨떃?덈떎.",
                "踰꾪떚硫??⑷꺽?쒕떎. ?앷퉴吏 踰꾪떚??寃껋엯?덈떎."
            ];
            
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('motivation-quote').textContent = randomQuote;
        }
        
        // ?좎뒪??硫붿떆吏 (???吏?? success, error, warning, info)
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '??,
                error: '??,
                warning: '??,
                info: '??
            };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.success}</span>
                <span class="toast-message">${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutToast 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ?ㅻ낫???⑥텞??        document.addEventListener('keydown', function(e) {
            // ESC ?ㅻ줈 紐⑤뱺 紐⑤떖 ?リ린
            if (e.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal.show');
                openModals.forEach(modal => {
                    if (modal.id) {
                        closeModal(modal.id);
                    } else {
                        modal.remove(); // ?숈쟻 ?앹꽦??紐⑤떖
                    }
                });
                return;
            }

            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveNotes();
                        break;
                    case ' ':
                        e.preventDefault();
                        if (studyData.timer.isRunning) pauseTimer();
                        else startTimer();
                        break;
                }
            }
        });
        
        // ?섏씠吏 醫낅즺 ???먮룞 ???        window.addEventListener('beforeunload', function() {
            saveData();
            if (document.getElementById('study-notes').value) {
                saveNotes();
            }
        });
        
        // 5遺꾨쭏???숆린遺??臾멸뎄 蹂寃?        setInterval(rotateMotivation, 300000);

        // ===== ?덈줈??湲곕뒫: ?ㅽ듃由??몃옒而?=====
        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const lastStudy = studyData.streak.lastStudyDate;

            // 珥덇린??            if (!studyData.streak) {
                studyData.streak = { current: 0, longest: 0, lastStudyDate: null, totalDays: 0 };
            }

            // ?ㅻ뒛 ?숈뒿 湲곕줉???덈뒗吏 ?뺤씤 (??대㉧ ?쒓컙 or ?꾨즺????꾨툝濡?
            const hasStudiedToday = studyData.timer.seconds > 0 ||
                                   studyData.timeBlocks.some(b => b.completed);

            if (hasStudiedToday && lastStudy !== today) {
                if (lastStudy) {
                    const lastDate = new Date(lastStudy);
                    const todayDate = new Date(today);
                    const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));

                    if (diffDays === 1) {
                        // ?곗냽 ?숈뒿
                        studyData.streak.current++;
                    } else if (diffDays > 1) {
                        // ?ㅽ듃由??딄?
                        studyData.streak.current = 1;
                    }
                } else {
                    // 泥??숈뒿
                    studyData.streak.current = 1;
                }

                studyData.streak.lastStudyDate = today;
                studyData.streak.totalDays++;

                // 理쒖옣 湲곕줉 媛깆떊
                if (studyData.streak.current > studyData.streak.longest) {
                    studyData.streak.longest = studyData.streak.current;
                }

                saveData();
            }

            // UI ?낅뜲?댄듃
            document.getElementById('current-streak').textContent = studyData.streak.current || 0;
            document.getElementById('longest-streak').textContent = studyData.streak.longest || 0;
            document.getElementById('total-study-days').textContent = studyData.streak.totalDays || 0;
        }

        function resetStreak() {
            showConfirm('?ㅽ듃由?湲곕줉??珥덇린?뷀븯?쒓쿋?듬땲源?', () => {
                studyData.streak = { current: 0, longest: 0, lastStudyDate: null, totalDays: 0 };
                saveData();
                updateStreak();
                showToast('?ㅽ듃由?씠 珥덇린?붾릺?덉뒿?덈떎');
            });
        }

        // ===== ?덈줈??湲곕뒫: ?숈뒿 遺꾩꽍 ??쒕낫??=====
                function renderAnalytics() {
            // Calculate REAL total study hours from multiple sources
            let totalHours = 0;

            // 1. From timer
            totalHours += studyData.timer.seconds / 3600;

            // 2. From completed time blocks
            studyData.timeBlocks.forEach(block => {
                if (block.completed) {
                    totalHours += block.hours || 0;
                }
            });

            // 3. From weekly hours tracking
            Object.values(studyData.weeklyHours).forEach(h => totalHours += h);

            document.getElementById('total-study-hours').textContent = Math.round(totalHours) + 'h';

            // Calculate actual study days from history
            const uniqueStudyDays = new Set();
            studyData.timeBlocks.forEach(block => {
                if (block.completed && block.time) {
                    const dateKey = block.time.split('T')[0];
                    uniqueStudyDays.add(dateKey);
                }
            });

            if (studyData.studyHistory && studyData.studyHistory.length > 0) {
                studyData.studyHistory.forEach(day => {
                    uniqueStudyDays.add(day.date);
                });
            }

            const actualStudyDays = Math.max(uniqueStudyDays.size, studyData.streak.totalDays || 1, 1);
            const avgHours = totalHours / actualStudyDays;
            document.getElementById('avg-daily-hours').textContent = avgHours.toFixed(1) + 'h';

            // Calculate overall progress from BOTH 1st and 2nd exam subjects
            let totalCompleted = 0;
            let totalProblems = 0;

            studyData.subjects.forEach(s => {
                totalCompleted += s.completed;
                totalProblems += s.total;
            });

            const overallProgress = totalProblems > 0 ? Math.round((totalCompleted / totalProblems) * 100) : 0;
            document.getElementById('overall-progress').textContent = overallProgress + '%';

            // Calculate mock exam average from REAL user data
            if (studyData.mockScores.length > 0) {
                const avgScore = studyData.mockScores.reduce((sum, s) => sum + s.score, 0) / studyData.mockScores.length;
                document.getElementById('avg-mock-score').textContent = avgScore.toFixed(1) + '??;
            } else {
                document.getElementById('avg-mock-score').textContent = '-';
            }

            // Render enhanced charts with real data
            renderSubjectTimeChart();
            renderMockScoreChart();
        }



        // Global chart state
        let chartSettings = {
            subjectSort: 'time', // 'time' or 'name'
            subjectView: 'hours' // 'hours' or 'percentage'
        };

        function renderSubjectTimeChart() {
            const container = document.getElementById('subject-time-chart');
            container.innerHTML = '';

            // Initialize manualSubjectTime if not exists
            if (!studyData.manualSubjectTime) {
                studyData.manualSubjectTime = {};
            }

            // Calculate REAL time spent per subject
            const subjectTime = {};

            // Initialize with 0 for all subjects
            studyData.subjects.forEach(subject => {
                subjectTime[subject.name] = 0;
            });

            // 1. Add time from completed time blocks
            studyData.timeBlocks.forEach(block => {
                if (block.completed && block.subject && block.hours) {
                    if (!subjectTime[block.subject]) {
                        subjectTime[block.subject] = 0;
                    }
                    subjectTime[block.subject] += block.hours;
                }
            });

            // 2. Add estimated time from timer (distribute evenly if multiple subjects active)
            const timerHours = studyData.timer.seconds / 3600;
            const activeSubjects = studyData.subjects.filter(s => {
                const progress = (s.completed / s.total) * 100;
                return progress > 0 && progress < 100;
            });

            if (activeSubjects.length > 0 && timerHours > 0) {
                const hoursPerSubject = timerHours / activeSubjects.length;
                activeSubjects.forEach(subject => {
                    if (!subjectTime[subject.name]) {
                        subjectTime[subject.name] = 0;
                    }
                    subjectTime[subject.name] += hoursPerSubject;
                });
            }

            // 3. Add estimated time from progress (rough estimate: 0.5h per 10 problems completed)
            studyData.subjects.forEach(subject => {
                if (subject.completed > 0 && subjectTime[subject.name] === 0) {
                    // Estimate based on completed problems
                    subjectTime[subject.name] = (subject.completed / 10) * 0.5;
                }
            });

            // 4. OVERRIDE with manual time if set (this takes precedence)
            Object.keys(studyData.manualSubjectTime).forEach(subjectName => {
                const manualTime = studyData.manualSubjectTime[subjectName];
                if (manualTime !== null && manualTime !== undefined && manualTime >= 0) {
                    subjectTime[subjectName] = manualTime;
                }
            });

            // Sort based on current settings
            let sortedSubjects = Object.entries(subjectTime);
            if (chartSettings.subjectSort === 'time') {
                sortedSubjects.sort((a, b) => b[1] - a[1]);
            } else {
                sortedSubjects.sort((a, b) => a[0].localeCompare(b[0]));
            }
            sortedSubjects = sortedSubjects.slice(0, 8); // Show top 8

            if (sortedSubjects.length === 0 || sortedSubjects.every(([_, time]) => time === 0)) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">?숈뒿 ?곗씠?곕? 異붽??섎㈃ 怨쇰ぉ蹂??쒓컙???쒖떆?⑸땲??/div>';
                return;
            }

            const totalTime = sortedSubjects.reduce((sum, [_, time]) => sum + time, 0);
            const maxTime = Math.max(...sortedSubjects.map(([_, time]) => time), 1);

            // Add max value indicator at top of chart
            const maxIndicator = document.createElement('div');
            maxIndicator.style.cssText = 'text-align: right; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; padding: 4px 8px; background: var(--bg-secondary); border-radius: 4px; display: inline-block; float: right;';
            maxIndicator.innerHTML = `?뱤 理쒕?媛? <strong>${Math.round(maxTime * 10) / 10}?쒓컙</strong>`;
            maxIndicator.title = '李⑦듃??媛???믪? 留됰?媛 ??媛믪쓣 ?섑??낅땲??;
            container.appendChild(maxIndicator);

            // Clear float
            const clearDiv = document.createElement('div');
            clearDiv.style.clear = 'both';
            container.appendChild(clearDiv);

            sortedSubjects.forEach(([subjectName, timeSpent], idx) => {
                const hours = Math.round(timeSpent * 10) / 10;
                const percentage = ((timeSpent / totalTime) * 100).toFixed(1);

                // Ensure minimum 15% height for visibility
                const rawHeight = (timeSpent / maxTime) * 100;
                const height = Math.max(Math.min(rawHeight, 100), 15);
                const isSmallBar = height < 30;

                // Debug logging for chart rendering
                console.log(`[Chart] Rendering ${subjectName}: ${hours}h (${percentage}%), height: ${height}%`);

                const barItem = document.createElement('div');
                barItem.className = 'bar-item';

                const bar = document.createElement('div');
                bar.className = 'bar';
                // Start with minimum visible height for immediate feedback
                bar.style.height = '5%';
                // Use fallback gradient colors for cross-browser compatibility
                bar.style.background = 'linear-gradient(to top, #3182CE, #48BB78)';
                bar.style.background = 'linear-gradient(to top, var(--accent-color, #3182CE), var(--success-color, #48BB78))';
                bar.setAttribute('tabindex', '0');
                bar.setAttribute('role', 'graphics-symbol');
                bar.setAttribute('aria-label', `${subjectName}: ${hours}?쒓컙 (${percentage}%)`);

                if (isSmallBar) {
                    bar.setAttribute('data-small', 'true');
                }

                // Animate to final height with requestAnimationFrame for better performance
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        bar.style.height = height + '%';
                        console.log(`[Chart] Animated ${subjectName} to ${height}%`);
                    }, idx * 50);
                });

                // Display based on current view - enhanced for better usability
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                // Show both hours and percentage for maximum clarity
                if (chartSettings.subjectView === 'hours') {
                    barValue.innerHTML = `<strong>${hours}h</strong><br><small style="font-size: 0.7em; opacity: 0.8;">${percentage}%</small>`;
                } else {
                    barValue.innerHTML = `<strong>${percentage}%</strong><br><small style="font-size: 0.7em; opacity: 0.8;">${hours}h</small>`;
                }

                bar.appendChild(barValue);

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.justifyContent = 'center';
                label.style.gap = '4px';
                label.style.flexWrap = 'wrap';

                const labelText = document.createElement('span');
                labelText.textContent = subjectName.replace(' (2李?', '').substring(0, 8);
                labelText.title = subjectName;
                label.appendChild(labelText);

                // Add edit button for manual time adjustment
                const editBtn = document.createElement('button');
                editBtn.textContent = '?륅툘';
                editBtn.className = 'bar-edit-btn';
                editBtn.style.cssText = 'background: var(--accent-color); border: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; font-size: 0.75rem; color: white; margin-left: 4px;';
                editBtn.title = '?쒓컙 吏곸젒 ?섏젙';
                editBtn.onclick = (e) => {
                    e.stopPropagation();
                    editSubjectTime(subjectName, timeSpent);
                };
                label.appendChild(editBtn);

                // Show indicator if manually edited
                const isManuallyEdited = studyData.manualSubjectTime && studyData.manualSubjectTime[subjectName] !== undefined;
                if (isManuallyEdited) {
                    const manualIndicator = document.createElement('span');
                    manualIndicator.textContent = '?뱷';
                    manualIndicator.title = '?섎룞?쇰줈 ?몄쭛???쒓컙';
                    manualIndicator.style.fontSize = '0.7rem';
                    manualIndicator.style.marginLeft = '2px';
                    label.appendChild(manualIndicator);
                }

                // Add interactive tooltip
                addBarTooltip(bar, {
                    subject: subjectName,
                    hours: hours,
                    percentage: percentage,
                    isManual: isManuallyEdited
                });

                // Keyboard navigation
                bar.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        showToast(`${subjectName}: ${hours}?쒓컙 (${percentage}%)`, 'info');
                    }
                });

                barItem.appendChild(bar);
                barItem.appendChild(label);
                container.appendChild(barItem);
            });

            // Update ARIA live region for screen readers
            container.setAttribute('aria-live', 'polite');
        }

        // Edit subject time manually
        function editSubjectTime(subjectName, currentTime) {
            const modal = createModal();
            const currentHours = Math.round(currentTime * 10) / 10;

            const isManuallySet = studyData.manualSubjectTime && studyData.manualSubjectTime[subjectName] !== undefined;
            const displaySource = isManuallySet ? '(?섎룞 ?낅젰??' : '(?먮룞 怨꾩궛??';

            modal.innerHTML = `
                <div class="modal-header">
                    <h2>?뱤 怨쇰ぉ蹂??숈뒿 ?쒓컙 ?몄쭛</h2>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-dark);">${subjectName}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            ?꾩옱 ?쒓컙: <strong>${currentHours}?쒓컙</strong> ${displaySource}
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="font-size: 0.95rem; margin-bottom: 10px;">?뱦 ?쒓컙 怨꾩궛 諛⑸쾿 ?ㅻ챸</h3>
                        <div style="font-size: 0.85rem; line-height: 1.6; color: var(--text-secondary); background: var(--success-bg); padding: 12px; border-radius: 6px; border-left: 3px solid var(--success-color);">
                            <strong>?먮룞 怨꾩궛 湲곗?:</strong><br>
                            1截뤴깵 <strong>?꾨즺???쒓컙 釉붾줉</strong>: ?숈뒿 ?꾨왂?먯꽌 ?꾨즺???쒓컙<br>
                            2截뤴깵 <strong>??대㉧ ?ъ슜 ?쒓컙</strong>: ?꾩껜 ??대㉧ ?쒓컙??吏꾪뻾 以묒씤 怨쇰ぉ??洹좊벑 遺꾨같<br>
                            3截뤴깵 <strong>吏꾨룄 湲곕컲 異붿젙</strong>: 臾몄젣 10媛쒕떦 0.5?쒓컙?쇰줈 異붿젙<br><br>
                            <strong style="color: var(--accent-color);">?뮕 ?섎룞?쇰줈 ?쒓컙???낅젰?섎㈃ ???먮룞 怨꾩궛媛믪쓣 ??뼱?곷땲??</strong>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">?숈뒿 ?쒓컙 (?쒓컙)</label>
                        <input type="number"
                               id="manual-subject-time-input"
                               class="form-input"
                               value="${currentHours}"
                               min="0"
                               max="1000"
                               step="0.5"
                               placeholder="?? 15.5"
                               style="font-size: 1.1rem; font-weight: 600;">
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                            ?뚯닔?????먮━源뚯? ?낅젰 媛??(?? 12.5?쒓컙)
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    ${isManuallySet ? `
                        <button class="btn-secondary" onclick="resetSubjectTime('${subjectName}')">
                            ?먮룞 怨꾩궛?쇰줈 ?섎룎由ш린
                        </button>
                    ` : ''}
                    <button class="btn-secondary" onclick="closeModal()">痍⑥냼</button>
                    <button class="btn-primary" onclick="saveSubjectTime('${subjectName}')">???/button>
                </div>
            `;

            document.body.appendChild(modal);
            setTimeout(() => {
                modal.classList.add('show');
                document.getElementById('manual-subject-time-input').focus();
            }, 10);
        }

        // Save manually entered subject time
        function saveSubjectTime(subjectName) {
            const input = document.getElementById('manual-subject-time-input');
            const hours = parseFloat(input.value);

            if (isNaN(hours) || hours < 0) {
                showToast('?좏슚???쒓컙???낅젰?댁＜?몄슂 (0 ?댁긽)', 'error');
                return;
            }

            if (hours > 1000) {
                showToast('?쒓컙???덈Т ?쎈땲??(理쒕? 1000?쒓컙)', 'error');
                return;
            }

            // Save to manualSubjectTime
            studyData.manualSubjectTime[subjectName] = hours;
            saveData();

            closeModal();
            renderSubjectTimeChart();
            renderMockScoreChart();
            renderAnalytics();

            showToast(`${subjectName} ?숈뒿 ?쒓컙??${hours}?쒓컙?쇰줈 ?ㅼ젙?섏뿀?듬땲??, 'success');
        }

        // Reset subject time to auto-calculation
        function resetSubjectTime(subjectName) {
            if (confirm(`${subjectName}???섎룞 ?낅젰 ?쒓컙????젣?섍퀬 ?먮룞 怨꾩궛?쇰줈 ?섎룎由ъ떆寃좎뒿?덇퉴?`)) {
                delete studyData.manualSubjectTime[subjectName];
                saveData();

                closeModal();
                renderSubjectTimeChart();
                renderMockScoreChart();
                renderAnalytics();

                showToast(`${subjectName} ?쒓컙???먮룞 怨꾩궛?쇰줈 蹂寃쎈릺?덉뒿?덈떎`, 'success');
            }
        }

        // Tooltip functionality
        function addBarTooltip(bar, data) {
            let tooltip = null;

            const showTooltip = (e) => {
                tooltip = document.createElement('div');
                tooltip.className = 'bar-tooltip';
                tooltip.innerHTML = `
                    <strong>${data.subject}</strong>
                    <div class="bar-tooltip-row">
                        <span>?숈뒿 ?쒓컙:</span>
                        <span>${data.hours}?쒓컙</span>
                    </div>
                    <div class="bar-tooltip-row">
                        <span>?꾩껜 鍮꾩쑉:</span>
                        <span>${data.percentage}%</span>
                    </div>
                    ${data.isManual ? `
                        <div class="bar-tooltip-row" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); color: var(--warning-color); font-size: 0.85em;">
                            <span>?뱷 ?섎룞?쇰줈 ?몄쭛???쒓컙</span>
                        </div>
                    ` : ''}
                `;
                document.body.appendChild(tooltip);
                positionTooltip(tooltip, bar);
            };

            const hideTooltip = () => {
                if (tooltip) {
                    tooltip.remove();
                    tooltip = null;
                }
            };

            bar.addEventListener('mouseenter', showTooltip);
            bar.addEventListener('mouseleave', hideTooltip);
            bar.addEventListener('focus', showTooltip);
            bar.addEventListener('blur', hideTooltip);
        }

        function positionTooltip(tooltip, element) {
            const rect = element.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();

            let top = rect.top - tooltipRect.height - 10;
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);

            // Keep tooltip in viewport
            if (top < 0) {
                top = rect.bottom + 10;
            }
            if (left < 0) {
                left = 10;
            }
            if (left + tooltipRect.width > window.innerWidth) {
                left = window.innerWidth - tooltipRect.width - 10;
            }

            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
        }

        
        function renderMockScoreChart() {
            const container = document.getElementById('mock-score-chart');
            container.innerHTML = '';

            if (!studyData.mockScores || studyData.mockScores.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">紐⑥쓽怨좎궗 ?먯닔瑜?異붽??댁＜?몄슂</div>';
                return;
            }

            // Show most recent scores (up to 10)
            const recentScores = studyData.mockScores.slice(-10);
            const maxScore = 100;

            recentScores.forEach((score, idx) => {
                // Ensure minimum 10% height for visibility
                const rawHeight = (score.score / maxScore) * 100;
                const height = Math.max(rawHeight, 10);
                const isSmallBar = height < 30;

                const barItem = document.createElement('div');
                barItem.className = 'bar-item';

                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = '0%'; // Start at 0 for animation

                // Color based on pass/fail (60% passing grade)
                if (score.score >= 60) {
                    bar.style.background = 'linear-gradient(to top, var(--success-color), #34D399)';
                } else if (score.score >= 40) {
                    bar.style.background = 'linear-gradient(to top, #F59E0B, #FCD34D)';
                } else {
                    bar.style.background = 'linear-gradient(to top, var(--danger-color), #F87171)';
                }

                if (isSmallBar) {
                    bar.setAttribute('data-small', 'true');
                }

                // Animate to final height with stagger effect
                setTimeout(() => {
                    bar.style.height = height + '%';
                }, idx * 80);

                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = score.score + '??;

                bar.appendChild(barValue);

                const label = document.createElement('div');
                label.className = 'bar-label';
                // Show date in MM/DD format
                const dateStr = score.date.substring(5); // Remove year
                label.textContent = dateStr;
                label.title = score.date + ' - ' + score.score + '??; // Full info on hover

                barItem.appendChild(bar);
                barItem.appendChild(label);
                container.appendChild(barItem);
            });

            // Add trend indicator if there are at least 2 scores
            if (recentScores.length >= 2) {
                const lastScore = recentScores[recentScores.length - 1].score;
                const prevScore = recentScores[recentScores.length - 2].score;
                const trend = lastScore - prevScore;

                const trendDiv = document.createElement('div');
                trendDiv.style.cssText = 'text-align: center; margin-top: 15px; font-size: 0.85rem; font-weight: 500;';

                if (trend > 0) {
                    trendDiv.style.color = 'var(--success-color)';
                    trendDiv.textContent = '???댁쟾 ?鍮?+' + trend + '???곸듅';
                } else if (trend < 0) {
                    trendDiv.style.color = 'var(--danger-color)';
                    trendDiv.textContent = '???댁쟾 ?鍮?' + trend + '???섎씫';
                } else {
                    trendDiv.style.color = 'var(--text-secondary)';
                    trendDiv.textContent = '???댁쟾怨??숈씪';
                }

                container.appendChild(trendDiv);
            }
        }


        // ===== ?덈줈??湲곕뒫: 紐⑺몴 ?ㅼ젙 & 留덉씪?ㅽ넠 =====
        function renderGoals() {
            const container = document.getElementById('goals-container');
            container.innerHTML = '';

            if (!studyData.goals) studyData.goals = [];

            if (studyData.goals.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">紐⑺몴瑜??ㅼ젙?섏뿬 ?숈뒿 ?숆린瑜??믪씠?몄슂! ?렞</div>';
                return;
            }

            studyData.goals.forEach(goal => {
                const today = new Date();
                const goalDate = new Date(goal.date);
                const isAchieved = goal.progress >= 100;
                const isOverdue = goalDate < today && !isAchieved;

                const daysLeft = Math.ceil((goalDate - today) / (1000 * 60 * 60 * 24));
                const daysText = isOverdue ? `${Math.abs(daysLeft)}??寃쎄낵` : `${daysLeft}???⑥쓬`;

                const div = document.createElement('div');
                div.className = `goal-item ${isAchieved ? 'achieved' : ''}`;

                div.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${isAchieved ? '??' : ''}${goal.title}</div>
                        <div class="goal-date" style="color: ${isOverdue ? 'var(--danger)' : 'var(--text-secondary)'}">${daysText}</div>
                        <div class="goal-actions">
                            <button class="goal-btn" onclick="editGoal(${goal.id})">?륅툘</button>
                            <button class="goal-btn" onclick="deleteGoal(${goal.id})">?뿊截?/button>
                        </div>
                    </div>
                    <div class="goal-progress-bar">
                        <div class="goal-progress-fill" style="width: ${Math.min(goal.progress, 100)}%"></div>
                    </div>
                    <div style="text-align: right; font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                        ${goal.progress}% ?꾨즺
                    </div>
                `;

                container.appendChild(div);
            });
        }

        let editingGoalId = null;

        function addGoal() {
            document.getElementById('goalTitle').value = '';
            document.getElementById('goalDate').value = '';
            document.getElementById('goalProgress').value = '0';
            document.getElementById('goalModal').classList.add('show');
        }

        function saveGoal() {
            const title = document.getElementById('goalTitle').value;
            const date = document.getElementById('goalDate').value;
            const progress = parseInt(document.getElementById('goalProgress').value) || 0;

            if (title && date) {
                if (!studyData.goals) studyData.goals = [];

                if (editingGoalId) {
                    // ?섏젙 紐⑤뱶
                    const goal = studyData.goals.find(g => g.id === editingGoalId);
                    if (goal) {
                        goal.title = title;
                        goal.date = date;
                        goal.progress = Math.min(progress, 100);
                        showToast('紐⑺몴媛 ?섏젙?섏뿀?듬땲??);
                    }
                    editingGoalId = null;
                } else {
                    // 異붽? 紐⑤뱶
                    studyData.goals.push({
                        id: Date.now(),
                        title,
                        date,
                        progress: Math.min(progress, 100),
                        createdAt: new Date().toISOString()
                    });
                    showToast('紐⑺몴媛 異붽??섏뿀?듬땲???렞');
                }

                saveData();
                renderGoals();
                closeModal('goalModal');

                // Reset form and title
                document.getElementById('goalTitle').value = '';
                document.getElementById('goalDate').value = '';
                document.getElementById('goalProgress').value = '0';
                document.querySelector('#goalModal .modal-title').textContent = '?숈뒿 紐⑺몴 異붽?';
            } else {
                showToast('紐⑺몴 ?댁슜怨??좎쭨瑜??낅젰?댁＜?몄슂', 'error');
            }
        }

        function editGoal(id) {
            const goal = studyData.goals.find(g => g.id === id);
            if (goal) {
                editingGoalId = id;
                document.getElementById('goalTitle').value = goal.title;
                document.getElementById('goalDate').value = goal.date;
                document.getElementById('goalProgress').value = goal.progress;
                document.querySelector('#goalModal .modal-title').textContent = '?숈뒿 紐⑺몴 ?섏젙';
                document.getElementById('goalModal').classList.add('show');
            }
        }

        function deleteGoal(id) {
            showConfirm('?뺣쭚 ??젣?섏떆寃좎뒿?덇퉴?', () => {
                studyData.goals = studyData.goals.filter(g => g.id !== id);
                saveData();
                renderGoals();
                showToast('??젣?섏뿀?듬땲??);
            });
        }


        // ===== ?좏떥由ы떚: ?묒쓣 ???덈뒗 ?뱀뀡 =====
        function toggleCollapse(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('-section', '-icon'));

            section.classList.toggle('collapsed');
            icon.classList.toggle('collapsed');
        }

        // ===== ?곗씠??Import/Export 湲곕뒫 =====

        /**
         * 紐⑤뱺 ?숈뒿 ?곗씠?곕? JSON ?뚯씪濡??대낫?닿린
         */
        function exportData() {
            try {
                // ?대낫???곗씠??以鍮?(誘쇨컧???뺣낫 ?쒖쇅, 遺덊븘?뷀븳 ?꾨뱶 ?쒓굅)
                const exportData = {
                    version: '2.5.2',
                    exportDate: new Date().toISOString(),
                    data: {
                        examType: studyData.examType,
                        examDates: studyData.examDates,
                        subjects1st: studyData.subjects1st,
                        subjects2nd: studyData.subjects2nd,
                        timeBlocks: studyData.timeBlocks,
                        mockScores: studyData.mockScores,
                        weeklyHours: studyData.weeklyHours,
                        notes: studyData.notes,
                        streak: studyData.streak,
                        goals: studyData.goals,
                        subjectTimeSpent: studyData.subjectTimeSpent,
                        studyHistory: studyData.studyHistory
                    }
                };

                // JSON?쇰줈 蹂??                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                // ?뚯씪 ?ㅼ슫濡쒕뱶
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;

                // ?뚯씪紐? study-data-YYYY-MM-DD.json
                const today = new Date().toISOString().split('T')[0];
                link.download = `study-data-${today}.json`;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // 硫붾え由??뺣━
                URL.revokeObjectURL(url);

                showToast('?곗씠?곌? ?깃났?곸쑝濡??대낫?댁죱?듬땲??, 'success');
                console.log('Data exported successfully');

            } catch (error) {
                console.error('Export error:', error);
                showToast('?곗씠???대낫?닿린 以??ㅻ쪟媛 諛쒖깮?덉뒿?덈떎', 'error');
            }
        }

        /**
         * JSON ?뚯씪?먯꽌 ?숈뒿 ?곗씠??媛?몄삤湲?         */
        let pendingImportData = null;

        function importData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ?뚯씪 ?뺤옣??寃利?            if (!file.name.endsWith('.json')) {
                showToast('JSON ?뚯씪留?媛?몄삱 ???덉뒿?덈떎', 'error');
                event.target.value = ''; // ?뚯씪 ?좏깮 珥덇린??                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    // JSON ?뚯떛
                    const importedData = JSON.parse(e.target.result);

                    // ?곗씠??援ъ“ 寃利?                    if (!validateImportData(importedData)) {
                        showToast('?щ컮瑜댁? ?딆? ?뚯씪 ?뺤떇?낅땲??, 'error');
                        event.target.value = '';
                        return;
                    }

                    // ?꾩떆濡???ν븯怨??뺤씤 紐⑤떖 ?쒖떆
                    pendingImportData = importedData.data;
                    showImportPreview(importedData);

                } catch (error) {
                    console.error('Import parsing error:', error);
                    showToast('?뚯씪???쎌쓣 ???놁뒿?덈떎. ?щ컮瑜?JSON ?뚯씪?몄? ?뺤씤?섏꽭??', 'error');
                    event.target.value = '';
                }
            };

            reader.onerror = function() {
                showToast('?뚯씪 ?쎄린 以??ㅻ쪟媛 諛쒖깮?덉뒿?덈떎', 'error');
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        /**
         * 媛?몄삩 ?곗씠?곗쓽 ?좏슚??寃利?         */
        function validateImportData(data) {
            try {
                // ?꾩닔 援ъ“ 寃利?                if (!data || typeof data !== 'object') {
                    console.error('Invalid data structure: not an object');
                    return false;
                }

                if (!data.data || typeof data.data !== 'object') {
                    console.error('Invalid data structure: missing data property');
                    return false;
                }

                const d = data.data;

                // ?꾩닔 諛곗뿴 ?꾨뱶 寃利?                const requiredArrays = ['subjects1st', 'subjects2nd'];
                for (const field of requiredArrays) {
                    if (!Array.isArray(d[field])) {
                        console.error(`Invalid data structure: ${field} is not an array`);
                        return false;
                    }
                }

                // ?좏깮??諛곗뿴 ?꾨뱶 寃利?(?놁쑝硫?鍮?諛곗뿴濡?珥덇린??
                const optionalArrays = ['timeBlocks', 'mockScores', 'goals', 'studyHistory'];
                for (const field of optionalArrays) {
                    if (d[field] !== undefined && !Array.isArray(d[field])) {
                        console.error(`Invalid data structure: ${field} is not an array`);
                        return false;
                    }
                }

                // 怨쇰ぉ ?곗씠??寃利?                if (d.subjects1st.length === 0) {
                    console.error('Invalid data: subjects1st is empty');
                    return false;
                }

                // 湲곕낯 援ъ“媛 ?щ컮瑜몄? ?뺤씤
                const sample = d.subjects1st[0];
                if (!sample.name || typeof sample.total !== 'number' || typeof sample.completed !== 'number') {
                    console.error('Invalid subject structure');
                    return false;
                }

                console.log('Data validation passed');
                return true;

            } catch (error) {
                console.error('Validation error:', error);
                return false;
            }
        }

        /**
         * 媛?몄삱 ?곗씠??誘몃━蹂닿린 ?쒖떆
         */
        function showImportPreview(importedData) {
            const previewContainer = document.getElementById('importPreviewContainer');
            const data = importedData.data;

            // 誘몃━蹂닿린 HTML ?앹꽦
            let previewHTML = '<h4 style="margin-bottom: 15px; color: var(--primary-dark);">媛?몄삱 ?곗씠??誘몃━蹂닿린</h4>';

            // ?뚯씪 ?뺣낫
            if (importedData.version) {
                previewHTML += `
                    <div class="import-preview-item">
                        <span class="import-preview-label">?뚯씪 踰꾩쟾</span>
                        <span class="import-preview-value">${importedData.version}</span>
                    </div>
                `;
            }

            if (importedData.exportDate) {
                const exportDate = new Date(importedData.exportDate);
                previewHTML += `
                    <div class="import-preview-item">
                        <span class="import-preview-label">?대낫???좎쭨</span>
                        <span class="import-preview-value">${exportDate.toLocaleDateString('ko-KR')}</span>
                    </div>
                `;
            }

            // ?곗씠???듦퀎
            previewHTML += `
                <div class="import-preview-item">
                    <span class="import-preview-label">1李?怨쇰ぉ ??/span>
                    <span class="import-preview-value">${data.subjects1st?.length || 0}媛?/span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">2李?怨쇰ぉ ??/span>
                    <span class="import-preview-value">${data.subjects2nd?.length || 0}媛?/span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">?숈뒿 釉붾줉 ??/span>
                    <span class="import-preview-value">${data.timeBlocks?.length || 0}媛?/span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">紐⑥쓽怨좎궗 湲곕줉</span>
                    <span class="import-preview-value">${data.mockScores?.length || 0}媛?/span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">?숈뒿 紐⑺몴</span>
                    <span class="import-preview-value">${data.goals?.length || 0}媛?/span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">?숈뒿 ?ㅽ듃由?/span>
                    <span class="import-preview-value">${data.streak?.current || 0}???곗냽</span>
                </div>
            `;

            previewContainer.innerHTML = previewHTML;

            // ?뺤씤 踰꾪듉???대깽???몃뱾???ㅼ젙
            const confirmBtn = document.getElementById('confirmImportBtn');
            confirmBtn.onclick = function() {
                confirmImport();
            };

            // 紐⑤떖 ?쒖떆
            document.getElementById('importConfirmModal').classList.add('show');
        }

        /**
         * ?곗씠??媛?몄삤湲?理쒖쥌 ?뺤씤 諛??ㅽ뻾
         */
        function confirmImport() {
            if (!pendingImportData) {
                showToast('媛?몄삱 ?곗씠?곌? ?놁뒿?덈떎', 'error');
                closeModal('importConfirmModal');
                return;
            }

            try {
                // ?꾩옱 ?곗씠?곕? ?꾩떆濡?諛깆뾽 (?뱀떆 紐⑤? ?곹솴 ?鍮?- ?몄뀡 ?ㅽ넗由ъ???
                try {
                    sessionStorage.setItem('studyDataBackup', JSON.stringify(studyData));
                } catch (backupError) {
                    console.warn('Failed to create session backup:', backupError);
                }

                // ?곗씠??媛?몄삤湲?                const imported = pendingImportData;

                // 湲곕낯媛믨낵 蹂묓빀 (?꾨씫???꾨뱶 泥섎━)
                studyData = {
                    examType: imported.examType || '1李?,
                    examDates: imported.examDates || { '1李?: null, '2李?: null },
                    timer: {
                        seconds: 0,
                        isRunning: false,
                        interval: null
                    },
                    pomodoro: {
                        seconds: 1500,
                        isRunning: false,
                        interval: null,
                        mode: 'work',
                        completedSessions: 0
                    },
                    subjects1st: imported.subjects1st || [],
                    subjects2nd: imported.subjects2nd || [],
                    subjects: [],
                    timeBlocks: imported.timeBlocks || [],
                    mockScores: imported.mockScores || [],
                    weeklyHours: imported.weeklyHours || {},
                    notes: imported.notes || {},
                    streak: imported.streak || {
                        current: 0,
                        longest: 0,
                        lastStudyDate: null,
                        totalDays: 0
                    },
                    goals: imported.goals || [],
                    subjectTimeSpent: imported.subjectTimeSpent || {},
                    studyHistory: imported.studyHistory || []
                };

                // ?쒗뿕 ?좏삎 臾몄옄???뺢퇋??(?몄퐫???댁뒋 ?鍮?
                if (!studyData.examType || (studyData.examType + '').trim() === '') {
                    studyData.examType = '1李?;
                } else {
                    studyData.examType = (studyData.examType + '').trim().includes('2') ? '2李? : '1李?;
                }

                // ?쒗뿕 ?쇱젙 ??蹂댁젙
                if (!studyData.examDates || typeof studyData.examDates !== 'object') {
                    studyData.examDates = { '1李?: null, '2李?: null };
                }

                // 怨쇰ぉ ?ㅼ젙 ?낅뜲?댄듃
                updateSubjectsByExamType();

                // 濡쒖뺄 ?ㅽ넗由ъ??????                saveData();

                // 紐⑤떖 ?リ린
                closeModal('importConfirmModal');

                // ?깃났 ?좎뒪??                showToast('?곗씠?곕? ?깃났?곸쑝濡?媛?몄솕?듬땲?? ?섏씠吏瑜??덈줈怨좎묠?⑸땲??', 'success');

                // ?섏씠吏 ?덈줈怨좎묠 (紐⑤뱺 UI ?낅뜲?댄듃)
                setTimeout(() => {
                    location.reload();
                }, 1500);

                // ?꾩떆 ?곗씠???뺣━
                pendingImportData = null;

                console.log('Data imported successfully');

            } catch (error) {
                console.error('Import error:', error);
                showToast('?곗씠??媛?몄삤湲?以??ㅻ쪟媛 諛쒖깮?덉뒿?덈떎', 'error');

                // 諛깆뾽 蹂듦뎄 ?쒕룄
                try {
                    const backup = sessionStorage.getItem('studyDataBackup');
                    if (backup) {
                        studyData = JSON.parse(backup);
                        saveData();
                        showToast('?댁쟾 ?곗씠?곕줈 蹂듦뎄?섏뿀?듬땲??, 'info');
                    }
                } catch (restoreError) {
                    console.error('Failed to restore backup:', restoreError);
                }
            } finally {
                // ?뚯씪 ?낅젰 珥덇린??                const fileInput = document.getElementById('importFileInput');
                if (fileInput) {
                    fileInput.value = '';
                }
            }
        }

        // ??대㉧ ?쒖옉 ???ㅽ듃由??낅뜲?댄듃
        const originalStartTimer = startTimer;
        startTimer = function() {
            originalStartTimer();
            updateStreak();
            renderAnalytics();
        };

        // ??꾨툝濡??꾨즺 ??遺꾩꽍 ?낅뜲?댄듃
        const originalToggleTimeBlock = toggleTimeBlock;
        toggleTimeBlock = function(id) {
            originalToggleTimeBlock(id);
            updateStreak();
            renderAnalytics();
        };

        // 珥덇린???ㅽ뻾
        init();

        // ===== DARK MODE FUNCTIONALITY =====
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Update icon
            const icon = document.getElementById('theme-icon');
            icon.textContent = newTheme === 'dark' ? '?截? : '?뙔';

            showToast(`${newTheme === 'dark' ? '?ㅽ겕' : '?쇱씠??} 紐⑤뱶濡??꾪솚?섏뿀?듬땲??, 'info');
        }

        // Load theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.textContent = savedTheme === 'dark' ? '?截? : '?뙔';
            }

            // Initialize chart controls
            initializeChartControls();
        });

        // Chart control event handlers
        function initializeChartControls() {
            // Subject chart sorting controls
            const sortBtns = document.querySelectorAll('[data-sort]');
            sortBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const sortType = this.getAttribute('data-sort');
                    chartSettings.subjectSort = sortType;

                    // Update active states
                    sortBtns.forEach(b => {
                        if (b.getAttribute('data-sort')) {
                            b.classList.toggle('active', b.getAttribute('data-sort') === sortType);
                        }
                    });

                    // Re-render chart
                    renderSubjectTimeChart();
                    showToast(`${sortType === 'time' ? '?쒓컙?? : '?대쫫??}?쇰줈 ?뺣젹?섏뿀?듬땲??, 'info');
                });
            });

            // Subject chart view controls
            const viewBtns = document.querySelectorAll('[data-view]');
            viewBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const viewType = this.getAttribute('data-view');
                    chartSettings.subjectView = viewType;

                    // Update active states
                    viewBtns.forEach(b => {
                        if (b.getAttribute('data-view')) {
                            b.classList.toggle('active', b.getAttribute('data-view') === viewType);
                        }
                    });

                    // Re-render chart
                    renderSubjectTimeChart();
                    showToast(`${viewType === 'hours' ? '?쒓컙' : '鍮꾩쑉'} ?⑥쐞濡??쒖떆?⑸땲??, 'info');
                });
            });
        }

        // ===== Runtime Patches: Normalize exam keys and repair D-Day/UI bindings =====
        (function(){
            function normalizeExamState() {
                try {
                    if (!window.studyData) return;
                    // Normalize examType
                    const t = (studyData.examType || '').toString().trim();
                    studyData.examType = t.includes('2') ? '2李? : '1李?;
                    // Normalize examDates keys
                    if (!studyData.examDates || typeof studyData.examDates !== 'object') {
                        studyData.examDates = { '1李?: null, '2李?: null };
                    } else {
                        const d = studyData.examDates;
                        const v1 = d['1李?] || d['1'] || d['1st'] || null;
                        const v2 = d['2李?] || d['2'] || d['2nd'] || null;
                        studyData.examDates = { '1李?: v1, '2李?: v2 };
                    }
                } catch(e) {}
            }

            // Override updateDDay with a robust version
            window.updateDDay = function updateDDayPatched(){
                normalizeExamState();
                const today = new Date();
                today.setHours(0,0,0,0);

                function updateCard(key, valueId, dateId, cardId){
                    const dateStr = studyData.examDates[key];
                    const card = document.getElementById(cardId);
                    if (!card) return;
                    if (dateStr) {
                        const target = new Date(dateStr);
                        target.setHours(0,0,0,0);
                        const diffDays = Math.ceil((target - today)/(1000*60*60*24));
                        let txt = '', cls='normal';
                        if (diffDays > 0) { txt = `D-${diffDays}`; cls = diffDays <= 30 ? 'urgent' : (diffDays <= 90 ? 'warning' : 'normal'); }
                        else if (diffDays === 0) { txt = 'D-Day'; cls='urgent'; }
                        else { txt = `D+${Math.abs(diffDays)}`; }
                        const v = document.getElementById(valueId); if (v) v.textContent = txt;
                        const d = document.getElementById(dateId); if (d) d.textContent = dateStr;
                        card.className = `dday-card ${cls}`;
                    } else {
                        const v = document.getElementById(valueId); if (v) v.textContent = 'D-?';
                        const d = document.getElementById(dateId); if (d) d.textContent = '?좎쭨 誘몄꽕??;
                        card.className = 'dday-card';
                    }
                }

                updateCard('1李?,'dday-1st-value','dday-1st-date','dday-1st-card');
                updateCard('2李?,'dday-2nd-value','dday-2nd-date','dday-2nd-card');
            };

            // Safe replacement for saveExamDate to avoid broken strings
            window.saveExamDate = function(){
                try {
                    if (typeof editingExamType === 'undefined' || !editingExamType) return;
                    const dateValue = (document.getElementById('examDateInput')||{}).value;
                    if (dateValue) {
                        if (!studyData.examDates) studyData.examDates = {};
                        studyData.examDates[editingExamType] = dateValue;
                        if (typeof saveData === 'function') saveData();
                        if (typeof updateDDay === 'function') updateDDay();
                        if (typeof closeModal === 'function') closeModal('examDateModal');
                        if (typeof showToast === 'function') showToast(`${editingExamType} ?쒗뿕 ?좎쭨媛 ?ㅼ젙?섏뿀?듬땲??, 'success');
                        editingExamType = null;
                    } else {
                        if (typeof showToast === 'function') showToast('?쒗뿕 ?좎쭨瑜??낅젰??二쇱꽭??, 'error');
                    }
                } catch(e) {
                    try { if (typeof showToast==='function') showToast('?좎쭨 ???以??ㅻ쪟媛 諛쒖깮?덉뒿?덈떎', 'error'); } catch(_){}
                }
            };

            function adjustDDayDom(){
                const c1 = document.getElementById('dday-1st-card');
                const c2 = document.getElementById('dday-2nd-card');
                if (c1) c1.onclick = function(){ editExamDate('1李?); };
                if (c2) c2.onclick = function(){ editExamDate('2李?); };
                const d1 = document.getElementById('dday-1st-date'); if (d1 && !d1.textContent) d1.textContent = '?좎쭨 誘몄꽕??;
                const d2 = document.getElementById('dday-2nd-date'); if (d2 && !d2.textContent) d2.textContent = '?좎쭨 誘몄꽕??;
                const btns = document.getElementsByClassName('dday-edit-btn');
                if (btns && btns.length>=2){
                    if (btns[0]) { btns[0].textContent = '?좎쭨 ?ㅼ젙'; btns[0].onclick = function(e){ e.stopPropagation(); editExamDate('1李?); }; }
                    if (btns[1]) { btns[1].textContent = '?좎쭨 ?ㅼ젙'; btns[1].onclick = function(e){ e.stopPropagation(); editExamDate('2李?); }; }
                }
            }

            function adjustModeButtons(){
                const sel = document.querySelector('.study-mode-selector');
                if (!sel) return;
                const btns = sel.querySelectorAll('button');
                if (btns[0]) { btns[0].textContent = '1李??쒗뿕'; btns[0].onclick = function(){ setExamType('1李?); }; }
                if (btns[1]) { btns[1].textContent = '2李??쒗뿕'; btns[1].onclick = function(){ setExamType('2李?); }; }
            }

            document.addEventListener('DOMContentLoaded', function(){
                normalizeExamState();
                adjustDDayDom();
                adjustModeButtons();
                if (typeof updateDDay === 'function') updateDDay();
                adjustUILabels();
                applyA11yEnhancements();
            });
        })(            function adjustUILabels(){
                try {
                    // Header title
                    const titleEl = document.querySelector('.title');
                    if (titleEl) titleEl.textContent = '법무사 시험 학습 시스템 v2.6.0';

                    // Theme icon
                    const themeIcon = document.getElementById('theme-icon');
                    if (themeIcon && document.documentElement.getAttribute('data-theme') === 'dark') themeIcon.textContent = '🌙';
                    else if (themeIcon) themeIcon.textContent = '☀️';

                    // Chart titles
                    const subjTitle = document.getElementById('subject-chart-title');
                    if (subjTitle) subjTitle.textContent = '과목별 학습 시간 분포';
                    const mockTitle = document.getElementById('mock-chart-title');
                    if (mockTitle) mockTitle.textContent = '모의고사 점수 추이';

                    // Analytics card header (find title by icon id)
                    const analyticsIcon = document.getElementById('analytics-icon');
                    if (analyticsIcon && analyticsIcon.parentElement) {
                        const h2 = analyticsIcon.parentElement.querySelector('.card-title');
                        if (h2) h2.textContent = '학습 분석 대시보드';
                    }

                    // Card titles by nearby container IDs
                    function setCardTitleByContainerId(containerId, text){
                        const c = document.getElementById(containerId);
                        if (!c) return;
                        let parent = c.closest('.card');
                        if (!parent) parent = c.parentElement;
                        const t = parent ? parent.querySelector('.card-title') : null;
                        if (t) t.textContent = text;
                    }
                    setCardTitleByContainerId('goals-container','학습 목표');
                    setCardTitleByContainerId('subject-progress','과목별 진도 현황');
                    setCardTitleByContainerId('mock-scores','모의고사 점수');
                    setCardTitleByContainerId('time-blocks-container','오늘 학습 계획');

                    // Notes section title
                    const notes = document.getElementById('study-notes');
                    if (notes) {
                        const notesCard = notes.closest('.card');
                        const title = notesCard ? notesCard.querySelector('.card-title') : null;
                        if (title) title.textContent = '오늘 학습 노트';
                    }

                    // Data management title
                    const dm = document.querySelector('.data-management-card .card-title');
                    if (dm) dm.textContent = '데이터 관리';
                } catch(e) {}
            }

            function applyA11yEnhancements(){
                try {
                    // Theme toggle
                    const themeToggle = document.querySelector('.theme-toggle');
                    if (themeToggle) themeToggle.setAttribute('aria-label','테마 전환');

                    // Icon-only action buttons
                    document.querySelectorAll('.action-btn').forEach((btn)=>{
                        if (!btn.getAttribute('aria-label')) btn.setAttribute('aria-label','작업');
                    });
                    document.querySelectorAll('.score-action-btn').forEach((btn)=>{
                        if (btn.textContent.includes('✏') || btn.textContent.includes('편')) btn.setAttribute('aria-label','편집');
                        else btn.setAttribute('aria-label','삭제');
                    });
                    document.querySelectorAll('.goal-btn').forEach((btn)=>{
                        if (btn.textContent.includes('✏') || btn.textContent.includes('편')) btn.setAttribute('aria-label','목표 편집');
                        else btn.setAttribute('aria-label','목표 삭제');
                    });

                    // Bars focusable (if not already)
                    document.querySelectorAll('.bar').forEach((bar)=>{
                        if (!bar.hasAttribute('tabindex')) bar.setAttribute('tabindex','0');
                    });
                } catch(e) {}
            })();

    </script>
</body>
</html>

