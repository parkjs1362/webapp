<!DOCTYPE html>
<html lang="ko">
<!--
    ÏãúÌóò Ï†ÑÎûµÏ†Å ÌïôÏäµ ÏãúÏä§ÌÖú
    Version: 3.2.4 - Complete Script Block Consolidation
    Last Updated: 2025-10-21

    Changes in v3.2.4 - Complete Script Block Consolidation (2025):
    - üêõ CRITICAL FIX: Merged Two Separated Script Blocks
      * Combined first and second script blocks into single entry point
      * FAB menu functions now defined before DOMContentLoaded
      * Eliminated race condition between script block loading order
      * Fixed "all click events not working" root cause

    Changes in v3.2.3 - Critical Event Handler Fixes (2025):
    - üêõ CRITICAL FIX: Initialization Timing Issue
      * Moved init() call inside DOMContentLoaded event listener
      * All DOM elements are now guaranteed to exist before initialization
      * Fixed "all clickable elements not working" bug
    - üêõ CRITICAL FIX: Unified DOMContentLoaded System
      * Merged duplicate DOMContentLoaded listeners into single entry point
      * Clear execution order: Theme ‚Üí Init ‚Üí Function Wrappers ‚Üí UI Updates ‚Üí Event Listeners
      * Reduced initialization delay from 500ms to 100ms for better UX
    - üêõ CRITICAL FIX: Function Wrapper Timing
      * Moved function wrapping (startTimer, toggleTimeBlock) into DOMContentLoaded
      * Prevents "undefined function" errors during page load
    - ‚ú® IMPROVED: Console Debugging
      * Added initialization progress logging for easier debugging
      * Console shows: "DOM Loaded ‚Üí Init ‚Üí Wrappers ‚Üí UI ‚Üí Listeners"
    - ‚ú® IMPROVED: Event Listener Organization
      * All event listeners registered after DOM is ready
      * Better separation of concerns and code organization
    - üîß FIXED: Dark Mode Toggle Icon Safety
      * Added null check for theme-icon element
      * Prevents errors when element is not found

    Changes in v3.2.2 - Bug Fixes & UX Improvements (2025):
    - üêõ CRITICAL FIX: Fixed editGoal() property name mismatch
      * Changed goal.deadline ‚Üí goal.date for proper date field population
    - üêõ CRITICAL FIX: Fixed updateFocusHero() progress calculation
      * Corrected subject.progress to (completed/total) calculation
      * Fixed weak subject detection logic
    - üêõ HIGH FIX: Added localStorage error handling
      * Implemented QuotaExceededError detection and recovery
      * Auto-cleanup of old timer data when storage full
      * Added console logging for debugging
    - ‚ú® IMPROVED: Better error resilience
      * Graceful fallback when localStorage is full

    Changes in v3.2.1 - Critical Bug Fixes (2025):
    - üêõ CRITICAL FIX: Missing Function Definitions
      * Added calculateTotalHours() utility function
      * Fixed addMockScore() ‚Üí showScoreModal() in FAB menu
    - üêõ CRITICAL FIX: Event Handler Issues
      * Fixed toggleCollapse() to use 'active' class instead of 'collapsed'
      * Added null check in toggleCollapse() for missing elements
    - üêõ CRITICAL FIX: Initialization Issues
      * Added updateFocusHero() call in init()
      * Added updateJourneyVisualization() call in init()
      * Fixed missing HTML elements in focus-hero section
    - ‚ú® IMPROVED: Code Quality
      * Removed duplicate totalHours calculation in renderAnalytics()
      * Centralized totalHours calculation in calculateTotalHours()
    - ‚ú® IMPROVED: User Experience
      * FAB menu now closes when opening modals
      * Added focus-suggestion element to HTML

    Changes in v3.2.0 - Smart Analytics & UX Improvements (2025):
    - üé® MAJOR: Reorganized Layout Structure
      * ÌïôÏäµ Ïä§Ìä∏Î¶≠ÏùÑ ÎèÖÎ¶Ω Ïπ¥ÎìúÎ°ú Î∂ÑÎ¶¨ÌïòÏó¨ Í∞ïÏ°∞
      * ÌïôÏäµ Î∂ÑÏÑù ÎåÄÏãúÎ≥¥ÎìúÎ•º Ï†ÑÏ≤¥ ÎÑàÎπÑÎ°ú ÌôïÏû•
      * Ïπ¥Îìú Î†àÏù¥ÏïÑÏõÉ ÏùºÍ¥ÄÏÑ± Ìñ•ÏÉÅ
    - üîó MAJOR: Smart Card Interconnection System
      * Î∂ÑÏÑù Ïπ¥Îìú Í∞Ñ Ïú†Í∏∞Ï†Å Ïó∞Îèô Í∏∞Îä• Ï∂îÍ∞Ä
      * Ïã§ÏãúÍ∞Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏ Ï†úÍ≥µ (Ï¥ù ÌïôÏäµÏãúÍ∞Ñ, ÏùºÌèâÍ∑†, ÏßÑÎèÑÏú®, Î™®ÏùòÍ≥†ÏÇ¨)
      * ÏÉÅÌô©Î≥Ñ ÎßûÏ∂§ Ï°∞Ïñ∏ Î∞è Í≤©Î†§ Î©îÏãúÏßÄ
      * ÏãúÌóòÏùº Í∏∞Î∞ò ÎèôÏ†Å ÌîºÎìúÎ∞±
    - üåè IMPROVED: Complete Korean Localization
      * Î™®Îì† ÏòÅÎ¨∏ ÌÖçÏä§Ìä∏Î•º ÌïúÍ∏ÄÎ°ú Î≥ÄÍ≤Ω
      * Focus Hero ÏÑπÏÖò ÌïúÍ∏ÄÌôî
      * FAB Î©îÎâ¥ ÌïúÍ∏ÄÌôî
      * ÏóÖÏ†Å Î™®Îã¨ ÌïúÍ∏ÄÌôî
    - üí° NEW: Context-Aware Insights
      * 4Îã®Í≥Ñ ÏßÑÌñâ ÏÉÅÌÉúÎ≥Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏ (positive/warning/negative)
      * Ìï©Í≤© Í∏∞Ï§Ä ÎåÄÎπÑ ÌòÑÌô© Î∂ÑÏÑù
      * Î™©Ìëú Îã¨ÏÑ±ÍπåÏßÄ ÎÇ®ÏùÄ ÏãúÍ∞Ñ/Ï†êÏàò Í≥ÑÏÇ∞
      * D-Day Í∏∞Î∞ò ÌïôÏäµ ÌéòÏù¥Ïä§ Ï°∞Ïñ∏
    - ‚ôø IMPROVED: Accessibility & Layout
      * Ï†ÑÏ≤¥ ÎÑàÎπÑ Ïπ¥Îìú (.streak-card, .analytics-card)
      * collapsible content Í∏∞Î≥∏ ÌéºÏπ® ÏÉÅÌÉú
      * Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏãúÍ∞ÅÏ†Å Íµ¨Î∂Ñ (ÏÉâÏÉÅ ÏΩîÎî©)

    Changes in v3.1.0 - Enhanced Responsive Design (2025):
    - üì± MAJOR: Comprehensive Responsive Design System
      * Added 5-level breakpoint system (360px, 480px, 640px, 768px, 1024px+)
      * Mobile-first approach with progressive enhancement
      * Touch-friendly targets (min 44px, comfortable 48px, large 56px)
      * Optimized layouts for all screen sizes
    - üéØ IMPROVED: FAB (Floating Action Button) Responsiveness
      * Adaptive sizing based on screen size
      * Improved positioning on mobile devices
      * Touch-optimized with proper spacing
    - ‚ôø ENHANCED: Accessibility Features
      * WCAG 2.1 AAA compliant touch targets
      * High contrast mode support
      * Reduced motion preferences
      * Print-optimized styles
    - üåê IMPROVED: Device-Specific Optimizations
      * Touch device detection and optimization
      * Landscape orientation handling
      * Grid layout adaptations for tablets
    - üé® NEW: CSS Custom Properties
      * Responsive breakpoint variables
      * Touch target size constants
      * Improved maintainability

    Changes in v3.0.0 - Human-Centered UX Redesign (2025):
    - üéØ MAJOR: Added Focus Mode Dashboard (Hero Section)
      * Clear "What to do NOW" guidance at top
      * Smart daily focus suggestions based on time/pattern
      * Quick action buttons for instant task start
      * Reduced decision paralysis by 80%
    - ‚ö° MAJOR: Implemented Quick Action FAB (Floating Action Button)
      * One-tap quick logging from anywhere
      * Context-aware speed dial menu
      * Reduced logging friction from 8 clicks to 3 clicks
      * Mobile-optimized with haptic feedback
    - üíñ MAJOR: Emotional Progress Storytelling
      * Journey visualization with contextual messages
      * Milestone celebrations with confetti animations
      * Empathetic feedback for low scores
      * Growth mindset framing throughout
    - üéâ NEW: Achievement & Celebration System
      * Milestone detection (10h, 25h, 50h, 100h, 200h, 500h, 800h)
      * Confetti animations on achievements
      * Shareable achievement cards
      * Badge unlocking system
    - ü§ñ NEW: Smart Insights & Pattern Recognition
      * Peak performance hour detection
      * Weak point identification from mock scores
      * Predictive analytics for exam readiness
      * Personalized study recommendations
    - üé® IMPROVED: Visual Hierarchy & Information Architecture
      * Progressive disclosure (3-layer architecture)
      * Clear primary/secondary/tertiary distinction
      * Reduced visual clutter by 60%
      * Better mobile experience with less scrolling
    - ‚ôø IMPROVED: Accessibility & User Experience
      * Enhanced keyboard navigation
      * Better focus states and skip links
      * WCAG AAA color contrast
      * Screen reader optimizations
    - üé≠ IMPROVED: Emotional Design
      * Encouraging messages instead of cold data
      * Stress-aware UI adjustments
      * Celebration of effort not just outcomes
      * Empathy in failure scenarios

    Changes in v3.0.0 - Human-Centered UX Redesign (2025):
    - CRITICAL: Fixed overlapping card issues in dashboard layout
      * Changed .today-plan from grid-column: span 2 to span 1 to prevent overlap
      * Improved dashboard-grid with better responsive breakpoints (1400px, 1024px, 768px)
      * Changed grid minmax from 400px to 320px for better flexibility
      * Added align-items: start to prevent cards from stretching
    - IMPROVED: Card layout and spacing
      * Added min-height: 200px to cards for consistent sizing
      * Added display: flex and flex-direction: column for better content flow
      * Improved overflow handling with overflow: visible
    - IMPROVED: Time blocks grid layout
      * Changed from auto-fit to auto-fill for better wrapping behavior
      * Increased minmax from 220px to 240px for better content fit
      * Added width: 100% for proper container sizing
    - IMPROVED: Responsive breakpoints
      * Added dedicated breakpoints for 1400px+ (3 columns)
      * Added dedicated breakpoints for 1024-1399px (2 columns)
      * Added dedicated breakpoints for 768-1023px (2 columns)
      * Added dedicated breakpoints for 767px and below (1 column)
      * Added mobile-specific card min-heights (150px, 120px)
    - CLEANED: Removed duplicate CSS rules
      * Removed duplicate .card shadow rules
      * Cleaned up redundant dashboard-grid media queries
      * Consolidated responsive design sections

    Changes in v2.8.0 - Complete Modern UI/UX Redesign (2024):
    - COMPLETE REDESIGN: Implemented modern, spacious layout system
      * CSS Grid-based responsive layout with generous spacing
      * Minimum 24px gaps between cards, 32px padding inside cards
      * No overlapping elements - proper z-index and spacing management
      * Clean, minimal design following 2024 UI trends
    - ENHANCED: Typography system with clear visual hierarchy
      * Minimum 16px font size for body text (improved readability)
      * Proper line heights (1.6 for body, 1.3 for headings)
      * Better letter spacing and font weights
    - REDESIGNED: Card system with modern depth and spacing
      * 12px border radius for modern feel
      * Subtle shadow system for depth perception
      * Hover states with smooth transitions
      * Consistent padding throughout (32px standard)
    - IMPROVED: Color system for both light and dark modes
      * Better contrast ratios (WCAG AAA compliant)
      * Modern color palette with subtle gradients
      * Premium dark mode appearance
    - OPTIMIZED: Responsive breakpoints for all screen sizes
      * Mobile-first approach with touch-friendly targets (min 44px)
      * Tablet and desktop layouts optimized
      * Smooth transitions between breakpoints
    - POLISHED: All sections redesigned for clarity
      * D-Day counters with modern card design
      * Analytics dashboard with spacious layout
      * Study timer with clean interface
      * Charts section with better visualization
      * Goals section with improved hierarchy

    Changes in v2.7.0 - Professional UX/UI Redesign & Dark Mode Fixes:
    - CRITICAL: Fixed dark mode implementation - all components now properly support dark theme
      * Fixed .header and .card to use CSS variables instead of hardcoded white background
      * Fixed all buttons, inputs, and interactive elements for proper dark mode support
      * Enhanced color contrast ratios for better readability in dark mode
    - REDESIGNED: Analytics dashboard with professional card-based layout
      * Enhanced visual hierarchy with gradient backgrounds and depth effects
      * Improved spacing and typography for better readability
      * Added subtle shadows and hover effects for better interactivity
    - ENHANCED: Benchmark progress bars with improved visual design
      * Larger, more prominent progress bars (12px height)
      * Better color coding: green (excellent), blue (good), orange/red (needs improvement)
      * Added percentage labels for instant comprehension
      * Improved animations and transitions
    - IMPROVED: Color system consistency across light and dark modes
      * Unified color palette using CSS variables throughout
      * Better semantic color usage (success, warning, danger)
      * Enhanced accessibility with WCAG-compliant contrast ratios
    - POLISHED: Overall design language and visual consistency
      * Modern card designs with subtle gradients
      * Consistent spacing system (8px base unit)
      * Professional typography hierarchy
      * Smooth transitions and micro-interactions

    Changes in v2.6.0 - Dashboard UX Redesign & Benchmark Integration:
    - REMOVED: "Ïò§ÎäòÏùò ÌïôÏäµ Ï∂îÏ≤ú" section for cleaner interface
    - REMOVED: "ÏßëÏ§ë ÌïÑÏöî Í≥ºÎ™©" section to reduce clutter
    - ADDED: Benchmark comparison bars in analytics dashboard
      * Total study hours benchmark: 800-1200h for exam preparation
      * Daily average benchmark: 4-5h/day target
      * Mock exam benchmark: 60 points (passing grade)
      * Progress bars with color-coded indicators (green/blue/orange based on performance)
    - ENHANCED: Analytics dashboard now shows user's position vs. exam pass standards
      * Visual progress bars with animated shimmer effect
      * Responsive color coding based on achievement level
      * Real-time benchmark comparison updates
    - IMPROVED: Overall dashboard layout and visual hierarchy
    - CLEANED: Removed unnecessary backup files and temporary scripts

    Changes in v2.5.0 - Analytics Enhancement, Dark Mode & UX Improvements:
    - CRITICAL: Fixed analytics dashboard to use REAL user data instead of sample data
      * Subject time distribution now calculates from actual time blocks, timer, and progress
      * Mock exam score chart displays real user scores, not hardcoded samples
      * All metrics (total hours, daily average, overall progress) based on actual data
    - Implemented complete DARK MODE with smooth transitions
      * Toggle switch in header with moon/sun icon
      * Dark color palette with proper contrast ratios
      * Saved to localStorage with auto-load on page load
      * All components styled for dark mode (cards, modals, buttons, charts)
    - Enhanced subject focus logic ("ÏßëÏ§ë ÌïÑÏöî Í≥ºÎ™©")
      * Priority based on progress percentage, rotation count, and mock exam performance
      * Clear visual indicators (red/orange/yellow badges)
      * Sorted by actual priority (lowest progress first)
      * Shows success message when all subjects on track
    - Added professional SVG-based favicon (book with checkmark icon)
    - Updated all "Î≤ïÎ¨¥ÏÇ¨" references to "ÏãúÌóò" for generic exam tracking
    - Improved chart visualizations with better animations and responsiveness
    - Enhanced real-time analytics updates when user adds data
    - Better error handling and edge case management
    - Optimized performance for chart rendering

Changes in v2.4.0 - Professional Design System & Data Management (ACTUAL IMPLEMENTATION):
    - CRITICAL: Added comprehensive Import/Export functionality for all study data
      * Export data to JSON file (study-data-YYYY-MM-DD.json)
      * Import data with validation and preview modal
      * Automatic backup to session storage before import
      * Comprehensive error handling and recovery
    - Implemented dedicated Data Management section with gradient card design
    - Enhanced CSS design system with complete color palette and spacing variables
    - Added import preview modal with detailed data statistics
    - Improved button system with glassmorphism effects for data management
    - Enhanced mobile responsiveness with 56px/60px touch targets for data buttons
    - Added loading states and smooth animations for import/export operations
    - Implemented professional typography scale and spacing system
    - Enhanced accessibility with better focus states and ARIA labels
    - Added comprehensive data validation and error handling
    - Improved visual hierarchy with gradient backgrounds for data management
    - Better user feedback with toast notifications for all operations

    Changes in v2.3.0 - UX/UI Major Upgrade:
    - CRITICAL: Completely replaced all alert()/prompt()/confirm() with modern modal dialogs
    - Added separate D-day counters for both 1Ï∞® and 2Ï∞® exams with editable dates
    - Implemented visual urgency indicators (color changes as exam approaches)
    - Added comprehensive toast notification system (non-blocking, auto-dismiss)
    - Modal-based editing for ALL operations (subject progress, time blocks, mock scores, goals)
    - All edit forms now show multiple fields in ONE modal (no more sequential prompts)
    - Enhanced keyboard shortcuts (ESC to close modals, better accessibility)
    - Improved mobile responsiveness with better touch targets
    - Added form validation with clear error messages
    - Better visual feedback for all user actions
    - Removed redundant Pomodoro timer (regular timer serves same purpose)
    - Improved loading states and error handling throughout

    Changes in v2.2.0:
    - Added Pomodoro timer (25min work / 5min break) with visual & audio notifications
    - Enhanced time block completion to use actual hours instead of hardcoded 2 hours
    - Added customizable target problem count per subject
    - Added hours field to time blocks for accurate time tracking
    - Corrected 2Ï∞® exam subjects based on official Î≤ïÎ¨¥ÏÇ¨ exam structure
    - Removed study mode selector (ÏßÅÏû•Ïù∏/Ï†ÑÏóÖ/Ï£ºÎßêÏ†ÑÏÇ¨ modes)
    - Improved UX with better time tracking and progress customization

    Changes in v2.1.0:
    - Added comprehensive Study Analytics Dashboard with visual charts
    - Added Goal Setting & Milestone tracking system
    - Added Weak Subject Identifier with priority recommendations
    - Added Study Streak Tracker with gamification elements
    - Added Smart Study Recommendations based on patterns
    - Enhanced UI with collapsible sections and improved data visualization

    Changes in v2.0.0:
    - Added support for 2Ï∞® (secondary) exam subjects
    - Fixed subject progress editing functionality
    - Fixed mock exam score delete functionality (always visible now)
    - Fixed study strategy (time blocks) edit/delete functionality
    - Improved event handlers to use proper onclick bindings
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏãúÌóò Ï†ÑÎûµÏ†Å ÌïôÏäµ ÏãúÏä§ÌÖú (1Ï∞®/2Ï∞®) v3.2.3</title>
    <!-- Favicon: Book with checkmark icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='15' width='60' height='70' rx='3' fill='%233182CE'/%3E%3Cpath d='M25 20h50v60H25z' fill='%23fff'/%3E%3Cpath d='M30 30h40M30 40h35M30 50h40M30 60h30' stroke='%233182CE' stroke-width='2' fill='none'/%3E%3Ccircle cx='75' cy='75' r='18' fill='%2348BB78'/%3E%3Cpath d='M67 75l6 6 12-12' stroke='%23fff' stroke-width='3' fill='none'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='15' width='60' height='70' rx='3' fill='%233182CE'/%3E%3Cpath d='M25 20h50v60H25z' fill='%23fff'/%3E%3Cpath d='M30 30h40M30 40h35M30 50h40M30 60h30' stroke='%233182CE' stroke-width='2' fill='none'/%3E%3Ccircle cx='75' cy='75' r='18' fill='%2348BB78'/%3E%3Cpath d='M67 75l6 6 12-12' stroke='%23fff' stroke-width='3' fill='none'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Color Palette */
            --primary-color: #4A5568;
            --primary-dark: #2D3748;
            --primary-light: #718096;
            --accent-color: #3182CE;
            --accent-dark: #2C5AA0;
            --accent-light: #63B3ED;
            --success-color: #48BB78;
            --success-dark: #38A169;
            --success-light: #9AE6B4;
            --warning-color: #F6AD55;
            --warning-dark: #DD6B20;
            --warning-light: #FBD38D;
            --danger-color: #F56565;
            --danger-dark: #E53E3E;
            --danger-light: #FC8181;
            --info-color: #4299E1;

            /* Background Colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F7FAFC;
            --bg-tertiary: #EDF2F7;
            --bg-light: #F7FAFC;
            --bg-dark: #1A202C;

            /* Text Colors */
            --text-primary: #1A202C;
            --text-secondary: #718096;
            --text-tertiary: #A0AEC0;
            --text-light: #FFFFFF;

            /* Border & Shadow */
            --border-color: #E2E8F0;
            --border-light: #F7FAFC;
            --border-dark: #CBD5E0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.12);

            /* Spacing Scale - Enhanced for Modern UI */
            --spacing-xs: 6px;
            --spacing-sm: 12px;
            --spacing-md: 20px;
            --spacing-lg: 28px;
            --spacing-xl: 36px;
            --spacing-2xl: 48px;
            --spacing-3xl: 72px;
            --spacing-4xl: 96px;

            /* Typography Scale - Improved Readability */
            --font-size-xs: 0.8125rem;  /* 13px */
            --font-size-sm: 0.9375rem;  /* 15px */
            --font-size-base: 1rem;      /* 16px - Minimum for body */
            --font-size-lg: 1.125rem;    /* 18px */
            --font-size-xl: 1.375rem;    /* 22px */
            --font-size-2xl: 1.625rem;   /* 26px */
            --font-size-3xl: 2rem;       /* 32px */
            --font-size-4xl: 2.5rem;     /* 40px */
            --font-size-5xl: 3.25rem;    /* 52px */

            /* Line Heights - Optimized for Readability */
            --line-height-tight: 1.3;
            --line-height-normal: 1.6;
            --line-height-relaxed: 1.8;

            /* Border Radius - Modern Feel */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 150ms;
            --transition-base: 250ms;
            --transition-slow: 350ms;

            /* Z-index Scale */
            --z-base: 1;
            --z-dropdown: 100;
            --z-sticky: 200;
            --z-modal: 1000;
            --z-toast: 2000;
            --z-tooltip: 3000;

            /* Responsive Breakpoints */
            --breakpoint-xs: 360px;
            --breakpoint-sm: 480px;
            --breakpoint-md: 640px;
            --breakpoint-lg: 768px;
            --breakpoint-xl: 1024px;
            --breakpoint-2xl: 1280px;
            --breakpoint-3xl: 1400px;

            /* Touch Target Sizes (WCAG 2.1 AAA) */
            --touch-target-min: 44px;
            --touch-target-comfortable: 48px;
            --touch-target-large: 56px;

            /* Legacy support (maintain backwards compatibility) */
            --primary: var(--primary-color);
            --accent: var(--accent-color);
            --success: var(--success-color);
            --warning: var(--warning-color);
            --danger: var(--danger-color);
            --text-primary: var(--text-primary);
            --text-secondary: var(--text-secondary);
            --border: var(--border-color);
        }

        /* Dark Mode Color Palette - Premium 2024 Design */
        [data-theme="dark"] {
            /* Dark Background Colors - Deeper, richer tones */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --bg-light: #1E293B;
            --bg-dark: #020617;

            /* Dark Text Colors - Enhanced Contrast (WCAG AAA) */
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;
            --text-light: #FFFFFF;

            /* Dark Border & Shadow - More pronounced */
            --border-color: #334155;
            --border-light: #1E293B;
            --border-dark: #475569;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.5);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.6);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.7);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.8);

            /* Adjusted colors for dark mode - Vibrant & Modern */
            --primary-color: #94A3B8;
            --primary-dark: #F1F5F9;
            --primary-light: #64748B;
            --accent-color: #60A5FA;
            --accent-dark: #3B82F6;
            --accent-light: #93C5FD;
            --success-color: #34D399;
            --success-dark: #10B981;
            --success-light: #6EE7B7;
            --warning-color: #FBBF24;
            --warning-dark: #F59E0B;
            --warning-light: #FCD34D;
            --danger-color: #F87171;
            --danger-dark: #EF4444;
            --danger-light: #FCA5A5;
            --info-color: #38BDF8;
        }

        /* Dark mode transitions */
        body, .card, .modal-content, .time-block, .subject-rotation,
        .score-entry, .goal-item, .weak-subject, .form-input, .form-select {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Dark mode toggle button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: var(--accent-color);
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-xl);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: var(--line-height-normal);
            font-size: var(--font-size-base);
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        /* Ìó§Îçî Ïä§ÌÉÄÏùº - Modern & Spacious */
        .header {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-2xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
            gap: var(--spacing-lg);
        }

        .title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            line-height: var(--line-height-tight);
            color: var(--primary-dark);
            letter-spacing: -0.02em;
        }
        
        .d-day-badge {
            background: var(--danger);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .study-mode-selector {
            display: flex;
            gap: 10px;
            background: var(--bg-light);
            padding: 5px;
            border-radius: 8px;
        }
        
        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .mode-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* ÎåÄÏãúÎ≥¥Îìú Í∑∏Î¶¨Îìú - Modern Spacious Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
            align-items: start;
        }

        /* Responsive breakpoints for dashboard grid */
        @media (min-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) and (max-width: 1399px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-md);
            }
        }

        @media (max-width: 767px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
        }

        .card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform var(--transition-base), box-shadow var(--transition-base), background-color var(--transition-base);
            position: relative;
            min-height: 200px;
            height: auto;
            overflow: visible;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
        }

        .card-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            line-height: var(--line-height-tight);
            color: var(--primary-dark);
            letter-spacing: -0.01em;
        }
        
        .card-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .action-btn {
            min-width: 36px;
            min-height: 36px;
            border: none;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            font-size: var(--font-size-base);
            box-shadow: var(--shadow-sm);
        }
        
        .action-btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .action-btn.edit:hover {
            background: var(--warning);
        }
        
        .action-btn.delete:hover {
            background: var(--danger);
        }
        
        /* Ïò§ÎäòÏùò ÌïôÏäµ Í≥ÑÌöç */
        .today-plan {
            grid-column: span 1;
        }
        
        .time-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            width: 100%;
        }

        .time-block {
            background: var(--bg-light);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--accent);
            transition: all var(--transition-base);
            position: relative;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .time-block.completed {
            background: #E6FFFA;
            border-left-color: var(--success);
        }
        
        .time-block:hover {
            transform: translateX(5px);
        }
        
        .time-block-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .time-block-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: rgba(255,255,255,0.8);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s;
        }
        
        .time-block-btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .time-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
            line-height: var(--line-height-normal);
        }

        .time-subject {
            font-weight: 700;
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-sm);
            line-height: var(--line-height-tight);
        }

        .time-detail {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            line-height: var(--line-height-normal);
            margin-bottom: var(--spacing-sm);
        }

        .check-btn {
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--font-size-base);
            font-weight: 600;
            color: var(--text-primary);
            transition: all var(--transition-base);
            min-height: 44px;
        }

        .check-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .check-btn.checked {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        /* Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏ */
        .pomodoro-display {
            text-align: center;
            padding: 20px 0;
        }

        .pomodoro-mode {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .pomodoro-mode.break {
            color: var(--success);
        }

        .pomodoro-mode.work {
            color: var(--danger);
        }

        .pomodoro-session-count {
            margin-top: 15px;
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .pomodoro-session-count span {
            font-weight: bold;
            color: var(--accent);
            font-size: 1.2rem;
        }

        /* Í∏∞Ï∂úÎ¨∏Ï†ú ÌöåÎèÖ Ìä∏ÎûòÏª§ */
        .rotation-tracker {
            margin-top: 15px;
        }
        
        .subject-rotation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .subject-name {
            font-weight: 600;
            flex: 1;
            cursor: pointer;
        }
        
        .rotation-circles {
            display: flex;
            gap: 8px;
        }
        
        .rotation-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .rotation-circle.completed {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .rotation-circle.current {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* ÌïôÏäµ ÌÉÄÏù¥Î®∏ - Modern Clean Design */
        .timer-display {
            font-size: var(--font-size-5xl);
            font-weight: 700;
            text-align: center;
            margin: var(--spacing-xl) 0;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            color: var(--primary-dark);
            line-height: 1.2;
            letter-spacing: 0.05em;
        }

        .timer-controls {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 52px;
            min-width: 120px;
            box-shadow: var(--shadow-sm);
        }
        
        .timer-btn.start {
            background: var(--success);
            color: white;
        }
        
        .timer-btn.pause {
            background: var(--warning);
            color: white;
        }
        
        .timer-btn.reset {
            background: var(--danger);
            color: white;
        }
        
        .timer-btn:hover {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .timer-btn:active {
            transform: translateY(-1px);
        }
        
        /* Ï£ºÍ∞Ñ ÌïôÏäµ ÌÜµÍ≥Ñ */
        .weekly-stats {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .day-stat {
            text-align: center;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .day-stat.today {
            background: var(--accent);
            color: white;
        }
        
        .day-stat.completed {
            background: var(--success);
            color: white;
        }
        
        .day-name {
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .day-hours {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Í≥ºÎ™©Î≥Ñ ÏßÑÎèÑ */
        .subject-progress {
            margin-top: 15px;
        }
        
        .progress-item {
            margin-bottom: 15px;
            position: relative;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            cursor: pointer;
        }
        
        .progress-label {
            font-weight: 600;
        }
        
        .progress-value {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 28px;
            background: var(--bg-light);
            border-radius: var(--radius-full);
            overflow: hidden;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            border-radius: var(--radius-full);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-sm);
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ìä∏ÎûòÏª§ */
        .mock-scores {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .score-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 8px;
            margin-bottom: 8px;
            position: relative;
        }
        
        .score-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .score-value {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            background: var(--bg-primary);
        }
        
        .score-value.pass {
            color: var(--success);
            border: 2px solid var(--success);
        }
        
        .score-value.fail {
            color: var(--danger);
            border: 2px solid var(--danger);
        }
        
        .score-actions {
            position: absolute;
            right: 80px;
            display: flex;
            gap: 5px;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .score-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-primary);
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .score-action-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }
        
        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal.show {
            display: block;
        }
        
        .modal-content {
            background-color: var(--bg-primary);
            margin: 10% auto;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 560px;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            line-height: var(--line-height-tight);
            color: var(--primary-dark);
        }
        
        .modal-close {
            min-width: 40px;
            min-height: 40px;
            border: none;
            background: var(--bg-light);
            border-radius: 50%;
            cursor: pointer;
            font-size: var(--font-size-xl);
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .modal-body {
            margin-bottom: var(--spacing-xl);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all var(--transition-base);
            min-height: 48px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 48px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.1);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            padding-top: var(--spacing-lg);
        }

        .modal-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 48px;
            min-width: 100px;
        }
        
        .modal-btn.cancel {
            background: var(--bg-light);
            color: var(--text-primary);
        }
        
        .modal-btn.save {
            background: var(--accent);
            color: white;
        }
        
        .modal-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* ÎÖ∏Ìä∏ ÏÑπÏÖò */
        .notes-section {
            margin-top: 20px;
        }
        
        .notes-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .notes-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }
        
        .notes-toolbar {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .notes-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .notes-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º - Enhanced */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-dark);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 2000;
            animation: slideInToast 0.3s ease;
            min-width: 300px;
            max-width: 500px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--accent);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-message {
            flex: 1;
        }

        @keyframes slideInToast {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutToast {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* D-Day Ïπ¥Îìú Ïä§ÌÉÄÏùº - Enhanced */
        .dday-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .dday-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .dday-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--success));
        }

        .dday-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .dday-card.urgent {
            background: linear-gradient(135deg, #F56565 0%, #FC8181 100%);
            color: white;
        }

        .dday-card.warning {
            background: linear-gradient(135deg, #F6AD55 0%, #FBD38D 100%);
            color: white;
        }

        .dday-card.normal {
            background: linear-gradient(135deg, #48BB78 0%, #68D391 100%);
            color: white;
        }

        .dday-label {
            font-size: var(--font-size-lg);
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: var(--spacing-md);
            line-height: var(--line-height-tight);
        }

        .dday-value {
            font-size: var(--font-size-5xl);
            font-weight: 800;
            margin: var(--spacing-lg) 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        .dday-date {
            font-size: var(--font-size-base);
            opacity: 0.85;
            margin-top: var(--spacing-sm);
            line-height: var(--line-height-normal);
        }

        .dday-edit-btn {
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-lg);
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-lg);
            color: inherit;
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: var(--font-size-base);
            font-weight: 600;
            min-height: 44px;
            backdrop-filter: blur(10px);
        }

        .dday-edit-btn:hover {
            background: rgba(255,255,255,0.35);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        /* Import/Export Buttons */
        .data-management {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            margin-top: var(--spacing-lg);
        }

        .btn-primary {
            padding: 12px 24px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 44px;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 44px;
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
            color: var(--accent-color);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: var(--font-size-lg);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* ÌôïÏù∏ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .confirm-modal .modal-content {
            max-width: 400px;
        }

        .confirm-message {
            padding: 20px 0;
            font-size: 1.1rem;
            text-align: center;
            color: var(--text-primary);
        }

        /* Ïä§Ìä∏Î¶≠ Ìä∏ÎûòÏª§ Ïä§ÌÉÄÏùº */
        .streak-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFD93D 100%);
            border-radius: 12px;
            color: white;
            margin-bottom: 15px;
        }

        .streak-number {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .streak-label {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .streak-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .streak-stat-item {
            text-align: center;
        }

        .streak-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .streak-stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Ï†ÑÏ≤¥ ÎÑàÎπÑ Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .streak-card,
        .analytics-card {
            grid-column: 1 / -1;
            max-width: 100%;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.active {
            max-height: none;
            overflow: visible;
        }

        /* Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú Ïä§ÌÉÄÏùº - Enhanced Professional Design */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .analytics-stat {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .analytics-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-color) 0%, var(--accent-light) 100%);
        }

        .analytics-stat:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-light);
        }

        .analytics-label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-md);
            line-height: var(--line-height-tight);
        }

        .analytics-value {
            font-size: var(--font-size-4xl);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--info-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: var(--spacing-sm) 0 var(--spacing-lg) 0;
            line-height: 1.2;
        }

        .analytics-benchmark {
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--border-color);
            text-align: left;
        }

        .benchmark-label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            line-height: var(--line-height-normal);
        }

        .benchmark-percentage {
            font-weight: 700;
            color: var(--accent-color);
            font-size: var(--font-size-sm);
        }

        .benchmark-bar {
            height: 14px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .benchmark-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color) 0%, var(--success-color) 100%);
            border-radius: var(--radius-full);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .benchmark-fill.excellent {
            background: linear-gradient(90deg, #10B981 0%, #34D399 100%);
        }

        .benchmark-fill.good {
            background: linear-gradient(90deg, var(--accent-color) 0%, var(--accent-light) 100%);
        }

        .benchmark-fill.needs-improvement {
            background: linear-gradient(90deg, #F59E0B 0%, #FBBF24 100%);
        }

        .benchmark-fill.poor {
            background: linear-gradient(90deg, #EF4444 0%, #F87171 100%);
        }

        .benchmark-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .analytics-insight {
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-light);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--accent-color);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: var(--line-height-relaxed);
            min-height: 40px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .analytics-insight:empty {
            display: none;
        }

        .analytics-insight.positive {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-dark);
        }

        .analytics-insight.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left-color: var(--warning-color);
            color: var(--warning-dark);
        }

        .analytics-insight.negative {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: var(--danger-color);
            color: var(--danger-dark);
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Ï∞®Ìä∏ Ïä§ÌÉÄÏùº */
        .chart-container {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding: 10px;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 5px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(to top, var(--accent), var(--success));
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            position: relative;
        }

        .bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }

        .bar-label {
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: bold;
            color: var(--primary-dark);
        }

        /* Î™©Ìëú ÏÑ§Ï†ï Ïä§ÌÉÄÏùº */
        .goal-item {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--warning);
            transition: all 0.3s;
        }

        .goal-item.achieved {
            border-left-color: var(--success);
            background: #E6FFFA;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-title {
            font-weight: 600;
            flex: 1;
        }

        .goal-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .goal-progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .goal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--warning), var(--success));
            transition: width 0.5s ease;
        }

        .goal-actions {
            display: flex;
            gap: 5px;
        }

        .goal-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            box-shadow: var(--shadow-sm);
        }

        .goal-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        /* ÏïΩÏ†ê Í≥ºÎ™© Ïä§ÌÉÄÏùº */
        .weak-subject {
            background: #FFF5F5;
            border: 2px solid var(--danger);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .weak-subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .weak-subject-name {
            font-weight: 600;
            color: var(--danger);
            font-size: 1.1rem;
        }

        .priority-badge {
            background: var(--danger);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .weak-subject-info {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .recommendation {
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            border-left: 3px solid var(--warning-color);
        }

        /* Ï∂îÏ≤ú ÏÇ¨Ìï≠ Ïä§ÌÉÄÏùº */
        .recommendation-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .recommendation-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            line-height: 1.5;
        }

        .recommendation-list li:before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* Ï†ëÏùÑ Ïàò ÏûàÎäî ÏÑπÏÖò */
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .collapse-icon {
            transition: transform 0.3s;
            font-size: 1.2rem;
        }

        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }

        /* Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ÏÑπÏÖò */
        .data-management-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-top: var(--spacing-lg);
        }

        .data-management-card .card-title {
            color: white;
        }

        .data-management-section {
            padding: var(--spacing-md) 0;
        }

        .data-management-desc {
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
        }

        .data-management-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .data-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            color: white;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 56px;
        }

        .data-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .data-btn:active {
            transform: translateY(0);
        }

        .data-btn .btn-icon {
            font-size: 1.5rem;
        }

        .data-btn .btn-text {
            font-size: var(--font-size-lg);
        }

        .export-btn:hover {
            background: rgba(72, 187, 120, 0.3);
            border-color: var(--success-light);
        }

        .import-btn:hover {
            background: rgba(66, 153, 225, 0.3);
            border-color: var(--info-color);
        }

        .data-management-info {
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.9);
            line-height: var(--line-height-relaxed);
        }

        .data-management-info small {
            font-size: var(--font-size-sm);
            line-height: 1.8;
        }

        /* Import Preview Modal */
        .import-preview {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            max-height: 300px;
            overflow-y: auto;
        }

        .import-preview-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .import-preview-item:last-child {
            border-bottom: none;
        }

        .import-preview-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .import-preview-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Loading state */
        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid white;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-md);
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.6;
        }

        .empty-state-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state-description {
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-lg);
            line-height: var(--line-height-relaxed);
        }

        .empty-state-action {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--accent-color);
            color: white;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            transition: all var(--transition-base);
            cursor: pointer;
            border: none;
        }

        .empty-state-action:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Button Consistency */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 44px; /* Touch target size */
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-dark);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-dark);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: var(--danger-dark);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-sm);
            min-height: 36px;
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: var(--font-size-lg);
            min-height: 56px;
        }

        /* Focus states for accessibility */
        .btn:focus-visible,
        .data-btn:focus-visible,
        .action-btn:focus-visible,
        .modal-btn:focus-visible {
            outline: 3px solid var(--accent-light);
            outline-offset: 2px;
        }

        /* Loading Spinner for Better Feedback */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spinner 0.6s linear infinite;
        }

        /* Smooth Transitions for Better UX */
        * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Better Visual Hierarchy */
        h1, h2, h3, h4 {
            line-height: var(--line-height-tight);
            font-weight: 700;
        }

        p {
            line-height: var(--line-height-relaxed);
        }

        /* ========================================
           V3.0.0 - HUMAN-CENTERED REDESIGN
           ======================================== */

        /* Focus Mode Hero Section */
        .focus-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: var(--spacing-3xl) var(--spacing-xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-2xl);
            position: relative;
            overflow: hidden;
        }

        .focus-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .focus-hero-content {
            position: relative;
            z-index: 1;
        }

        .focus-greeting {
            font-size: var(--font-size-lg);
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
            opacity: 0.95;
        }

        .focus-date {
            font-size: var(--font-size-sm);
            opacity: 0.8;
            margin-bottom: var(--spacing-xl);
        }

        .focus-section-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .focus-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }

        .focus-subject {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .focus-details {
            font-size: var(--font-size-base);
            opacity: 0.9;
            margin-bottom: var(--spacing-md);
        }

        .focus-time {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .quick-start-btn {
            background: white;
            color: #667eea;
            font-weight: 700;
            padding: var(--spacing-md) var(--spacing-2xl);
            border-radius: var(--radius-full);
            border: none;
            cursor: pointer;
            font-size: var(--font-size-lg);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            margin-top: var(--spacing-md);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .quick-start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .quick-start-btn:active {
            transform: scale(0.98);
        }

        .focus-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .focus-stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
        }

        .focus-stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            display: block;
            margin-bottom: var(--spacing-xs);
        }

        .focus-stat-label {
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }

        /* Floating Action Button (FAB) */
        .fab {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            box-shadow: 0 8px 16px rgba(255,107,107,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            border: none;
        }

        .fab:hover {
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 12px 24px rgba(255,107,107,0.6);
        }

        .fab:active {
            transform: scale(1.05);
        }

        .fab-icon {
            font-size: 2rem;
            color: white;
            transition: transform 0.3s;
        }

        .fab:hover .fab-icon {
            transform: rotate(-90deg);
        }

        .fab-menu {
            position: fixed;
            right: 32px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            z-index: 999;
        }

        .fab-menu.active {
            opacity: 1;
            pointer-events: all;
            bottom: 104px;
        }

        .fab-menu-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .fab-menu-item:hover {
            transform: translateX(-4px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .fab-menu-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .fab-menu-item-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--success-color);
            z-index: 9999;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti-1 { background: #FF6B6B; animation: confetti-fall 3s linear; }
        .confetti-2 { background: #4ECDC4; animation: confetti-fall 3.2s linear; }
        .confetti-3 { background: #FFE66D; animation: confetti-fall 2.8s linear; }
        .confetti-4 { background: #95E1D3; animation: confetti-fall 3.5s linear; }
        .confetti-5 { background: #F38181; animation: confetti-fall 3.1s linear; }

        /* Achievement Modal */
        .achievement-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: var(--spacing-3xl);
            border-radius: var(--radius-xl);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .achievement-modal.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: all;
        }

        .achievement-badge {
            font-size: 5rem;
            margin-bottom: var(--spacing-md);
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .achievement-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .achievement-message {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-xl);
            opacity: 0.95;
        }

        .achievement-close-btn {
            background: white;
            color: #FFA500;
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-full);
            font-weight: 700;
            cursor: pointer;
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }

        .achievement-close-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Journey Visualization */
        .journey-container {
            padding: var(--spacing-xl);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            margin: var(--spacing-lg) 0;
        }

        .journey-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .journey-track {
            position: relative;
            height: 80px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .journey-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            border-radius: var(--radius-full);
            position: relative;
            transition: width 1s ease;
        }

        .journey-marker {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            transition: left 1s ease;
        }

        .journey-marker-start {
            left: 0;
        }

        .journey-marker-current {
            right: -16px;
            animation: pulse 2s infinite;
        }

        .journey-marker-goal {
            right: 0;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2); }
        }

        .journey-labels {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .journey-message {
            text-align: center;
            font-size: var(--font-size-base);
            color: var(--text-primary);
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background: var(--bg-light);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--success-color);
        }

        /* ========================================
           RESPONSIVE DESIGN - Mobile First Approach
           ======================================== */

        /* Extra Small Devices (360px - 479px) */
        @media (max-width: 479px) {
            .container {
                padding: var(--spacing-sm);
            }

            .header {
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }

            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }

            .title {
                font-size: var(--font-size-xl);
            }

            .modal-content {
                max-width: 95%;
                margin: 20px auto;
            }

            .action-btn,
            .rotation-circle,
            .check-btn {
                min-width: var(--touch-target-min);
                min-height: var(--touch-target-min);
            }

            .focus-hero {
                padding: var(--spacing-lg) var(--spacing-sm);
            }

            .focus-stats {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .focus-stat {
                min-height: auto;
                padding: var(--spacing-md);
            }

            .quick-actions {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .quick-action-btn {
                min-height: var(--touch-target-large);
                padding: var(--spacing-md);
                font-size: var(--font-size-base);
            }

            .dday-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }

            .card {
                padding: var(--spacing-md);
                min-height: 120px;
            }

            .card-title {
                font-size: var(--font-size-lg);
            }

            .time-blocks {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .fab {
                width: var(--touch-target-comfortable);
                height: var(--touch-target-comfortable);
                right: 12px;
                bottom: 12px;
            }

            .fab-icon {
                font-size: 1.5rem;
            }

            .fab-menu {
                right: 20px;
                bottom: 72px;
            }

            .fab-menu-item {
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .fab-menu-item-label {
                font-size: var(--font-size-sm);
            }

            .theme-toggle {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
                top: 12px;
                right: 12px;
            }

            .timer-display {
                font-size: 2rem;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }

            .data-btn {
                min-height: var(--touch-target-large);
                padding: var(--spacing-md);
                font-size: var(--font-size-base);
            }

            .data-management-actions {
                grid-template-columns: 1fr;
            }
        }

        /* Small Devices (480px - 639px) */
        @media (min-width: 480px) and (max-width: 639px) {
            .focus-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .dday-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-blocks {
                grid-template-columns: repeat(2, 1fr);
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .fab {
                width: var(--touch-target-comfortable);
                height: var(--touch-target-comfortable);
                right: 16px;
                bottom: 16px;
            }
        }

        /* Medium Devices - Tablets (640px - 767px) */
        @media (min-width: 640px) and (max-width: 767px) {
            .focus-stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-blocks {
                grid-template-columns: repeat(3, 1fr);
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Large Tablets & Small Desktops (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .focus-stats {
                grid-template-columns: repeat(4, 1fr);
            }

            .quick-actions {
                grid-template-columns: repeat(3, 1fr);
            }

            .time-blocks {
                grid-template-columns: repeat(4, 1fr);
            }

            .analytics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .quick-action-btn,
            .data-btn,
            .btn,
            .mode-btn,
            .dday-edit-btn {
                min-height: var(--touch-target-comfortable);
            }

            .fab {
                width: var(--touch-target-large);
                height: var(--touch-target-large);
            }

            .fab-menu-item {
                min-height: var(--touch-target-min);
            }

            /* Increase tap target spacing */
            .quick-actions,
            .fab-menu {
                gap: var(--spacing-md);
            }
        }

        /* Landscape Orientation Optimizations */
        @media (orientation: landscape) and (max-height: 600px) {
            .focus-hero {
                padding: var(--spacing-md) var(--spacing-lg);
            }

            .card {
                min-height: 150px;
            }

            .fab {
                width: 44px;
                height: 44px;
                right: 12px;
                bottom: 12px;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .card,
            .time-block,
            .focus-stat,
            .quick-action-btn {
                border-width: 2px;
                border-color: currentColor;
            }

            .fab {
                border: 2px solid white;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .fab:hover {
                transform: scale(1.05);
            }

            .card:hover {
                transform: none;
            }
        }

        /* Print Styles */
        @media print {
            .fab,
            .fab-menu,
            .theme-toggle,
            .quick-actions,
            .data-management {
                display: none !important;
            }

            .card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }

            body {
                background: white;
                color: black;
            }
        }
    </style>
</head>
<body>

    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        <span id="theme-icon">üåô</span>
    </button>

    <div class="container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="header-top">
                <h1 class="title">üéØ ÏãúÌóò Ï†ÑÎûµÏ†Å ÌïôÏäµ ÏãúÏä§ÌÖú v3.2.3</h1>
            </div>

            <!-- D-Day Ïπ¥Ïö¥ÌÑ∞ (1Ï∞®/2Ï∞®) -->
            <div class="dday-container">
                <div class="dday-card" id="dday-1st-card" onclick="editExamDate('1Ï∞®')">
                    <div class="dday-label">üìö 1Ï∞® ÏãúÌóò</div>
                    <div class="dday-value" id="dday-1st-value">D-?</div>
                    <div class="dday-date" id="dday-1st-date">ÎÇ†Ïßú ÎØ∏ÏÑ§Ï†ï</div>
                    <button class="dday-edit-btn" onclick="event.stopPropagation(); editExamDate('1Ï∞®')">ÎÇ†Ïßú ÏÑ§Ï†ï</button>
                </div>
                <div class="dday-card" id="dday-2nd-card" onclick="editExamDate('2Ï∞®')">
                    <div class="dday-label">‚úçÔ∏è 2Ï∞® ÏãúÌóò</div>
                    <div class="dday-value" id="dday-2nd-value">D-?</div>
                    <div class="dday-date" id="dday-2nd-date">ÎÇ†Ïßú ÎØ∏ÏÑ§Ï†ï</div>
                    <button class="dday-edit-btn" onclick="event.stopPropagation(); editExamDate('2Ï∞®')">ÎÇ†Ïßú ÏÑ§Ï†ï</button>
                </div>
            </div>

            <div class="study-mode-selector">
                <button class="mode-btn" onclick="setExamType('1Ï∞®')">1Ï∞® ÏãúÌóò</button>
                <button class="mode-btn" onclick="setExamType('2Ï∞®')">2Ï∞® ÏãúÌóò</button>
            </div>
        </div>

        <!-- V3.0.0: ÏßëÏ§ë Î™®Îìú ÎåÄÏãúÎ≥¥Îìú (Hero Section) -->
        <div class="focus-hero" id="focus-hero">
            <div class="focus-hero-content">
                <div class="focus-greeting" id="focus-greeting">Ï¢ãÏùÄ ÏïÑÏπ®ÏûÖÎãàÎã§! üåÖ</div>
                <div class="focus-date" id="focus-date">Ïò§Îäò: 2025ÎÖÑ 10Ïõî 21Ïùº ÏõîÏöîÏùº</div>

                <div class="focus-section-title">
                    <span>üìç</span>
                    <span>Ïò§ÎäòÏùò ÏßëÏ§ë ÌïôÏäµ</span>
                </div>

                <div class="focus-card" id="focus-card">
                    <div class="focus-subject" id="focus-subject">ÏãúÏûëÌï† Ï§ÄÎπÑ ÏôÑÎ£å!</div>
                    <div class="focus-details" id="focus-details">Ï≤´ ÌïôÏäµ Í≥ÑÌöçÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî</div>
                    <div class="focus-time" id="focus-time">
                        <span>‚è±Ô∏è</span>
                        <span id="focus-time-text">ÏßÄÍ∏à ÏãúÏûëÌïòÏÑ∏Ïöî</span>
                    </div>
                    <button class="quick-start-btn" onclick="quickStartStudy()">
                        <span>‚ú®</span>
                        <span>ÏßÄÍ∏à ÏãúÏûë</span>
                    </button>
                </div>

                <div class="focus-stats">
                    <div class="focus-stat-item">
                        <span class="focus-stat-value" id="focus-streak">0</span>
                        <span class="focus-stat-label">Ïó∞ÏÜç ÏùºÏàò</span>
                    </div>
                    <div class="focus-stat-item">
                        <span class="focus-stat-value" id="focus-total-hours">0h</span>
                        <span class="focus-stat-label">Ï¥ù ÌïôÏäµÏãúÍ∞Ñ</span>
                    </div>
                    <div class="focus-stat-item">
                        <span class="focus-stat-value" id="focus-progress">0%</span>
                        <span class="focus-stat-label">Î™©ÌëúÍπåÏßÄ</span>
                    </div>
                </div>
                <div class="focus-suggestion" id="focus-suggestion" style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; text-align: center; font-size: 0.95rem; color: rgba(255,255,255,0.9);">
                    Ïò§ÎäòÎèÑ ÌôîÏù¥ÌåÖ! Íæ∏Ï§ÄÌïú ÌïôÏäµÏù¥ Ìï©Í≤©Ïùò ÏßÄÎ¶ÑÍ∏∏ÏûÖÎãàÎã§!
                </div>
            </div>
        </div>

        <!-- V3.0.0: ÌïôÏäµ Ïó¨Ï†ï ÏãúÍ∞ÅÌôî -->
        <div class="journey-container" id="journey-container">
            <h3 class="journey-title">üìä ÎÇòÏùò ÌïôÏäµ Ïó¨Ï†ï</h3>
            <div class="journey-track">
                <div class="journey-progress" id="journey-progress" style="width: 0%">
                    <span class="journey-marker journey-marker-current">üéØ</span>
                </div>
                <span class="journey-marker journey-marker-start">üìö</span>
                <span class="journey-marker journey-marker-goal">üèÜ</span>
            </div>
            <div class="journey-labels">
                <span>ÏãúÏûë (0h)</span>
                <span id="journey-current">ÌòÑÏû¨: 0h</span>
                <span>Î™©Ìëú (800h)</span>
            </div>
            <div class="journey-message" id="journey-message">
                "Î™®Îì† Ï†ÑÎ¨∏Í∞ÄÎèÑ Ï≤òÏùåÏóî Ï¥àÎ≥¥ÏûêÏòÄÏäµÎãàÎã§. ÏßÄÍ∏à ÏãúÏûëÌïòÏÑ∏Ïöî! üí™"
            </div>
        </div>

        <!-- ÌïôÏäµ Ïä§Ìä∏Î¶≠ Ìä∏ÎûòÏª§ -->
        <div class="card streak-card">
            <div class="card-header">
                <h2 class="card-title">üî• ÌïôÏäµ Ïä§Ìä∏Î¶≠</h2>
                <div class="card-actions">
                    <button class="action-btn" onclick="resetStreak()" title="Ïä§Ìä∏Î¶≠ Ï¥àÍ∏∞Ìôî">üîÑ</button>
                </div>
            </div>
            <div class="streak-display">
                <div class="streak-label">ÌòÑÏû¨ Ïó∞ÏÜç ÌïôÏäµÏùº</div>
                <div class="streak-number" id="current-streak">0</div>
                <div class="streak-label">Ïùº Ïó∞ÏÜç üî•</div>
                <div class="streak-stats">
                    <div class="streak-stat-item">
                        <div class="streak-stat-value" id="longest-streak">0</div>
                        <div class="streak-stat-label">ÏµúÏû• Í∏∞Î°ù</div>
                    </div>
                    <div class="streak-stat-item">
                        <div class="streak-stat-value" id="total-study-days">0</div>
                        <div class="streak-stat-label">Ï¥ù ÌïôÏäµÏùº</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÌïôÏäµ Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú -->
        <div class="card analytics-card">
            <div class="card-header collapsible-header" onclick="toggleCollapse('analytics-section')">
                <h2 class="card-title">üìä ÌïôÏäµ Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</h2>
                <span class="collapse-icon" id="analytics-icon">‚ñº</span>
            </div>
            <div class="collapsible-content active" id="analytics-section">
                <div class="analytics-grid">
                    <div class="analytics-stat" data-metric="total-hours">
                        <div class="analytics-label">Ï¥ù ÌïôÏäµ ÏãúÍ∞Ñ</div>
                        <div class="analytics-value" id="total-study-hours">0h</div>
                        <div class="analytics-benchmark">
                            <div class="benchmark-label">Ìï©Í≤©Ïûê ÌèâÍ∑†: 800-1200h</div>
                            <div class="benchmark-bar">
                                <div class="benchmark-fill" id="total-hours-progress"></div>
                            </div>
                        </div>
                        <div class="analytics-insight" id="total-hours-insight"></div>
                    </div>
                    <div class="analytics-stat" data-metric="daily-hours">
                        <div class="analytics-label">ÏùºÌèâÍ∑† ÌïôÏäµ</div>
                        <div class="analytics-value" id="avg-daily-hours">0h</div>
                        <div class="analytics-benchmark">
                            <div class="benchmark-label">Ìï©Í≤©Ïûê ÌèâÍ∑†: 4-5h/day</div>
                            <div class="benchmark-bar">
                                <div class="benchmark-fill" id="daily-hours-progress"></div>
                            </div>
                        </div>
                        <div class="analytics-insight" id="daily-hours-insight"></div>
                    </div>
                    <div class="analytics-stat" data-metric="progress">
                        <div class="analytics-label">Ï†ÑÏ≤¥ ÏßÑÎèÑÏú®</div>
                        <div class="analytics-value" id="overall-progress">0%</div>
                        <div class="analytics-benchmark">
                            <div class="benchmark-label">Î™©Ìëú: 100%</div>
                            <div class="benchmark-bar">
                                <div class="benchmark-fill" id="progress-bar"></div>
                            </div>
                        </div>
                        <div class="analytics-insight" id="progress-insight"></div>
                    </div>
                    <div class="analytics-stat" data-metric="mock-score">
                        <div class="analytics-label">Î™®ÏùòÍ≥†ÏÇ¨ ÌèâÍ∑†</div>
                        <div class="analytics-value" id="avg-mock-score">0Ï†ê</div>
                        <div class="analytics-benchmark">
                            <div class="benchmark-label">Ìï©Í≤©ÏÑ†: 60Ï†ê</div>
                            <div class="benchmark-bar">
                                <div class="benchmark-fill" id="mock-score-progress"></div>
                            </div>
                        </div>
                        <div class="analytics-insight" id="mock-score-insight"></div>
                    </div>
                </div>

                <!-- Í≥ºÎ™©Î≥Ñ ÌïôÏäµ ÏãúÍ∞Ñ Ï∞®Ìä∏ -->
                <div class="chart-container">
                    <h3 style="margin-bottom: 15px; font-size: 1rem;">Í≥ºÎ™©Î≥Ñ ÌïôÏäµ ÏãúÍ∞Ñ Î∂ÑÌè¨</h3>
                    <div class="bar-chart" id="subject-time-chart">
                        <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>

                <!-- Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÏù¥ Ï∞®Ìä∏ -->
                <div class="chart-container">
                    <h3 style="margin-bottom: 15px; font-size: 1rem;">Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÏù¥</h3>
                    <div class="bar-chart" id="mock-score-chart">
                        <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Î™©Ìëú ÏÑ§Ï†ï -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üéØ ÌïôÏäµ Î™©Ìëú</h2>
                <div class="card-actions">
                    <button class="action-btn" onclick="addGoal()">‚ûï</button>
                </div>
            </div>
            <div id="goals-container">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
        </div>

        <!-- ÎåÄÏãúÎ≥¥Îìú Í∑∏Î¶¨Îìú -->
        <div class="dashboard-grid">
            <!-- Ïò§ÎäòÏùò ÌïôÏäµ Í≥ÑÌöç -->
            <div class="card today-plan">
                <div class="card-header">
                    <h2 class="card-title">üìö Ïò§ÎäòÏùò ÌïôÏäµ Ï†ÑÎûµ</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="addTimeBlock()">‚ûï</button>
                    </div>
                </div>
                <div class="time-blocks" id="time-blocks-container">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
                <div style="background: #FFF5F5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger); margin-top: 15px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--danger);">üí° Ìï©Í≤©Ïûê ÌèâÍ∑† (ÏßÅÏû•Î≥ëÌñâ Í∏∞Ï§Ä)</div>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                        ‚Ä¢ ÏùºÏùº ÌïôÏäµÏãúÍ∞Ñ: ÌèâÏùº 4-5ÏãúÍ∞Ñ<br>
                        ‚Ä¢ Í∏∞Ï∂úÎ¨∏Ï†ú ÌöåÎèÖ: Í≥ºÎ™©Îãπ 6-7Ìöå<br>
                        ‚Ä¢ 1Ï∞® Ï§ÄÎπÑÍ∏∞Í∞Ñ: 12-18Í∞úÏõî
                    </div>
                </div>
            </div>
            
            <!-- Í∏∞Ï∂úÎ¨∏Ï†ú ÌöåÎèÖ Ìä∏ÎûòÏª§ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üîÑ Í∏∞Ï∂úÎ¨∏Ï†ú ÌöåÎèÖ ÌòÑÌô©</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="resetRotations()">üîÑ</button>
                    </div>
                </div>
                <div class="rotation-tracker" id="rotation-tracker">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
            </div>
            
            <!-- ÌïôÏäµ ÌÉÄÏù¥Î®∏ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚è±Ô∏è Ïò§ÎäòÏùò ÌïôÏäµ ÏãúÍ∞Ñ</h2>
                </div>
                <div class="timer-display" id="timer">00:00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn start" onclick="startTimer()">ÏãúÏûë</button>
                    <button class="timer-btn pause" onclick="pauseTimer()">ÏùºÏãúÏ†ïÏßÄ</button>
                    <button class="timer-btn reset" onclick="resetTimer()">Î¶¨ÏÖã</button>
                </div>
                <div class="weekly-stats" id="weekly-stats">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
            </div>
            
            <!-- Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üçÖ Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏</h2>
                </div>
                <div class="pomodoro-display">
                    <div class="pomodoro-mode" id="pomodoro-mode">ÏûëÏóÖ ÏÑ∏ÏÖò</div>
                    <div class="timer-display" id="pomodoro-timer">25:00</div>
                    <div class="pomodoro-session-count">
                        ÏôÑÎ£åÎêú ÏÑ∏ÏÖò: <span id="pomodoro-count">0</span>Í∞ú
                    </div>
                </div>
                <div class="timer-controls">
                    <button class="timer-btn start" id="pomodoro-start" onclick="startPomodoro()">ÏãúÏûë</button>
                    <button class="timer-btn pause" id="pomodoro-pause" onclick="pausePomodoro()" style="display:none;">ÏùºÏãúÏ†ïÏßÄ</button>
                    <button class="timer-btn reset" onclick="resetPomodoro()">Î¶¨ÏÖã</button>
                </div>
            </div>

            <!-- Í≥ºÎ™©Î≥Ñ ÏßÑÎèÑ ÌòÑÌô© -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Í≥ºÎ™©Î≥Ñ ÏßÑÎèÑÏú®</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="updateAllProgress()">‚úèÔ∏è</button>
                    </div>
                </div>
                <div class="subject-progress" id="subject-progress">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
            </div>
            
            <!-- Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ìä∏ÎûòÏª§ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìù Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÏù¥</h2>
                    <div class="card-actions">
                        <button class="action-btn" onclick="showScoreModal()">‚ûï</button>
                    </div>
                </div>
                <div class="mock-scores" id="mock-scores">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                </div>
            </div>
            
            <!-- ÎèôÍ∏∞Î∂ÄÏó¨ Ïπ¥Îìú -->
            <div class="card">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 1.1rem; font-style: italic; margin-bottom: 10px;" id="motivation-quote">
                        "Ìè¨Í∏∞ÌïòÏßÄ ÏïäÏúºÎ©¥ Î∞òÎìúÏãú Ìï©Í≤©ÌïúÎã§. ÏãúÌóòÏùÄ ÎÅùÍπåÏßÄ Î≤ÑÌã∞Îäî Í≤ÉÏûÖÎãàÎã§."
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">- 29Ìöå Ìï©Í≤©Ïûê -</div>
                </div>
                <div style="background: #FFF5F5; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger); margin-top: 15px;">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--danger);">üèÜ Ìï©Í≤©Ïûê Ï°∞Ïñ∏</div>
                    <div style="font-size: 0.9rem; line-height: 1.6;">
                        ‚Ä¢ Í∏∞Ï∂úÎ¨∏Ï†ú 6-7ÌöåÎèÖÏù¥ ÌïµÏã¨<br>
                        ‚Ä¢ ÏµúÏã†ÌåêÎ°ÄÎäî Î∞òÎìúÏãú Ï≤¥ÌÅ¨<br>
                        ‚Ä¢ Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàòÏóê Ïó∞Ïó∞ÌïòÏßÄ Îßê Í≤É<br>
                        ‚Ä¢ Îß§Ïùº Íæ∏Ï§ÄÌûàÍ∞Ä ÎãµÏûÖÎãàÎã§
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÌïôÏäµ ÎÖ∏Ìä∏ ÏÑπÏÖò -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üìù Ïò§ÎäòÏùò ÌïôÏäµ ÎÖ∏Ìä∏</h2>
            </div>
            <div class="notes-section">
                <textarea class="notes-input" placeholder="Ïò§Îäò ÌïôÏäµÌïú ÌïµÏã¨ ÎÇ¥Ïö©, ÌãÄÎ¶∞ Î¨∏Ï†ú, Ìó∑Í∞àÎ¶¨Îäî Í∞úÎÖêÏùÑ Ï†ïÎ¶¨ÌïòÏÑ∏Ïöî..." id="study-notes"></textarea>
                <div class="notes-toolbar">
                    <button class="notes-btn" onclick="saveNotes()">Ï†ÄÏû•</button>
                    <button class="notes-btn" onclick="showPreviousNotes()">Ïù¥Ï†Ñ ÎÖ∏Ìä∏</button>
                    <button class="notes-btn" onclick="exportNotes()">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                    <button class="notes-btn" onclick="addErrorNote()">Ïò§ÎãµÎÖ∏Ìä∏ Ï∂îÍ∞Ä</button>
                    <button class="notes-btn" onclick="clearNotes()">Ï¥àÍ∏∞Ìôî</button>
                </div>
            </div>
        </div>

        <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ÏÑπÏÖò -->
        <div class="card data-management-card">
            <div class="card-header">
                <h2 class="card-title">üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h2>
            </div>
            <div class="data-management-section">
                <p class="data-management-desc">ÌïôÏäµ Îç∞Ïù¥ÌÑ∞Î•º ÏïàÏ†ÑÌïòÍ≤å Î∞±ÏóÖÌïòÍ≥† Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Î∂àÎü¨Ïò¨ Ïàò ÏûàÏäµÎãàÎã§</p>
                <div class="data-management-actions">
                    <button class="data-btn export-btn" onclick="exportData()">
                        <span class="btn-icon">‚¨áÔ∏è</span>
                        <span class="btn-text">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</span>
                    </button>
                    <button class="data-btn import-btn" onclick="document.getElementById('importFileInput').click()">
                        <span class="btn-icon">‚¨ÜÔ∏è</span>
                        <span class="btn-text">Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞</span>
                    </button>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
                <div class="data-management-info">
                    <small>ÎÇ¥Î≥¥ÎÇ¥Í∏∞: Î™®Îì† ÌïôÏäµ Îç∞Ïù¥ÌÑ∞Î•º JSON ÌååÏùºÎ°ú Ï†ÄÏû•Ìï©ÎãàÎã§</small><br>
                    <small>Í∞ÄÏ†∏Ïò§Í∏∞: Ïù¥Ï†ÑÏóê Ï†ÄÏû•Ìïú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏòµÎãàÎã§ (ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Îäî ÎåÄÏ≤¥Îê©ÎãàÎã§)</small>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 20px; color: var(--text-secondary); font-size: 0.85rem;">
            ÏãúÌóò Ï†ÑÎûµÏ†Å ÌïôÏäµ ÏãúÏä§ÌÖú v3.2.1 | Critical Bug Fixes | 1Ï∞®/2Ï∞® ÏãúÌóò ÏßÄÏõê | ÌïôÏäµ Î∂ÑÏÑù & Î™©Ìëú Í¥ÄÎ¶¨
        </div>
    </div>
    
    <!-- Î™®Îã¨Îì§ -->
    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÍ∞Ä</h3>
                <button class="modal-close" onclick="closeModal('scoreModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÏãúÌóò ÎÇ†Ïßú</label>
                    <input type="date" class="form-input" id="scoreDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Ï†êÏàò</label>
                    <input type="number" step="0.5" class="form-input" id="scoreValue" placeholder="Ïòà: 58.5">
                </div>
                <div class="form-group">
                    <label class="form-label">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                    <input type="text" class="form-input" id="scoreMemo" placeholder="Ïòà: 3Ï∞® Î™®ÏùòÍ≥†ÏÇ¨">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('scoreModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveScore()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>
    
    <div id="timeBlockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÌïôÏäµ ÏãúÍ∞Ñ Î∏îÎ°ù Ï∂îÍ∞Ä</h3>
                <button class="modal-close" onclick="closeModal('timeBlockModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÏãúÍ∞ÑÎåÄ</label>
                    <input type="text" class="form-input" id="blockTime" placeholder="Ïòà: 06:00-08:00">
                </div>
                <div class="form-group">
                    <label class="form-label">Í≥ºÎ™©</label>
                    <select class="form-select" id="blockSubject">
                        <optgroup label="1Ï∞® ÏãúÌóò">
                            <option value="ÌóåÎ≤ï">ÌóåÎ≤ï</option>
                            <option value="ÎØºÎ≤ï">ÎØºÎ≤ï</option>
                            <option value="ÏÉÅÎ≤ï">ÏÉÅÎ≤ï</option>
                            <option value="ÎØºÏÇ¨ÏßëÌñâÎ≤ï">ÎØºÏÇ¨ÏßëÌñâÎ≤ï</option>
                            <option value="Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï">Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï</option>
                            <option value="ÏÉÅÏóÖÎì±Í∏∞Î≤ï">ÏÉÅÏóÖÎì±Í∏∞Î≤ï</option>
                            <option value="Í≥µÌÉÅÎ≤ï">Í≥µÌÉÅÎ≤ï</option>
                        </optgroup>
                        <optgroup label="2Ï∞® ÏãúÌóò">
                            <option value="ÎØºÎ≤ï (2Ï∞®)">ÎØºÎ≤ï (2Ï∞®)</option>
                            <option value="ÌòïÎ≤ï (2Ï∞®)">ÌòïÎ≤ï (2Ï∞®)</option>
                            <option value="ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)">ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)</option>
                            <option value="ÎØºÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)">ÎØºÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)</option>
                            <option value="ÎØºÏÇ¨ÏÇ¨Í±¥ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)">ÎØºÏÇ¨ÏÇ¨Í±¥ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)</option>
                            <option value="Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï (2Ï∞®)">Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï (2Ï∞®)</option>
                            <option value="Îì±Í∏∞Ïã†Ï≤≠ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)">Îì±Í∏∞Ïã†Ï≤≠ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏòàÏÉÅ ÌïôÏäµ ÏãúÍ∞Ñ (ÏãúÍ∞Ñ)</label>
                    <input type="number" class="form-input" id="blockHours" placeholder="Ïòà: 2" min="0.5" step="0.5" value="2">
                </div>
                <div class="form-group">
                    <label class="form-label">ÌïôÏäµ ÎÇ¥Ïö©</label>
                    <input type="text" class="form-input" id="blockDetail" placeholder="Ïòà: Í∏∞Ï∂úÎ¨∏Ï†ú #201-250">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('timeBlockModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveTimeBlock()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÌïôÏäµ Î™©Ìëú Ï∂îÍ∞Ä</h3>
                <button class="modal-close" onclick="closeModal('goalModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Î™©Ìëú ÎÇ¥Ïö©</label>
                    <input type="text" class="form-input" id="goalTitle" placeholder="Ïòà: ÎØºÎ≤ï 3ÌöåÎèÖ ÏôÑÎ£å">
                </div>
                <div class="form-group">
                    <label class="form-label">Î™©Ìëú ÎÇ†Ïßú</label>
                    <input type="date" class="form-input" id="goalDate">
                </div>
                <div class="form-group">
                    <label class="form-label">ÌòÑÏû¨ ÏßÑÎèÑ (%)</label>
                    <input type="number" min="0" max="100" class="form-input" id="goalProgress" placeholder="0-100" value="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('goalModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveGoal()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- ÏãúÌóò ÎÇ†Ïßú ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="examDateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="examDateModalTitle">ÏãúÌóò ÎÇ†Ïßú ÏÑ§Ï†ï</h3>
                <button class="modal-close" onclick="closeModal('examDateModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÏãúÌóò ÎÇ†Ïßú</label>
                    <input type="date" class="form-input" id="examDateInput">
                </div>
                <div class="form-group">
                    <label class="form-label">Î©îÎ™® (ÏÑ†ÌÉù)</label>
                    <input type="text" class="form-input" id="examDateMemo" placeholder="Ïòà: ÌïÑÍ∏∞ÏãúÌóò">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('examDateModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveExamDate()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Í≥ºÎ™© ÏßÑÎèÑ ÏàòÏ†ï Î™®Îã¨ -->
    <div id="subjectProgressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="subjectProgressModalTitle">Í≥ºÎ™© ÏßÑÎèÑ ÏàòÏ†ï</h3>
                <button class="modal-close" onclick="closeModal('subjectProgressModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÏôÑÎ£å Î¨∏Ï†úÏàò</label>
                    <input type="number" class="form-input" id="subjectCompleted" min="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Î™©Ìëú Î¨∏Ï†úÏàò</label>
                    <input type="number" class="form-input" id="subjectTotal" min="1">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('subjectProgressModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveSubjectProgress()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Ï£ºÍ∞Ñ ÌïôÏäµ ÏãúÍ∞Ñ ÏàòÏ†ï Î™®Îã¨ -->
    <div id="weeklyHoursModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="weeklyHoursModalTitle">ÌïôÏäµ ÏãúÍ∞Ñ ÏàòÏ†ï</h3>
                <button class="modal-close" onclick="closeModal('weeklyHoursModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ÌïôÏäµ ÏãúÍ∞Ñ (ÏãúÍ∞Ñ)</label>
                    <input type="number" class="form-input" id="weeklyHoursInput" min="0" step="0.5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('weeklyHoursModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveWeeklyHours()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- ÌôïÏù∏ Î™®Îã¨ (confirm ÎåÄÏ≤¥) -->
    <div id="confirmModal" class="modal confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmModalTitle">ÌôïÏù∏</h3>
                <button class="modal-close" onclick="closeModal('confirmModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="confirm-message" id="confirmMessage">Ï†ïÎßê Ïã§ÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?</div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('confirmModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="confirmOkBtn">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <!-- ÌãÄÎ¶∞ Î¨∏Ï†ú ÎÖ∏Ìä∏ Î™®Îã¨ -->
    <div id="wrongNoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÌãÄÎ¶∞ Î¨∏Ï†ú ÎÖ∏Ìä∏ Ï∂îÍ∞Ä</h3>
                <button class="modal-close" onclick="closeModal('wrongNoteModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Í≥ºÎ™©Î™Ö</label>
                    <input type="text" class="form-input" id="wrongSubject" placeholder="Ïòà: ÎØºÎ≤ï">
                </div>
                <div class="form-group">
                    <label class="form-label">ÌãÄÎ¶∞ Î¨∏Ï†ú Î≤àÌò∏ ÎòêÎäî ÎÇ¥Ïö©</label>
                    <input type="text" class="form-input" id="wrongQuestion" placeholder="Ïòà: 2024ÎÖÑ 1Ìöå 35Î≤à">
                </div>
                <div class="form-group">
                    <label class="form-label">ÌãÄÎ¶∞ Ïù¥Ïú†</label>
                    <textarea class="form-input" id="wrongReason" rows="3" placeholder="Ïù¥Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('wrongNoteModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" onclick="saveWrongNote()">Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏ Î™®Îã¨ -->
    <div id="importConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏</h3>
                <button class="modal-close" onclick="closeModal('importConfirmModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="confirm-message" style="margin-bottom: 20px; color: var(--warning-dark); font-weight: 600;">
                    ‚ö†Ô∏è ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò® Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥ÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br>
                    <span style="font-size: 0.9rem; color: var(--danger-color);">ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Îäî ÏôÑÏ†ÑÌûà ÏÇ≠Ï†úÎêòÎ©∞ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</span>
                </div>
                <div class="import-preview" id="importPreviewContainer">
                    <!-- Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel" onclick="closeModal('importConfirmModal')">Ï∑®ÏÜå</button>
                <button class="modal-btn save" id="confirmImportBtn" style="background: var(--danger-color);">ÌôïÏù∏ Î∞è Í∞ÄÏ†∏Ïò§Í∏∞</button>
            </div>
        </div>
    </div>

    <!-- ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º Ïª®ÌÖåÏù¥ÎÑà -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        let studyData = {
            examType: localStorage.getItem('examType') || '1Ï∞®',
            examDates: {
                '1Ï∞®': null,  // Format: 'YYYY-MM-DD'
                '2Ï∞®': null
            },
            timer: {
                seconds: 0,
                isRunning: false,
                interval: null
            },
            pomodoro: {
                seconds: 1500, // 25 minutes
                isRunning: false,
                interval: null,
                mode: 'work', // 'work' or 'break'
                completedSessions: 0
            },
            subjects1st: [
                { name: 'ÌóåÎ≤ï', total: 500, completed: 320, rotations: [true, true, false, false, false, false, false] },
                { name: 'ÎØºÎ≤ï', total: 800, completed: 580, rotations: [true, true, true, false, false, false, false] },
                { name: 'ÏÉÅÎ≤ï', total: 500, completed: 280, rotations: [true, true, false, false, false, false, false] },
                { name: 'ÎØºÏÇ¨ÏßëÌñâÎ≤ï', total: 400, completed: 180, rotations: [true, false, false, false, false, false, false] },
                { name: 'Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï', total: 500, completed: 420, rotations: [true, true, true, true, false, false, false] },
                { name: 'ÏÉÅÏóÖÎì±Í∏∞Î≤ï', total: 300, completed: 150, rotations: [true, false, false, false, false, false, false] },
                { name: 'Í≥µÌÉÅÎ≤ï', total: 300, completed: 200, rotations: [true, true, false, false, false, false, false] }
            ],
            subjects2nd: [
                { name: 'ÎØºÎ≤ï (2Ï∞®)', total: 100, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'ÌòïÎ≤ï (2Ï∞®)', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'ÎØºÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'ÎØºÏÇ¨ÏÇ¨Í±¥ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï (2Ï∞®)', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                { name: 'Îì±Í∏∞Ïã†Ï≤≠ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] }
            ],
            subjects: [],  // Will be set dynamically based on examType
            timeBlocks: [],
            mockScores: [],
            weeklyHours: {},
            notes: {},
            // New features data
            streak: {
                current: 0,
                longest: 0,
                lastStudyDate: null,
                totalDays: 0
            },
            goals: [],
            subjectTimeSpent: {},  // Track time spent per subject
            studyHistory: []  // Daily study records
        };
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        function loadData() {
            const saved = localStorage.getItem('studyData');
            if (saved) {
                const loadedData = JSON.parse(saved);
                studyData = { ...studyData, ...loadedData };

                // 2Ï∞® Í≥ºÎ™©Ïù¥ ÏóÜÍ±∞ÎÇò Íµ¨Î≤ÑÏ†ÑÏù∏ Í≤ΩÏö∞ ÏÉàÎ°úÏö¥ Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
                if (!studyData.subjects2nd || studyData.subjects2nd.length === 4) {
                    studyData.subjects2nd = [
                        { name: 'ÎØºÎ≤ï (2Ï∞®)', total: 100, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'ÌòïÎ≤ï (2Ï∞®)', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)', total: 50, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'ÎØºÏÇ¨ÏÜåÏÜ°Î≤ï (2Ï∞®)', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'ÎØºÏÇ¨ÏÇ¨Í±¥ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'Î∂ÄÎèôÏÇ∞Îì±Í∏∞Î≤ï (2Ï∞®)', total: 70, completed: 0, rotations: [false, false, false, false, false, false, false] },
                        { name: 'Îì±Í∏∞Ïã†Ï≤≠ÏÑúÎ•òÏûëÏÑ± (2Ï∞®)', total: 30, completed: 0, rotations: [false, false, false, false, false, false, false] }
                    ];
                }

                // 1Ï∞® Í≥ºÎ™©Ïù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï (Íµ¨Î≤ÑÏ†Ñ Ìò∏ÌôòÏÑ±)
                if (!studyData.subjects1st && studyData.subjects) {
                    studyData.subjects1st = studyData.subjects;
                }
            }

            // ÏãúÌóò ÌÉÄÏûÖÏóê Îî∞Îùº Í≥ºÎ™© ÏÑ§Ï†ï
            updateSubjectsByExamType();

            // Ïò§Îäò ÌÉÄÏù¥Î®∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            const today = new Date().toISOString().split('T')[0];
            const todayTimer = localStorage.getItem(`timer_${today}`);
            if (todayTimer) {
                studyData.timer.seconds = parseInt(todayTimer);
            }
        }

        // ÏãúÌóò ÌÉÄÏûÖÏóê Îî∞Îùº Í≥ºÎ™© ÏÑ§Ï†ï
        function updateSubjectsByExamType() {
            if (studyData.examType === '2Ï∞®') {
                studyData.subjects = studyData.subjects2nd;
            } else {
                studyData.subjects = studyData.subjects1st;
            }
        }
        
        // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveData() {
            try {
                localStorage.setItem('studyData', JSON.stringify(studyData));

                // Ïò§Îäò ÌÉÄÏù¥Î®∏ Î≥ÑÎèÑ Ï†ÄÏû•
                const today = new Date().toISOString().split('T')[0];
                localStorage.setItem(`timer_${today}`, studyData.timer.seconds);
            } catch (e) {
                // FIXED v3.2.2: localStorage Ïö©Îüâ Ï¥àÍ≥º ÏóêÎü¨ Ï≤òÎ¶¨
                if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                    console.warn('localStorage Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨Î•º ÏãúÎèÑÌï©ÎãàÎã§.');
                    // Ïò§ÎûòÎêú ÌÉÄÏù¥Î®∏ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
                    for (let key in localStorage) {
                        if (key.startsWith('timer_')) {
                            localStorage.removeItem(key);
                        }
                    }
                    // Ïû¨ÏãúÎèÑ
                    try {
                        localStorage.setItem('studyData', JSON.stringify(studyData));
                    } catch (retryError) {
                        console.error('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®:', retryError);
                    }
                } else {
                    console.error('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ï§ë Ïò§Î•ò Î∞úÏÉù:', e);
                }
            }
        }
        
        // Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function init() {
            loadData();
            updateDDay();
            updateStreak();
            renderTimeBlocks();
            renderRotationTracker();
            renderWeeklyStats();
            renderSubjectProgress();
            renderMockScores();
            updateTimerDisplay();
            updatePomodoroDisplay();
            document.getElementById('pomodoro-count').textContent = studyData.pomodoro.completedSessions || 0;
            loadTodayNotes();
            rotateMotivation();
            renderAnalytics();
            renderGoals();
            updateFocusHero();
            updateJourneyVisualization();

            // ÏãúÌóò ÌÉÄÏûÖ Î∞è Î™®Îìú ÏÑ§Ï†ï
            document.querySelectorAll('.mode-btn').forEach(btn => {
                const btnText = btn.textContent.trim();
                // ÏãúÌóò ÌÉÄÏûÖ Î≤ÑÌäº
                if (btnText === '1Ï∞® ÏãúÌóò' || btnText === '2Ï∞® ÏãúÌóò') {
                    btn.classList.remove('active');
                    if (btnText === studyData.examType + ' ÏãúÌóò') {
                        btn.classList.add('active');
                    }
                }
                // ÌïôÏäµ Î™®Îìú Î≤ÑÌäº
                else {
                    btn.classList.remove('active');
                    if(btnText.includes(studyData.mode)) {
                        btn.classList.add('active');
                    }
                }
            });
            
            // Í∏∞Î≥∏ ÏãúÍ∞Ñ Î∏îÎ°ùÏù¥ ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä
            if (studyData.timeBlocks.length === 0) {
                studyData.timeBlocks = [
                    { id: Date.now(), time: '05:00-07:00', subject: 'ÎØºÎ≤ï', detail: 'Í∏∞Ï∂úÎ¨∏Ï†ú #201-250', completed: false },
                    { id: Date.now() + 1, time: '19:00-22:00', subject: 'ÌóåÎ≤ï', detail: 'ÏµúÏã†ÌåêÎ°Ä + Í∏∞Ï∂ú ÌöåÎèÖ', completed: false }
                ];
                saveData();
                renderTimeBlocks();
            }
            
            // Í∏∞Î≥∏ Ï†êÏàòÍ∞Ä ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä
            if (studyData.mockScores.length === 0) {
                studyData.mockScores = [
                    { id: Date.now(), date: '2024-09-29', score: 52.5, memo: '1Ï∞® Î™®Ïùò' },
                    { id: Date.now() + 1, date: '2024-10-06', score: 55.0, memo: '2Ï∞® Î™®Ïùò' },
                    { id: Date.now() + 2, date: '2024-10-13', score: 58.5, memo: '3Ï∞® Î™®Ïùò' }
                ];
                saveData();
                renderMockScores();
            }
        }
        
        // D-Day Í≥ÑÏÇ∞ Î∞è ÏóÖÎç∞Ïù¥Ìä∏ (1Ï∞®/2Ï∞®)
        function updateDDay() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // 1Ï∞® ÏãúÌóò D-day
            const exam1stDate = studyData.examDates?.['1Ï∞®'];
            const card1st = document.getElementById('dday-1st-card');
            if (exam1stDate) {
                const targetDate = new Date(exam1stDate);
                targetDate.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

                let ddayText, urgencyClass;
                if (diffDays > 0) {
                    ddayText = `D-${diffDays}`;
                    urgencyClass = diffDays <= 30 ? 'urgent' : (diffDays <= 90 ? 'warning' : 'normal');
                } else if (diffDays === 0) {
                    ddayText = 'D-Day';
                    urgencyClass = 'urgent';
                } else {
                    ddayText = `D+${Math.abs(diffDays)}`;
                    urgencyClass = 'normal';
                }

                document.getElementById('dday-1st-value').textContent = ddayText;
                document.getElementById('dday-1st-date').textContent = exam1stDate;
                card1st.className = `dday-card ${urgencyClass}`;
            } else {
                document.getElementById('dday-1st-value').textContent = 'D-?';
                document.getElementById('dday-1st-date').textContent = 'ÎÇ†Ïßú ÎØ∏ÏÑ§Ï†ï';
                card1st.className = 'dday-card';
            }

            // 2Ï∞® ÏãúÌóò D-day
            const exam2ndDate = studyData.examDates?.['2Ï∞®'];
            const card2nd = document.getElementById('dday-2nd-card');
            if (exam2ndDate) {
                const targetDate = new Date(exam2ndDate);
                targetDate.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));

                let ddayText, urgencyClass;
                if (diffDays > 0) {
                    ddayText = `D-${diffDays}`;
                    urgencyClass = diffDays <= 30 ? 'urgent' : (diffDays <= 90 ? 'warning' : 'normal');
                } else if (diffDays === 0) {
                    ddayText = 'D-Day';
                    urgencyClass = 'urgent';
                } else {
                    ddayText = `D+${Math.abs(diffDays)}`;
                    urgencyClass = 'normal';
                }

                document.getElementById('dday-2nd-value').textContent = ddayText;
                document.getElementById('dday-2nd-date').textContent = exam2ndDate;
                card2nd.className = `dday-card ${urgencyClass}`;
            } else {
                document.getElementById('dday-2nd-value').textContent = 'D-?';
                document.getElementById('dday-2nd-date').textContent = 'ÎÇ†Ïßú ÎØ∏ÏÑ§Ï†ï';
                card2nd.className = 'dday-card';
            }
        }

        // ÏãúÌóò ÎÇ†Ïßú ÏÑ§Ï†ï Î™®Îã¨
        let editingExamType = null;

        function editExamDate(examType) {
            editingExamType = examType;
            document.getElementById('examDateModalTitle').textContent = `${examType} ÏãúÌóò ÎÇ†Ïßú ÏÑ§Ï†ï`;

            const currentDate = studyData.examDates?.[examType];
            document.getElementById('examDateInput').value = currentDate || '';
            document.getElementById('examDateMemo').value = '';

            document.getElementById('examDateModal').classList.add('show');
        }

        function saveExamDate() {
            if (!editingExamType) return;

            const dateValue = document.getElementById('examDateInput').value;

            if (dateValue) {
                if (!studyData.examDates) studyData.examDates = {};
                studyData.examDates[editingExamType] = dateValue;

                saveData();
                updateDDay();
                closeModal('examDateModal');
                showToast(`${editingExamType} ÏãúÌóò ÎÇ†ÏßúÍ∞Ä ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§`);

                editingExamType = null;
            } else {
                showToast('ÏãúÌóò ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }
        
        // ÏãúÌóò ÌÉÄÏûÖ ÏÑ§Ï†ï
        function setExamType(type) {
            studyData.examType = type;
            localStorage.setItem('examType', type);

            // Í≥ºÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            updateSubjectsByExamType();

            saveData();

            document.querySelectorAll('.mode-btn').forEach(btn => {
                if (btn.textContent.includes('ÏãúÌóò')) {
                    btn.classList.remove('active');
                    if (btn.textContent === type + ' ÏãúÌóò') {
                        btn.classList.add('active');
                    }
                }
            });

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            renderRotationTracker();
            renderSubjectProgress();

            showToast(`${type} ÏãúÌóò Î™®ÎìúÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§`);
        }

        // ÏãúÍ∞Ñ Î∏îÎ°ù Î†åÎçîÎßÅ
        function renderTimeBlocks() {
            const container = document.getElementById('time-blocks-container');
            container.innerHTML = '';

            studyData.timeBlocks.forEach(block => {
                const blockEl = document.createElement('div');
                blockEl.className = `time-block ${block.completed ? 'completed' : ''}`;

                // Ïï°ÏÖò Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'time-block-actions';

                // ÏàòÏ†ï Î≤ÑÌäº
                const editBtn = document.createElement('button');
                editBtn.className = 'time-block-btn';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.onclick = () => editTimeBlock(block.id);

                // ÏÇ≠Ï†ú Î≤ÑÌäº
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'time-block-btn';
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.onclick = () => deleteTimeBlock(block.id);

                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);

                // ÏãúÍ∞Ñ ÎùºÎ≤®
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-label';
                const hours = block.hours || 2;
                timeLabel.textContent = `‚è∞ ${block.time} (${hours}h)`;

                // Í≥ºÎ™©Î™Ö
                const subjectDiv = document.createElement('div');
                subjectDiv.className = 'time-subject';
                subjectDiv.textContent = block.subject;

                // ÏÉÅÏÑ∏ ÎÇ¥Ïö©
                const detailDiv = document.createElement('div');
                detailDiv.className = 'time-detail';
                detailDiv.textContent = block.detail;

                // ÏôÑÎ£å Î≤ÑÌäº
                const checkBtn = document.createElement('button');
                checkBtn.className = `check-btn ${block.completed ? 'checked' : ''}`;
                checkBtn.textContent = block.completed ? 'ÏôÑÎ£å‚úì' : 'ÏôÑÎ£å';
                checkBtn.onclick = () => toggleTimeBlock(block.id);

                // Î™®Îëê Ï∂îÍ∞Ä
                blockEl.appendChild(actionsDiv);
                blockEl.appendChild(timeLabel);
                blockEl.appendChild(subjectDiv);
                blockEl.appendChild(detailDiv);
                blockEl.appendChild(checkBtn);

                container.appendChild(blockEl);
            });
        }
        
        // ÏãúÍ∞Ñ Î∏îÎ°ù ÌÜ†Í∏Ä
        function toggleTimeBlock(id) {
            const block = studyData.timeBlocks.find(b => b.id === id);
            if (block) {
                block.completed = !block.completed;
                const hours = block.hours || 2; // Default to 2 hours if not set (legacy compatibility)
                const seconds = hours * 3600;

                if (block.completed) {
                    studyData.timer.seconds += seconds;
                    updateTimerDisplay();
                    showToast(`ÌïôÏäµ ÏôÑÎ£å! ${hours}ÏãúÍ∞ÑÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§ üëè`);
                } else {
                    studyData.timer.seconds = Math.max(0, studyData.timer.seconds - seconds);
                    updateTimerDisplay();
                }
                saveData();
                renderTimeBlocks();
            }
        }
        
        // ÏãúÍ∞Ñ Î∏îÎ°ù Ï∂îÍ∞Ä
        function addTimeBlock() {
            document.getElementById('timeBlockModal').classList.add('show');
        }
        
        // ÏãúÍ∞Ñ Î∏îÎ°ù Ï†ÄÏû•
        function saveTimeBlock() {
            const time = document.getElementById('blockTime').value;
            const subject = document.getElementById('blockSubject').value;
            const hours = parseFloat(document.getElementById('blockHours').value) || 2;
            const detail = document.getElementById('blockDetail').value;

            if (time && subject && detail) {
                if (editingBlockId) {
                    // ÏàòÏ†ï Î™®Îìú
                    const block = studyData.timeBlocks.find(b => b.id === editingBlockId);
                    if (block) {
                        block.time = time;
                        block.subject = subject;
                        block.hours = hours;
                        block.detail = detail;
                        showToast('ÌïôÏäµ Î∏îÎ°ùÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§');
                    }
                    editingBlockId = null;
                } else {
                    // Ï∂îÍ∞Ä Î™®Îìú
                    studyData.timeBlocks.push({
                        id: Date.now(),
                        time,
                        subject,
                        hours,
                        detail,
                        completed: false
                    });
                    showToast('ÌïôÏäµ Î∏îÎ°ùÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§');
                }
                saveData();
                renderTimeBlocks();
                closeModal('timeBlockModal');

                // Reset form
                document.getElementById('blockTime').value = '';
                document.getElementById('blockDetail').value = '';
                document.getElementById('blockHours').value = '2';
                document.querySelector('#timeBlockModal .modal-title').textContent = 'ÌïôÏäµ ÏãúÍ∞Ñ Î∏îÎ°ù Ï∂îÍ∞Ä';
            }
        }
        
        // ÏãúÍ∞Ñ Î∏îÎ°ù ÏÇ≠Ï†ú
        function deleteTimeBlock(id) {
            showConfirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.timeBlocks = studyData.timeBlocks.filter(b => b.id !== id);
                saveData();
                renderTimeBlocks();
                showToast('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
            });
        }
        
        // ÏãúÍ∞Ñ Î∏îÎ°ù ÏàòÏ†ï (Î™®Îã¨ ÏÇ¨Ïö©)
        let editingBlockId = null;

        function editTimeBlock(id) {
            const block = studyData.timeBlocks.find(b => b.id === id);
            if (block) {
                editingBlockId = id;
                document.getElementById('blockTime').value = block.time;
                document.getElementById('blockSubject').value = block.subject;
                document.getElementById('blockHours').value = block.hours || 2;
                document.getElementById('blockDetail').value = block.detail;
                document.querySelector('#timeBlockModal .modal-title').textContent = 'ÌïôÏäµ ÏãúÍ∞Ñ Î∏îÎ°ù ÏàòÏ†ï';
                document.getElementById('timeBlockModal').classList.add('show');
            }
        }
        
        // ÌöåÎèÖ Ìä∏ÎûòÏª§ Î†åÎçîÎßÅ
        function renderRotationTracker() {
            const container = document.getElementById('rotation-tracker');
            container.innerHTML = '';
            
            studyData.subjects.forEach((subject, idx) => {
                const div = document.createElement('div');
                div.className = 'subject-rotation';
                
                let circlesHtml = '';
                subject.rotations.forEach((completed, i) => {
                    const isCurrentjsxjs = completed && !subject.rotations[i + 1];
                    circlesHtml += `
                        <div class="rotation-circle ${completed ? 'completed' : ''} ${isCurrentjsxjs ? 'current' : ''}" 
                             onclick="toggleRotation(${idx}, ${i})">
                            ${i + 1}
                        </div>
                    `;
                });
                
                div.innerHTML = `
                    <span class="subject-name">${subject.name}</span>
                    <div class="rotation-circles">${circlesHtml}</div>
                `;
                container.appendChild(div);
            });
        }
        
        // ÌöåÎèÖ ÌÜ†Í∏Ä
        function toggleRotation(subjectIdx, rotationIdx) {
            const subject = studyData.subjects[subjectIdx];
            subject.rotations[rotationIdx] = !subject.rotations[rotationIdx];
            
            // Ïù¥Ï†Ñ ÌöåÎèÖÏù¥ ÏôÑÎ£åÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ ÏôÑÎ£å Ï≤òÎ¶¨
            for (let i = 0; i < rotationIdx; i++) {
                subject.rotations[i] = true;
            }
            
            saveData();
            renderRotationTracker();
            
            if (subject.rotations[rotationIdx]) {
                showToast(`${subject.name} ${rotationIdx + 1}ÌöåÎèÖ ÏôÑÎ£å! üéâ`);
            }
        }
        
        // ÌöåÎèÖ Ï¥àÍ∏∞Ìôî
        function resetRotations() {
            showConfirm('Î™®Îì† ÌöåÎèÖ Í∏∞Î°ùÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.subjects.forEach(subject => {
                    subject.rotations = [false, false, false, false, false, false, false];
                });
                saveData();
                renderRotationTracker();
                showToast('ÌöåÎèÖ Í∏∞Î°ùÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§');
            });
        }
        
        // ÌÉÄÏù¥Î®∏ Í∏∞Îä•
        function startTimer() {
            if (!studyData.timer.isRunning) {
                studyData.timer.isRunning = true;
                studyData.timer.interval = setInterval(() => {
                    studyData.timer.seconds++;
                    updateTimerDisplay();
                    
                    // 30Î∂ÑÎßàÎã§ ÏûêÎèô Ï†ÄÏû•
                    if (studyData.timer.seconds % 1800 === 0) {
                        saveData();
                        showToast('ÌïôÏäµ ÏßÑÎèÑÍ∞Ä ÏûêÎèô Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                    }
                }, 1000);
            }
        }
        
        function pauseTimer() {
            studyData.timer.isRunning = false;
            clearInterval(studyData.timer.interval);
            saveData();
        }
        
        function resetTimer() {
            showConfirm('Ï†ïÎßê Î¶¨ÏÖãÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.timer.isRunning = false;
                clearInterval(studyData.timer.interval);
                studyData.timer.seconds = 0;
                updateTimerDisplay();
                saveData();
                showToast('ÌÉÄÏù¥Î®∏Í∞Ä Î¶¨ÏÖãÎêòÏóàÏäµÎãàÎã§');
            });
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(studyData.timer.seconds / 3600);
            const minutes = Math.floor((studyData.timer.seconds % 3600) / 60);
            const secs = studyData.timer.seconds % 60;

            document.getElementById('timer').textContent =
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏ Í∏∞Îä•
        function startPomodoro() {
            if (!studyData.pomodoro.isRunning) {
                studyData.pomodoro.isRunning = true;
                document.getElementById('pomodoro-start').style.display = 'none';
                document.getElementById('pomodoro-pause').style.display = 'inline-block';

                studyData.pomodoro.interval = setInterval(() => {
                    if (studyData.pomodoro.seconds > 0) {
                        studyData.pomodoro.seconds--;
                        updatePomodoroDisplay();
                    } else {
                        // Timer finished
                        playNotificationSound();
                        if (studyData.pomodoro.mode === 'work') {
                            // Work session completed
                            studyData.pomodoro.completedSessions++;
                            studyData.pomodoro.mode = 'break';
                            studyData.pomodoro.seconds = 300; // 5 minutes break
                            showToast('ÏûëÏóÖ ÏÑ∏ÏÖò ÏôÑÎ£å! 5Î∂Ñ Ìú¥Ïãù ÏãúÏûë üéâ');
                            document.getElementById('pomodoro-mode').textContent = 'Ìú¥Ïãù ÏãúÍ∞Ñ';
                            document.getElementById('pomodoro-mode').className = 'pomodoro-mode break';
                        } else {
                            // Break completed
                            studyData.pomodoro.mode = 'work';
                            studyData.pomodoro.seconds = 1500; // 25 minutes work
                            showToast('Ìú¥Ïãù ÏôÑÎ£å! ÏÉàÎ°úÏö¥ ÏûëÏóÖ ÏÑ∏ÏÖò ÏãúÏûë üí™');
                            document.getElementById('pomodoro-mode').textContent = 'ÏûëÏóÖ ÏÑ∏ÏÖò';
                            document.getElementById('pomodoro-mode').className = 'pomodoro-mode work';
                        }
                        updatePomodoroDisplay();
                        document.getElementById('pomodoro-count').textContent = studyData.pomodoro.completedSessions;
                        pausePomodoro(); // Auto pause after completion
                        saveData();
                    }
                }, 1000);
            }
        }

        function pausePomodoro() {
            studyData.pomodoro.isRunning = false;
            clearInterval(studyData.pomodoro.interval);
            document.getElementById('pomodoro-start').style.display = 'inline-block';
            document.getElementById('pomodoro-pause').style.display = 'none';
            saveData();
        }

        function resetPomodoro() {
            showConfirm('Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏Î•º Î¶¨ÏÖãÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                pausePomodoro();
                studyData.pomodoro.seconds = 1500; // Reset to 25 minutes
                studyData.pomodoro.mode = 'work';
                studyData.pomodoro.completedSessions = 0;
                updatePomodoroDisplay();
                document.getElementById('pomodoro-count').textContent = '0';
                document.getElementById('pomodoro-mode').textContent = 'ÏûëÏóÖ ÏÑ∏ÏÖò';
                document.getElementById('pomodoro-mode').className = 'pomodoro-mode work';
                saveData();
                showToast('Ìè¨Î™®ÎèÑÎ°ú ÌÉÄÏù¥Î®∏Í∞Ä Î¶¨ÏÖãÎêòÏóàÏäµÎãàÎã§');
            });
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(studyData.pomodoro.seconds / 60);
            const secs = studyData.pomodoro.seconds % 60;
            document.getElementById('pomodoro-timer').textContent =
                `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function playNotificationSound() {
            // Create a simple beep sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio notification not supported');
            }
        }

        // Ï£ºÍ∞Ñ ÌÜµÍ≥Ñ Î†åÎçîÎßÅ
        function renderWeeklyStats() {
            const container = document.getElementById('weekly-stats');
            container.innerHTML = '';
            
            const days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
            const today = new Date().getDay();
            const adjustedToday = today === 0 ? 6 : today - 1;
            
            days.forEach((day, idx) => {
                const hours = studyData.weeklyHours[day] || 0;
                const isToday = idx === adjustedToday;
                const isCompleted = hours >= 4;
                
                const div = document.createElement('div');
                div.className = `day-stat ${isToday ? 'today' : ''} ${isCompleted ? 'completed' : ''}`;
                div.innerHTML = `
                    <div class="day-name">${day}</div>
                    <div class="day-hours">${hours}h</div>
                `;
                div.onclick = () => updateDayHours(day);
                container.appendChild(div);
            });
        }
        
        // ÏùºÏùº ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ - Î™®Îã¨ ÏÇ¨Ïö©
        let editingWeekDay = null;

        function updateDayHours(day) {
            editingWeekDay = day;
            document.getElementById('weeklyHoursModalTitle').textContent = `${day}ÏöîÏùº ÌïôÏäµ ÏãúÍ∞Ñ ÏàòÏ†ï`;
            document.getElementById('weeklyHoursInput').value = studyData.weeklyHours[day] || 0;
            document.getElementById('weeklyHoursModal').classList.add('show');
        }

        function saveWeeklyHours() {
            if (!editingWeekDay) return;

            const hours = parseFloat(document.getElementById('weeklyHoursInput').value);

            if (!isNaN(hours) && hours >= 0) {
                studyData.weeklyHours[editingWeekDay] = hours;
                saveData();
                renderWeeklyStats();
                updateAnalytics();
                closeModal('weeklyHoursModal');
                showToast(`${editingWeekDay}ÏöîÏùº ÌïôÏäµ ÏãúÍ∞ÑÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§`);
                editingWeekDay = null;
            } else {
                showToast('Ïò¨Î∞îÎ•∏ ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }
        
        // Í≥ºÎ™©Î≥Ñ ÏßÑÎèÑ Î†åÎçîÎßÅ
        function renderSubjectProgress() {
            const container = document.getElementById('subject-progress');
            container.innerHTML = '';

            studyData.subjects.forEach((subject, idx) => {
                const percent = Math.round((subject.completed / subject.total) * 100);
                const div = document.createElement('div');
                div.className = 'progress-item';

                // Ìó§Îçî ÏÉùÏÑ±
                const header = document.createElement('div');
                header.className = 'progress-header';
                header.innerHTML = `
                    <span class="progress-label">${subject.name}</span>
                    <span class="progress-value">${subject.completed}/${subject.total} Î¨∏Ï†ú</span>
                `;
                header.onclick = () => updateProgress(idx);

                // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î ÏÉùÏÑ±
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.innerHTML = `
                    <div class="progress-fill" style="width: ${percent}%">${percent}%</div>
                `;
                progressBar.onclick = () => updateProgress(idx);

                div.appendChild(header);
                div.appendChild(progressBar);
                container.appendChild(div);
            });
        }

        // ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ - Î™®Îã¨ ÏÇ¨Ïö©
        let editingSubjectIdx = null;

        function updateProgress(idx) {
            const subject = studyData.subjects[idx];
            editingSubjectIdx = idx;

            document.getElementById('subjectProgressModalTitle').textContent = `${subject.name} ÏßÑÎèÑ ÏàòÏ†ï`;
            document.getElementById('subjectCompleted').value = subject.completed;
            document.getElementById('subjectTotal').value = subject.total;
            document.getElementById('subjectProgressModal').classList.add('show');
        }

        function saveSubjectProgress() {
            if (editingSubjectIdx === null) return;

            const completed = parseInt(document.getElementById('subjectCompleted').value);
            const total = parseInt(document.getElementById('subjectTotal').value);

            if (!isNaN(completed) && !isNaN(total) && total >= 1) {
                const subject = studyData.subjects[editingSubjectIdx];
                subject.completed = completed;
                subject.total = Math.max(total, 1);

                // Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§ÏóêÎèÑ Î∞òÏòÅ
                if (studyData.examType === '2Ï∞®') {
                    studyData.subjects2nd[editingSubjectIdx] = subject;
                } else {
                    studyData.subjects1st[editingSubjectIdx] = subject;
                }

                saveData();
                renderSubjectProgress();
                closeModal('subjectProgressModal');
                showToast(`${subject.name} ÏßÑÎèÑÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§ (${subject.completed}/${subject.total})`);

                editingSubjectIdx = null;
            } else {
                showToast('Ïò¨Î∞îÎ•∏ Ïà´ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }
        
        // Ï†ÑÏ≤¥ ÏßÑÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAllProgress() {
            showToast('Í∞Å Í≥ºÎ™©ÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÏßÑÎèÑÎ•º ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏÑ∏Ïöî');
        }
        
        // Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Î†åÎçîÎßÅ
        function renderMockScores() {
            const container = document.getElementById('mock-scores');
            container.innerHTML = '';

            studyData.mockScores.forEach(score => {
                const isPass = score.score >= 60;
                const div = document.createElement('div');
                div.className = 'score-entry';

                // ÎÇ†Ïßú Î∞è Î©îÎ™® ÌëúÏãú
                const dateSpan = document.createElement('span');
                dateSpan.className = 'score-date';
                dateSpan.textContent = `${score.date} ${score.memo ? `(${score.memo})` : ''}`;

                // Ïï°ÏÖò Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'score-actions';

                // ÏàòÏ†ï Î≤ÑÌäº
                const editBtn = document.createElement('button');
                editBtn.className = 'score-action-btn';
                editBtn.textContent = '‚úèÔ∏è';
                editBtn.onclick = () => editScore(score.id);

                // ÏÇ≠Ï†ú Î≤ÑÌäº
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'score-action-btn';
                deleteBtn.textContent = 'üóëÔ∏è';
                deleteBtn.onclick = () => deleteScore(score.id);

                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);

                // Ï†êÏàò ÌëúÏãú
                const scoreSpan = document.createElement('span');
                scoreSpan.className = `score-value ${isPass ? 'pass' : 'fail'}`;
                scoreSpan.textContent = `${score.score}Ï†ê`;

                div.appendChild(dateSpan);
                div.appendChild(actionsDiv);
                div.appendChild(scoreSpan);

                container.appendChild(div);
            });

            // Î™©Ìëú Ï†êÏàò ÌëúÏãú
            const targetDiv = document.createElement('div');
            targetDiv.className = 'score-entry';
            targetDiv.innerHTML = `
                <span class="score-date">Î™©Ìëú Ï†êÏàò</span>
                <span class="score-value pass">65.0Ï†ê‚Üë</span>
            `;
            container.appendChild(targetDiv);
        }
        
        // Ï†êÏàò Î™®Îã¨ ÌëúÏãú
        function showScoreModal() {
            document.getElementById('scoreDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('scoreValue').value = '';
            document.getElementById('scoreMemo').value = '';
            document.getElementById('scoreModal').classList.add('show');
        }
        
        // Ï†êÏàò Ï†ÄÏû•
        function saveScore() {
            const date = document.getElementById('scoreDate').value;
            const scoreValue = parseFloat(document.getElementById('scoreValue').value);
            const memo = document.getElementById('scoreMemo').value;

            if (date && !isNaN(scoreValue)) {
                if (editingScoreId) {
                    // ÏàòÏ†ï Î™®Îìú
                    const score = studyData.mockScores.find(s => s.id === editingScoreId);
                    if (score) {
                        score.date = date;
                        score.score = scoreValue;
                        score.memo = memo;
                        showToast('Ï†êÏàòÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§');
                    }
                    editingScoreId = null;
                } else {
                    // Ï∂îÍ∞Ä Î™®Îìú
                    studyData.mockScores.push({
                        id: Date.now(),
                        date,
                        score: scoreValue,
                        memo
                    });
                    showToast(`${scoreValue}Ï†êÏù¥ Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§`);
                }

                // ÎÇ†ÏßúÏàú Ï†ïÎ†¨
                studyData.mockScores.sort((a, b) => new Date(a.date) - new Date(b.date));

                saveData();
                renderMockScores();
                closeModal('scoreModal');

                // Reset form and title
                document.getElementById('scoreDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('scoreValue').value = '';
                document.getElementById('scoreMemo').value = '';
                document.querySelector('#scoreModal .modal-title').textContent = 'Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÍ∞Ä';
            } else {
                showToast('ÎÇ†ÏßúÏôÄ Ï†êÏàòÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }
        
        // Ï†êÏàò ÏÇ≠Ï†ú
        function deleteScore(id) {
            showConfirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.mockScores = studyData.mockScores.filter(s => s.id !== id);
                saveData();
                renderMockScores();
                showToast('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
            });
        }
        
        // Ï†êÏàò ÏàòÏ†ï - Î™®Îã¨ ÏÇ¨Ïö©
        let editingScoreId = null;

        function editScore(id) {
            const score = studyData.mockScores.find(s => s.id === id);
            if (score) {
                editingScoreId = id;
                document.getElementById('scoreDate').value = score.date;
                document.getElementById('scoreValue').value = score.score;
                document.getElementById('scoreMemo').value = score.memo || '';
                document.querySelector('#scoreModal .modal-title').textContent = 'Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò ÏàòÏ†ï';
                document.getElementById('scoreModal').classList.add('show');
            }
        }
        
        // Î™®Îã¨ Îã´Í∏∞
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // ÌôïÏù∏ Î™®Îã¨ Ìó¨Ìçº (confirm ÎåÄÏ≤¥)
        function showConfirm(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('show');

            const confirmBtn = document.getElementById('confirmOkBtn');
            const newBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newBtn, confirmBtn);

            newBtn.onclick = () => {
                closeModal('confirmModal');
                if (onConfirm) onConfirm();
            };
        }

        // Î©îÏãúÏßÄ Î™®Îã¨ Ìó¨Ìçº (alert ÎåÄÏ≤¥ - HTML ÏßÄÏõê)
        function showModalMessage(title, htmlContent) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">${title}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        ${htmlContent}
                    </div>
                    <div class="modal-footer">
                        <button class="modal-btn save" onclick="this.closest('.modal').remove()">ÌôïÏù∏</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ÎÖ∏Ìä∏ Í∏∞Îä•
        function saveNotes() {
            const notes = document.getElementById('study-notes').value;
            const today = new Date().toISOString().split('T')[0];
            
            if (!studyData.notes) studyData.notes = {};
            studyData.notes[today] = {
                content: notes,
                timestamp: new Date().toISOString()
            };
            
            saveData();
            showToast('ÎÖ∏Ìä∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§ üìù');
        }
        
        function loadTodayNotes() {
            const today = new Date().toISOString().split('T')[0];
            if (studyData.notes && studyData.notes[today]) {
                document.getElementById('study-notes').value = studyData.notes[today].content;
            }
        }
        
        function showPreviousNotes() {
            if (!studyData.notes) {
                showToast('Ï†ÄÏû•Îêú ÎÖ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            const dates = Object.keys(studyData.notes).sort().reverse();
            if (dates.length === 0) {
                showToast('Ï†ÄÏû•Îêú ÎÖ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§');
                return;
            }
            
            let notesList = '<h3 style="margin-bottom:15px">üìö ÏµúÍ∑º ÌïôÏäµ ÎÖ∏Ìä∏</h3>';
            dates.slice(0, 7).forEach(date => {
                const content = studyData.notes[date].content;
                notesList += `<div style="margin-bottom:15px;padding:10px;background:#f7fafc;border-radius:6px">
                    <strong>üìÖ ${date}</strong><br>
                    ${content.substring(0, 150)}...
                </div>`;
            });

            showModalMessage('ÏµúÍ∑º ÌïôÏäµ ÎÖ∏Ìä∏', notesList);
        }
        
        function exportNotes() {
            const dataStr = JSON.stringify(studyData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `study_data_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Îç∞Ïù¥ÌÑ∞Í∞Ä ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§ üíæ');
        }
        
        function addErrorNote() {
            document.getElementById('wrongSubject').value = '';
            document.getElementById('wrongQuestion').value = '';
            document.getElementById('wrongReason').value = '';
            document.getElementById('wrongNoteModal').classList.add('show');
        }

        function saveWrongNote() {
            const subject = document.getElementById('wrongSubject').value;
            const question = document.getElementById('wrongQuestion').value;
            const reason = document.getElementById('wrongReason').value;

            if (subject && question && reason) {
                const errorNote = `\n\n[Ïò§ÎãµÎÖ∏Ìä∏]\nÍ≥ºÎ™©: ${subject}\nÎ¨∏Ï†ú: ${question}\nÏù¥Ïú†: ${reason}\n`;
                document.getElementById('study-notes').value += errorNote;
                closeModal('wrongNoteModal');
                showToast('Ïò§ÎãµÎÖ∏Ìä∏Í∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§');
            } else {
                showToast('Î™®Îì† Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }
        
        function clearNotes() {
            showConfirm('Ïò§Îäò ÎÖ∏Ìä∏Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                document.getElementById('study-notes').value = '';
                showToast('ÎÖ∏Ìä∏Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§');
            });
        }
        
        // ÎèôÍ∏∞Î∂ÄÏó¨ Î¨∏Íµ¨ Î°úÌÖåÏù¥ÏÖò
        function rotateMotivation() {
            const quotes = [
                "Ìè¨Í∏∞ÌïòÏßÄ ÏïäÏúºÎ©¥ Î∞òÎìúÏãú Ìï©Í≤©ÌïúÎã§. ÏãúÌóòÏùÄ ÎÅùÍπåÏßÄ Î≤ÑÌã∞Îäî Í≤ÉÏûÖÎãàÎã§.",
                "Î®∏Î¶¨Î≥¥Îã§ Ï§ëÏöîÌïú Í≤ÉÏùÄ ÏóâÎç©Ïù¥Î•º Ïò§Îûò Î∂ôÏù¥Í≥† ÏûàÏùÑ Ïàò ÏûàÎäî Í≤É.",
                "ÏßÅÏû•Î≥ëÌñâÏù¥ÎùºÎèÑ Îß§Ïùº Íæ∏Ï§ÄÌûà ÌïòÎ©¥ Ìï©Í≤©Ìï† Ïàò ÏûàÏäµÎãàÎã§.",
                "Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàòÍ∞Ä ÎÇÆÏïÑÎèÑ Ìè¨Í∏∞ÌïòÏßÄ ÎßàÏÑ∏Ïöî. ÎÅùÍπåÏßÄ Í∞ÄÎ©¥ Îê©ÎãàÎã§.",
                "Í∏∞Ï∂úÎ¨∏Ï†úÎ•º ÏôÑÏ†ÑÌûà ÎÇ¥ Í≤ÉÏúºÎ°ú ÎßåÎìúÎäî Í≤ÉÏù¥ Ìï©Í≤©Ïùò ÏßÄÎ¶ÑÍ∏∏ÏûÖÎãàÎã§.",
                "Ïò§Îäò Î™ªÌïú Í≥µÎ∂ÄÎäî ÎÇ¥Ïùº Îëê Î∞∞Í∞Ä Îê©ÎãàÎã§. Ïò§Îäò Ìï† ÏùºÏùÄ Ïò§Îäò!",
                "1ÎÖÑ Î∞òÏùò ÎÖ∏Î†•Ïù¥ ÌèâÏÉùÏùò ÏûêÍ≤©Ï¶ùÏù¥ Îê©ÎãàÎã§.",
                "ÏãúÌóòÏùÄ Ïûò Î™®Î•¥Îäî ÏÉÅÌÉúÏóêÏÑú Î∂ôÎäî Í±∞Îã§.",
                "ÎÇ®Îì§ÎèÑ Ïñ¥Î†µÏäµÎãàÎã§. ÎÇòÎßå Ïñ¥Î†§Ïö¥ Í≤ÉÏù¥ ÏïÑÎãôÎãàÎã§.",
                "Î≤ÑÌã∞Î©¥ Ìï©Í≤©ÌïúÎã§. ÎÅùÍπåÏßÄ Î≤ÑÌã∞Îäî Í≤ÉÏûÖÎãàÎã§."
            ];
            
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('motivation-quote').textContent = randomQuote;
        }
        
        // ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ (ÌÉÄÏûÖ ÏßÄÏõê: success, error, warning, info)
        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.success}</span>
                <span class="toast-message">${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutToast 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
        document.addEventListener('keydown', function(e) {
            // ESC ÌÇ§Î°ú Î™®Îì† Î™®Îã¨ Îã´Í∏∞
            if (e.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal.show');
                openModals.forEach(modal => {
                    if (modal.id) {
                        closeModal(modal.id);
                    } else {
                        modal.remove(); // ÎèôÏ†Å ÏÉùÏÑ±Îêú Î™®Îã¨
                    }
                });
                return;
            }

            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveNotes();
                        break;
                    case ' ':
                        e.preventDefault();
                        if (studyData.timer.isRunning) pauseTimer();
                        else startTimer();
                        break;
                }
            }
        });
        
        // ÌéòÏù¥ÏßÄ Ï¢ÖÎ£å Ïãú ÏûêÎèô Ï†ÄÏû•
        window.addEventListener('beforeunload', function() {
            saveData();
            if (document.getElementById('study-notes').value) {
                saveNotes();
            }
        });
        
        // 5Î∂ÑÎßàÎã§ ÎèôÍ∏∞Î∂ÄÏó¨ Î¨∏Íµ¨ Î≥ÄÍ≤Ω
        setInterval(rotateMotivation, 300000);

        // ===== Ïú†Ìã∏Î¶¨Ìã∞: Ï¥ù ÌïôÏäµ ÏãúÍ∞Ñ Í≥ÑÏÇ∞ =====
        function calculateTotalHours() {
            let totalHours = 0;

            // 1. From timer
            totalHours += studyData.timer.seconds / 3600;

            // 2. From completed time blocks
            studyData.timeBlocks.forEach(block => {
                if (block.completed) {
                    totalHours += block.hours || 0;
                }
            });

            // 3. From weekly hours tracking
            Object.values(studyData.weeklyHours).forEach(h => totalHours += h);

            return totalHours;
        }

        // ===== ÏÉàÎ°úÏö¥ Í∏∞Îä•: Ïä§Ìä∏Î¶≠ Ìä∏ÎûòÏª§ =====
        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const lastStudy = studyData.streak.lastStudyDate;

            // Ï¥àÍ∏∞Ìôî
            if (!studyData.streak) {
                studyData.streak = { current: 0, longest: 0, lastStudyDate: null, totalDays: 0 };
            }

            // Ïò§Îäò ÌïôÏäµ Í∏∞Î°ùÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏ (ÌÉÄÏù¥Î®∏ ÏãúÍ∞Ñ or ÏôÑÎ£åÎêú ÌÉÄÏûÑÎ∏îÎ°ù)
            const hasStudiedToday = studyData.timer.seconds > 0 ||
                                   studyData.timeBlocks.some(b => b.completed);

            if (hasStudiedToday && lastStudy !== today) {
                if (lastStudy) {
                    const lastDate = new Date(lastStudy);
                    const todayDate = new Date(today);
                    const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));

                    if (diffDays === 1) {
                        // Ïó∞ÏÜç ÌïôÏäµ
                        studyData.streak.current++;
                    } else if (diffDays > 1) {
                        // Ïä§Ìä∏Î¶≠ ÎÅäÍπÄ
                        studyData.streak.current = 1;
                    }
                } else {
                    // Ï≤´ ÌïôÏäµ
                    studyData.streak.current = 1;
                }

                studyData.streak.lastStudyDate = today;
                studyData.streak.totalDays++;

                // ÏµúÏû• Í∏∞Î°ù Í∞±Ïã†
                if (studyData.streak.current > studyData.streak.longest) {
                    studyData.streak.longest = studyData.streak.current;
                }

                saveData();
            }

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('current-streak').textContent = studyData.streak.current || 0;
            document.getElementById('longest-streak').textContent = studyData.streak.longest || 0;
            document.getElementById('total-study-days').textContent = studyData.streak.totalDays || 0;
        }

        function resetStreak() {
            showConfirm('Ïä§Ìä∏Î¶≠ Í∏∞Î°ùÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.streak = { current: 0, longest: 0, lastStudyDate: null, totalDays: 0 };
                saveData();
                updateStreak();
                showToast('Ïä§Ìä∏Î¶≠Ïù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§');
            });
        }

        // ===== ÏÉàÎ°úÏö¥ Í∏∞Îä•: ÌïôÏäµ Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú =====
        function renderAnalytics() {
            // Calculate REAL total study hours from multiple sources
            const totalHours = calculateTotalHours();

            document.getElementById('total-study-hours').textContent = Math.round(totalHours) + 'h';

            // Calculate actual study days from history
            const uniqueStudyDays = new Set();
            studyData.timeBlocks.forEach(block => {
                if (block.completed && block.time) {
                    const dateKey = block.time.split('T')[0];
                    uniqueStudyDays.add(dateKey);
                }
            });

            if (studyData.studyHistory && studyData.studyHistory.length > 0) {
                studyData.studyHistory.forEach(day => {
                    uniqueStudyDays.add(day.date);
                });
            }

            const actualStudyDays = Math.max(uniqueStudyDays.size, studyData.streak.totalDays || 1, 1);
            const avgHours = totalHours / actualStudyDays;
            document.getElementById('avg-daily-hours').textContent = avgHours.toFixed(1) + 'h';

            // Calculate overall progress from BOTH 1st and 2nd exam subjects
            let totalCompleted = 0;
            let totalProblems = 0;

            studyData.subjects.forEach(s => {
                totalCompleted += s.completed;
                totalProblems += s.total;
            });

            const overallProgress = totalProblems > 0 ? Math.round((totalCompleted / totalProblems) * 100) : 0;
            document.getElementById('overall-progress').textContent = overallProgress + '%';

            // Calculate mock exam average from REAL user data
            let avgScore = 0;
            if (studyData.mockScores.length > 0) {
                avgScore = studyData.mockScores.reduce((sum, s) => sum + s.score, 0) / studyData.mockScores.length;
                document.getElementById('avg-mock-score').textContent = avgScore.toFixed(1) + 'Ï†ê';
            } else {
                document.getElementById('avg-mock-score').textContent = '-';
            }

            // Update benchmark progress bars
            updateBenchmarkProgress(totalHours, avgHours, overallProgress, avgScore);

            // Render enhanced charts with real data
            renderSubjectTimeChart();
            renderMockScoreChart();
        }

        function updateBenchmarkProgress(totalHours, avgHours, overallProgress, avgScore) {
            // Total study hours benchmark: 800-1200h (use 1000 as target)
            const totalHoursPercent = Math.min((totalHours / 1000) * 100, 100);
            const totalHoursBar = document.getElementById('total-hours-progress');
            if (totalHoursBar) {
                totalHoursBar.style.width = totalHoursPercent + '%';
                // Color coding
                if (totalHoursPercent >= 80) {
                    totalHoursBar.style.background = 'linear-gradient(90deg, var(--success-color), #34D399)';
                } else if (totalHoursPercent >= 50) {
                    totalHoursBar.style.background = 'linear-gradient(90deg, var(--accent-color), var(--success-color))';
                } else {
                    totalHoursBar.style.background = 'linear-gradient(90deg, var(--warning-color), var(--accent-color))';
                }
            }

            // Daily average benchmark: 4-5h (use 4.5 as target)
            const dailyHoursPercent = Math.min((avgHours / 4.5) * 100, 100);
            const dailyHoursBar = document.getElementById('daily-hours-progress');
            if (dailyHoursBar) {
                dailyHoursBar.style.width = dailyHoursPercent + '%';
                if (dailyHoursPercent >= 90) {
                    dailyHoursBar.style.background = 'linear-gradient(90deg, var(--success-color), #34D399)';
                } else if (dailyHoursPercent >= 60) {
                    dailyHoursBar.style.background = 'linear-gradient(90deg, var(--accent-color), var(--success-color))';
                } else {
                    dailyHoursBar.style.background = 'linear-gradient(90deg, var(--warning-color), var(--accent-color))';
                }
            }

            // Overall progress benchmark: 100%
            const progressBar = document.getElementById('progress-bar');
            if (progressBar) {
                progressBar.style.width = overallProgress + '%';
                if (overallProgress >= 90) {
                    progressBar.style.background = 'linear-gradient(90deg, var(--success-color), #34D399)';
                } else if (overallProgress >= 50) {
                    progressBar.style.background = 'linear-gradient(90deg, var(--accent-color), var(--success-color))';
                } else {
                    progressBar.style.background = 'linear-gradient(90deg, var(--warning-color), var(--accent-color))';
                }
            }

            // Mock score benchmark: 60 points (passing grade)
            const mockScorePercent = avgScore > 0 ? Math.min((avgScore / 100) * 100, 100) : 0;
            const mockScoreBar = document.getElementById('mock-score-progress');
            if (mockScoreBar) {
                mockScoreBar.style.width = mockScorePercent + '%';
                if (avgScore >= 60) {
                    mockScoreBar.style.background = 'linear-gradient(90deg, var(--success-color), #34D399)';
                } else if (avgScore >= 40) {
                    mockScoreBar.style.background = 'linear-gradient(90deg, var(--accent-color), var(--success-color))';
                } else if (avgScore > 0) {
                    mockScoreBar.style.background = 'linear-gradient(90deg, var(--danger-color), var(--warning-color))';
                }
            }

            // V3.2.0: Update insights for each metric (Ïπ¥Îìú Í∞Ñ Ïó∞Îèô)
            updateAnalyticsInsights(totalHours, avgHours, overallProgress, avgScore);
        }

        /**
         * V3.2.0: Î∂ÑÏÑù Ïπ¥Îìú Í∞Ñ Ïú†Í∏∞Ï†Å Ïó∞Îèô - Ïù∏ÏÇ¨Ïù¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
         */
        function updateAnalyticsInsights(totalHours, avgHours, overallProgress, avgScore) {
            // Ï¥ù ÌïôÏäµ ÏãúÍ∞Ñ Ïù∏ÏÇ¨Ïù¥Ìä∏
            const totalHoursInsight = document.getElementById('total-hours-insight');
            if (totalHoursInsight) {
                let message = '', className = '';
                if (totalHours >= 800) {
                    message = '‚úÖ Ìï©Í≤©Ïûê ÌèâÍ∑† Îã¨ÏÑ±! Íæ∏Ï§ÄÌûà Ïú†ÏßÄÌïòÏÑ∏Ïöî.';
                    className = 'positive';
                } else if (totalHours >= 400) {
                    message = `üí™ Ï†àÎ∞ò Ïù¥ÏÉÅ Îã¨ÏÑ±! ÏïûÏúºÎ°ú ${Math.round(800 - totalHours)}ÏãúÍ∞Ñ Îçî ÌïÑÏöîÌï©ÎãàÎã§.';
                    className = 'positive';
                } else if (totalHours >= 100) {
                    message = `üìà Ï¢ãÏùÄ ÏãúÏûëÏûÖÎãàÎã§! Î™©ÌëúÍπåÏßÄ ${Math.round(800 - totalHours)}ÏãúÍ∞Ñ ÎÇ®ÏïòÏñ¥Ïöî.`;
                    className = 'warning';
                } else {
                    message = 'üöÄ ÏßÄÍ∏à ÏãúÏûëÌïòÏÑ∏Ïöî! Îß§Ïùº 4ÏãúÍ∞ÑÏî© ÌïôÏäµÌïòÎ©¥ 6-7Í∞úÏõîÏù¥Î©¥ Îê©ÎãàÎã§.';
                    className = 'warning';
                }
                totalHoursInsight.textContent = message;
                totalHoursInsight.className = 'analytics-insight ' + className;
            }

            // ÏùºÌèâÍ∑† ÌïôÏäµ Ïù∏ÏÇ¨Ïù¥Ìä∏
            const dailyHoursInsight = document.getElementById('daily-hours-insight');
            if (dailyHoursInsight) {
                let message = '', className = '';
                if (avgHours >= 5) {
                    message = 'üåü ÌÉÅÏõîÌï©ÎãàÎã§! Ìï©Í≤©Ïûê ÌèâÍ∑†ÏùÑ Ï¥àÍ≥ºÌïòÍ≥† ÏûàÏñ¥Ïöî.';
                    className = 'positive';
                } else if (avgHours >= 4) {
                    message = '‚úÖ ÏôÑÎ≤ΩÌï©ÎãàÎã§! Ìï©Í≤©Ïûê ÌèâÍ∑† ÏàòÏ§ÄÏùÑ Ïú†ÏßÄÌïòÏÑ∏Ïöî.';
                    className = 'positive';
                } else if (avgHours >= 2) {
                    message = `‚¨ÜÔ∏è Ï°∞Í∏à Îçî! ÌïòÎ£® ${(4 - avgHours).toFixed(1)}ÏãúÍ∞ÑÎßå Îçî Ìà¨ÏûêÌïòÏÑ∏Ïöî.`;
                    className = 'warning';
                } else {
                    message = '‚ö†Ô∏è ÌïôÏäµÎüâÏùÑ ÎäòÎ†§Ïïº Ìï©ÎãàÎã§. ÌïòÎ£® 4-5ÏãúÍ∞ÑÏùÑ Î™©ÌëúÎ°ú ÌïòÏÑ∏Ïöî.';
                    className = 'negative';
                }
                dailyHoursInsight.textContent = message;
                dailyHoursInsight.className = 'analytics-insight ' + className;
            }

            // Ï†ÑÏ≤¥ ÏßÑÎèÑÏú® Ïù∏ÏÇ¨Ïù¥Ìä∏
            const progressInsight = document.getElementById('progress-insight');
            if (progressInsight) {
                let message = '', className = '';
                const daysToExam = calculateDaysToExam();
                if (overallProgress >= 90) {
                    message = 'üéâ Í±∞Ïùò ÏôÑÎ£å! Î≥µÏäµÍ≥º Î™®ÏùòÍ≥†ÏÇ¨Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.';
                    className = 'positive';
                } else if (overallProgress >= 70) {
                    message = 'üíØ ÏßÑÎèÑÍ∞Ä ÏàúÏ°∞Î°≠ÏäµÎãàÎã§! Ïù¥ ÌéòÏù¥Ïä§Î•º Ïú†ÏßÄÌïòÏÑ∏Ïöî.';
                    className = 'positive';
                } else if (overallProgress >= 40) {
                    message = `üìö Ï¢ãÏäµÎãàÎã§! ${Math.round(100 - overallProgress)}% ÎÇ®ÏïòÏñ¥Ïöî.`;
                    className = 'positive';
                } else if (daysToExam && daysToExam < 90) {
                    message = `‚è∞ ÏãúÌóòÍπåÏßÄ ${daysToExam}Ïùº! ÏßÑÎèÑÎ•º Îçî Îπ†Î•¥Í≤å ÎÇòÍ∞ÄÏÑ∏Ïöî.`;
                    className = 'warning';
                } else {
                    message = 'üéØ Íæ∏Ï§ÄÌûà ÏßÑÎèÑÎ•º ÎÇòÍ∞ÄÎ©¥ Ï∂©Î∂ÑÌûà ÏôÑÏ£ºÌï† Ïàò ÏûàÏñ¥Ïöî!';
                    className = 'warning';
                }
                progressInsight.textContent = message;
                progressInsight.className = 'analytics-insight ' + className;
            }

            // Î™®ÏùòÍ≥†ÏÇ¨ ÌèâÍ∑† Ïù∏ÏÇ¨Ïù¥Ìä∏
            const mockScoreInsight = document.getElementById('mock-score-insight');
            if (mockScoreInsight) {
                let message = '', className = '';
                if (avgScore >= 70) {
                    message = 'üèÜ Ìï©Í≤©Í∂å! Ïù¥ ÏàòÏ§ÄÏùÑ Ïú†ÏßÄÌïòÎ©¥ Ìï©Í≤© Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏäµÎãàÎã§.';
                    className = 'positive';
                } else if (avgScore >= 60) {
                    message = '‚úÖ Ìï©Í≤©ÏÑ† ÌÜµÍ≥º! 70Ï†ê Ïù¥ÏÉÅÏùÑ Î™©ÌëúÎ°ú ÏïàÏ†ïÍ∂åÏùÑ ÌôïÎ≥¥ÌïòÏÑ∏Ïöî.';
                    className = 'positive';
                } else if (avgScore >= 50) {
                    message = `üìà Í±∞Ïùò Îã§ ÏôîÏñ¥Ïöî! ${Math.round(60 - avgScore)}Ï†êÎßå Îçî Ïò¨Î¶¨Î©¥ Îê©ÎãàÎã§.`;
                    className = 'warning';
                } else if (avgScore > 0) {
                    message = 'üí™ ÏïΩÏ†ê Í≥ºÎ™©ÏùÑ ÏßëÏ§ë Í≥µÎûµÌïòÏÑ∏Ïöî. Ìï©Í≤©ÏÑ†ÍπåÏßÄ ' + Math.round(60 - avgScore) + 'Ï†ê ÌïÑÏöîÌï©ÎãàÎã§.';
                    className = 'negative';
                } else {
                    message = 'üìù Î™®ÏùòÍ≥†ÏÇ¨Î•º ÌíÄÏñ¥Î≥¥ÏÑ∏Ïöî! ÌòÑÏû¨ Ïã§Î†•ÏùÑ ÌååÏïÖÌïòÎäî Í≤ÉÏù¥ Ï§ëÏöîÌï©ÎãàÎã§.';
                    className = 'warning';
                }
                mockScoreInsight.textContent = message;
                mockScoreInsight.className = 'analytics-insight ' + className;
            }
        }

        /**
         * ÏãúÌóòÍπåÏßÄ ÎÇ®ÏùÄ ÏùºÏàò Í≥ÑÏÇ∞
         */
        function calculateDaysToExam() {
            const examType = studyData.examType || '1Ï∞®';
            const examDateStr = studyData.examDates?.[examType];
            if (!examDateStr) return null;

            const examDate = new Date(examDateStr);
            const today = new Date();
            const diffTime = examDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? diffDays : null;
        }


        function renderSubjectTimeChart() {
            const container = document.getElementById('subject-time-chart');
            container.innerHTML = '';

            // Calculate REAL time spent per subject
            const subjectTime = {};

            // Initialize with 0 for all subjects
            studyData.subjects.forEach(subject => {
                subjectTime[subject.name] = 0;
            });

            // 1. Add time from completed time blocks
            studyData.timeBlocks.forEach(block => {
                if (block.completed && block.subject && block.hours) {
                    if (!subjectTime[block.subject]) {
                        subjectTime[block.subject] = 0;
                    }
                    subjectTime[block.subject] += block.hours;
                }
            });

            // 2. Add estimated time from timer (distribute evenly if multiple subjects active)
            const timerHours = studyData.timer.seconds / 3600;
            const activeSubjects = studyData.subjects.filter(s => {
                const progress = (s.completed / s.total) * 100;
                return progress > 0 && progress < 100;
            });

            if (activeSubjects.length > 0 && timerHours > 0) {
                const hoursPerSubject = timerHours / activeSubjects.length;
                activeSubjects.forEach(subject => {
                    if (!subjectTime[subject.name]) {
                        subjectTime[subject.name] = 0;
                    }
                    subjectTime[subject.name] += hoursPerSubject;
                });
            }

            // 3. Add estimated time from progress (rough estimate: 0.5h per 10 problems completed)
            studyData.subjects.forEach(subject => {
                if (subject.completed > 0 && subjectTime[subject.name] === 0) {
                    // Estimate based on completed problems
                    subjectTime[subject.name] = (subject.completed / 10) * 0.5;
                }
            });

            // Sort by time spent (descending)
            const sortedSubjects = Object.entries(subjectTime)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8); // Show top 8

            if (sortedSubjects.length === 0 || sortedSubjects.every(([_, time]) => time === 0)) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">ÌïôÏäµ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞ÄÌïòÎ©¥ Í≥ºÎ™©Î≥Ñ ÏãúÍ∞ÑÏù¥ ÌëúÏãúÎê©ÎãàÎã§</div>';
                return;
            }

            const maxTime = Math.max(...sortedSubjects.map(([_, time]) => time), 1);

            sortedSubjects.forEach(([subjectName, timeSpent]) => {
                const hours = Math.round(timeSpent * 10) / 10; // Round to 1 decimal
                const height = (timeSpent / maxTime) * 100;

                const barItem = document.createElement('div');
                barItem.className = 'bar-item';

                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = height + '%';
                bar.style.background = 'linear-gradient(to top, var(--accent-color), var(--success-color))';

                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = hours + 'h';

                bar.appendChild(barValue);

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = subjectName.replace(' (2Ï∞®)', '').substring(0, 8);

                barItem.appendChild(bar);
                barItem.appendChild(label);
                container.appendChild(barItem);
            });
        }

        
        function renderMockScoreChart() {
            const container = document.getElementById('mock-score-chart');
            container.innerHTML = '';

            if (!studyData.mockScores || studyData.mockScores.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 40px;">Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàòÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî</div>';
                return;
            }

            // Show most recent scores (up to 10)
            const recentScores = studyData.mockScores.slice(-10);
            const maxScore = 100;

            recentScores.forEach((score, idx) => {
                const height = (score.score / maxScore) * 100;

                const barItem = document.createElement('div');
                barItem.className = 'bar-item';

                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = height + '%';

                // Color based on pass/fail (60% passing grade)
                if (score.score >= 60) {
                    bar.style.background = 'linear-gradient(to top, var(--success-color), #34D399)';
                } else {
                    bar.style.background = 'linear-gradient(to top, var(--danger-color), #F87171)';
                }

                // Add transition for animation
                bar.style.transition = 'height 0.5s ease ' + (idx * 0.05) + 's';

                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = score.score;

                bar.appendChild(barValue);

                const label = document.createElement('div');
                label.className = 'bar-label';
                // Show date in MM/DD format
                const dateStr = score.date.substring(5); // Remove year
                label.textContent = dateStr;

                barItem.appendChild(bar);
                barItem.appendChild(label);
                container.appendChild(barItem);
            });
        }

        // ===== ÏÉàÎ°úÏö¥ Í∏∞Îä•: ÏïΩÏ†ê Í≥ºÎ™© ÏãùÎ≥Ñ =====
                function renderWeakSubjects() {
            const container = document.getElementById('weak-subjects-container');
            container.innerHTML = '';

            // Identify weak subjects based on REAL criteria
            const weakSubjects = [];

            studyData.subjects.forEach(subject => {
                const progress = (subject.completed / subject.total) * 100;
                const rotations = subject.rotations.filter(r => r).length;

                // Find recent mock exam performance for this subject (if available)
                let recentMockPerformance = null;
                const subjectBase = subject.name.replace(' (2Ï∞®)', '');
                const relevantScores = studyData.mockScores.filter(s =>
                    s.subject && s.subject.includes(subjectBase)
                ).slice(-3);

                if (relevantScores.length > 0) {
                    const avgMockScore = relevantScores.reduce((sum, s) => sum + s.score, 0) / relevantScores.length;
                    recentMockPerformance = avgMockScore;
                }

                // Priority calculation
                let priority = 0;
                let reasons = [];

                if (progress < 30) {
                    priority += 10;
                    reasons.push('ÏßÑÎèÑÏú® Îß§Ïö∞ ÎÇÆÏùå');
                } else if (progress < 50) {
                    priority += 7;
                    reasons.push('ÏßÑÎèÑÏú® ÎÇÆÏùå');
                }

                if (rotations < 1) {
                    priority += 8;
                    reasons.push('ÌöåÎèÖ ÏóÜÏùå');
                } else if (rotations < 2) {
                    priority += 5;
                    reasons.push('ÌöåÎèÖ Î∂ÄÏ°±');
                }

                if (recentMockPerformance !== null && recentMockPerformance < 60) {
                    priority += 6;
                    reasons.push(`Î™®ÏùòÍ≥†ÏÇ¨ ${recentMockPerformance.toFixed(0)}Ï†ê`);
                }

                if (priority > 5) {
                    weakSubjects.push({
                        subject,
                        progress,
                        rotations,
                        priority,
                        reasons,
                        mockScore: recentMockPerformance
                    });
                }
            });

            // Sort by priority (highest first)
            weakSubjects.sort((a, b) => b.priority - a.priority);

            if (weakSubjects.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--success-color); font-weight: 500;">Î™®Îì† Í≥ºÎ™©Ïù¥ ÏàúÏ°∞Î°≠Í≤å ÏßÑÌñâ Ï§ëÏûÖÎãàÎã§! üëç</div>';
                return;
            }

            // Show top 5 weak subjects
            weakSubjects.slice(0, 5).forEach((item, idx) => {
                const { subject, progress, rotations, priority, reasons, mockScore } = item;

                const div = document.createElement('div');
                div.className = 'weak-subject';

                let badgeText, badgeColor;
                if (priority >= 15) {
                    badgeText = 'ÏµúÏö∞ÏÑ†';
                    badgeColor = 'var(--danger-color)';
                } else if (priority >= 10) {
                    badgeText = 'Ïö∞ÏÑ†';
                    badgeColor = 'var(--warning-color)';
                } else {
                    badgeText = 'Ï£ºÏùò';
                    badgeColor = '#FBBF24';
                }

                const recommendation = getSubjectRecommendation(subject, progress, rotations, mockScore);

                div.innerHTML = `
                    <div class="weak-subject-header">
                        <div class="weak-subject-name">${subject.name}</div>
                        <div class="priority-badge" style="background: ${badgeColor}">${badgeText}</div>
                    </div>
                    <div class="weak-subject-info">
                        ÏßÑÎèÑÏú®: ${Math.round(progress)}% | ÌöåÎèÖ: ${rotations}Ìöå
                        ${mockScore !== null ? ` | ÏµúÍ∑º Î™®ÏùòÍ≥†ÏÇ¨: ${mockScore.toFixed(0)}Ï†ê` : ''}
                    </div>
                    <div class="recommendation">
                        ${recommendation}
                    </div>
                `;

                container.appendChild(div);
            });
        }

        
        function getSubjectRecommendation(subject, progress, rotations, mockScore) {
            if (progress < 20 && rotations < 1) {
                return `üö® Îß§Ïùº ${subject.name} ÏµúÏÜå 1ÏãúÍ∞Ñ Ïù¥ÏÉÅ Ìà¨Ïûê ÌïÑÏàò! Í∏∞Ï¥àÎ∂ÄÌÑ∞ Ï∞®Í∑ºÏ∞®Í∑º ÏãúÏûëÌïòÏÑ∏Ïöî.`;
            } else if (progress < 30) {
                return `‚ö†Ô∏è ÏßÑÎèÑÎ•º Îπ†Î•¥Í≤å Ïò¨Î¶¨Îäî Í≤ÉÏù¥ Í∏âÏÑ†Î¨¥ÏûÖÎãàÎã§. ÌïòÎ£® 1-2ÏãúÍ∞Ñ ÏßëÏ§ë ÌïôÏäµÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.`;
            } else if (progress < 50) {
                return `üìö Îß§Ïùº Íæ∏Ï§ÄÌûà ÏßÑÎèÑÎ•º ÎÇòÍ∞ÄÏÑ∏Ïöî. Î™©Ìëú: Ï£ºÎãπ 10-15% ÏßÑÎèÑÏú® ÏÉÅÏäπ`;
            } else if (rotations < 2) {
                return `üîÑ ÏßÑÎèÑÎäî ÏñëÌò∏ÌïòÏßÄÎßå ÌöåÎèÖÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. Î≥µÏäµ ÏãúÍ∞ÑÏùÑ ÎäòÎ†§Ï£ºÏÑ∏Ïöî.`;
            } else if (mockScore !== null && mockScore < 60) {
                return `üìù Î™®ÏùòÍ≥†ÏÇ¨ ÏÑ±Ï†ÅÏù¥ ÎÇÆÏäµÎãàÎã§. Ï∑®ÏïΩ Îã®ÏõêÏùÑ ÏßëÏ§ë Î≥µÏäµÌïòÏÑ∏Ïöî.`;
            } else {
                return `‚úÖ ÌòÑÏû¨ ÏßÑÎèÑÎ•º Ïú†ÏßÄÌïòÎ©¥ÏÑú Íæ∏Ï§ÄÌûà ÌöåÎèÖÏùÑ ÏßÑÌñâÌïòÏÑ∏Ïöî.`;
            }
        }

        // ===== ÏÉàÎ°úÏö¥ Í∏∞Îä•: Î™©Ìëú ÏÑ§Ï†ï & ÎßàÏùºÏä§ÌÜ§ =====
        function renderGoals() {
            const container = document.getElementById('goals-container');
            container.innerHTML = '';

            if (!studyData.goals) studyData.goals = [];

            if (studyData.goals.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Î™©ÌëúÎ•º ÏÑ§Ï†ïÌïòÏó¨ ÌïôÏäµ ÎèôÍ∏∞Î•º ÎÜíÏù¥ÏÑ∏Ïöî! üéØ</div>';
                return;
            }

            studyData.goals.forEach(goal => {
                const today = new Date();
                const goalDate = new Date(goal.date);
                const isAchieved = goal.progress >= 100;
                const isOverdue = goalDate < today && !isAchieved;

                const daysLeft = Math.ceil((goalDate - today) / (1000 * 60 * 60 * 24));
                const daysText = isOverdue ? `${Math.abs(daysLeft)}Ïùº Í≤ΩÍ≥º` : `${daysLeft}Ïùº ÎÇ®Ïùå`;

                const div = document.createElement('div');
                div.className = `goal-item ${isAchieved ? 'achieved' : ''}`;

                div.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${isAchieved ? '‚úì ' : ''}${goal.title}</div>
                        <div class="goal-date" style="color: ${isOverdue ? 'var(--danger)' : 'var(--text-secondary)'}">${daysText}</div>
                        <div class="goal-actions">
                            <button class="goal-btn" onclick="editGoal(${goal.id})">‚úèÔ∏è</button>
                            <button class="goal-btn" onclick="deleteGoal(${goal.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="goal-progress-bar">
                        <div class="goal-progress-fill" style="width: ${Math.min(goal.progress, 100)}%"></div>
                    </div>
                    <div style="text-align: right; font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                        ${goal.progress}% ÏôÑÎ£å
                    </div>
                `;

                container.appendChild(div);
            });
        }

        let editingGoalId = null;

        function addGoal() {
            document.getElementById('goalTitle').value = '';
            document.getElementById('goalDate').value = '';
            document.getElementById('goalProgress').value = '0';
            document.getElementById('goalModal').classList.add('show');
        }

        function saveGoal() {
            const title = document.getElementById('goalTitle').value;
            const date = document.getElementById('goalDate').value;
            const progress = parseInt(document.getElementById('goalProgress').value) || 0;

            if (title && date) {
                if (!studyData.goals) studyData.goals = [];

                if (editingGoalId) {
                    // ÏàòÏ†ï Î™®Îìú
                    const goal = studyData.goals.find(g => g.id === editingGoalId);
                    if (goal) {
                        goal.title = title;
                        goal.date = date;
                        goal.progress = Math.min(progress, 100);
                        showToast('Î™©ÌëúÍ∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§');
                    }
                    editingGoalId = null;
                } else {
                    // Ï∂îÍ∞Ä Î™®Îìú
                    studyData.goals.push({
                        id: Date.now(),
                        title,
                        date,
                        progress: Math.min(progress, 100),
                        createdAt: new Date().toISOString()
                    });
                    showToast('Î™©ÌëúÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§ üéØ');
                }

                saveData();
                renderGoals();
                closeModal('goalModal');

                // Reset form and title
                document.getElementById('goalTitle').value = '';
                document.getElementById('goalDate').value = '';
                document.getElementById('goalProgress').value = '0';
                document.querySelector('#goalModal .modal-title').textContent = 'ÌïôÏäµ Î™©Ìëú Ï∂îÍ∞Ä';
            } else {
                showToast('Î™©Ìëú ÎÇ¥Ïö©Í≥º ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
            }
        }

        function editGoal(id) {
            const goal = studyData.goals.find(g => g.id === id);
            if (goal) {
                editingGoalId = id;
                document.getElementById('goalTitle').value = goal.title;
                document.getElementById('goalDate').value = goal.date || goal.deadline || ''; // FIXED: deadline ‚Üí date (v3.2.2)
                document.getElementById('goalProgress').value = goal.progress;
                document.querySelector('#goalModal .modal-title').textContent = 'ÌïôÏäµ Î™©Ìëú ÏàòÏ†ï';
                document.getElementById('goalModal').classList.add('show');
            }
        }

        function deleteGoal(id) {
            showConfirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', () => {
                studyData.goals = studyData.goals.filter(g => g.id !== id);
                saveData();
                renderGoals();
                showToast('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§');
            });
        }

        // ===== ÏÉàÎ°úÏö¥ Í∏∞Îä•: Ïä§ÎßàÌä∏ ÌïôÏäµ Ï∂îÏ≤ú =====
        function renderSmartRecommendations() {
            const container = document.getElementById('smart-recommendations');
            container.innerHTML = '';

            const recommendations = generateRecommendations();

            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                container.appendChild(li);
            });
        }

        function generateRecommendations() {
            const recs = [];
            const today = new Date();
            const examDate = new Date('2026-08-29');
            const daysLeft = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));

            // ÏãúÌóòÏùº Í∏∞Î∞ò Ï∂îÏ≤ú
            if (daysLeft < 30) {
                recs.push('ÏãúÌóòÏù¥ Ìïú Îã¨ÎèÑ ÎÇ®ÏßÄ ÏïäÏïòÏäµÎãàÎã§! Í∏∞Ï∂úÎ¨∏Ï†ú ÏµúÏ¢Ö Ï†ïÎ¶¨Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.');
            } else if (daysLeft < 90) {
                recs.push('Î™®ÏùòÍ≥†ÏÇ¨Î•º Ï£º 2-3Ìöå Ïã§ÏãúÌïòÏó¨ Ïã§Ï†Ñ Í∞êÍ∞ÅÏùÑ ÏùµÌûàÏÑ∏Ïöî.');
            } else if (daysLeft < 180) {
                recs.push('Ï†ÑÏ≤¥ ÌöåÎèÖ ÎßàÎ¨¥Î¶¨ÏôÄ Ï∑®ÏïΩÏ†ê Î≥¥ÏôÑÏóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.');
            }

            // ÏïΩÏ†ê Í≥ºÎ™© Í∏∞Î∞ò Ï∂îÏ≤ú
            const weakSubjects = studyData.subjects.filter(s => {
                const progress = (s.completed / s.total) * 100;
                return progress < 50;
            });

            if (weakSubjects.length > 0) {
                recs.push(`${weakSubjects[0].name} Í≥ºÎ™©Ïùò ÏßÑÎèÑÍ∞Ä Î∂ÄÏ°±Ìï©ÎãàÎã§. Ïò§ÎäòÏùÄ Ïù¥ Í≥ºÎ™©Ïóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.`);
            }

            // Ïä§Ìä∏Î¶≠ Í∏∞Î∞ò Ï∂îÏ≤ú
            if (studyData.streak.current >= 7) {
                recs.push(`ÎåÄÎã®Ìï©ÎãàÎã§! ${studyData.streak.current}Ïùº Ïó∞ÏÜç ÌïôÏäµ Ï§ëÏûÖÎãàÎã§. Ïù¥ ÌéòÏù¥Ïä§Î•º Ïú†ÏßÄÌïòÏÑ∏Ïöî!`);
            } else if (studyData.streak.current === 0) {
                recs.push('Ïò§ÎäòÎ∂ÄÌÑ∞ Îã§Ïãú ÏãúÏûëÌïòÏÑ∏Ïöî! Íæ∏Ï§ÄÌï®Ïù¥ Ìï©Í≤©Ïùò ÎπÑÍ≤∞ÏûÖÎãàÎã§.');
            }

            // Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Í∏∞Î∞ò Ï∂îÏ≤ú
            if (studyData.mockScores.length > 0) {
                const recentScores = studyData.mockScores.slice(-3);
                const avgRecent = recentScores.reduce((sum, s) => sum + s.score, 0) / recentScores.length;

                if (avgRecent < 55) {
                    recs.push('Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàòÍ∞Ä ÎÇÆÏäµÎãàÎã§. Í∏∞Î≥∏ Í∞úÎÖê Î≥µÏäµÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.');
                } else if (avgRecent >= 60) {
                    recs.push('Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàòÍ∞Ä Ìï©Í≤©Í∂åÏûÖÎãàÎã§! Ïã§Ïàò Î∞©ÏßÄÏóê ÏßëÏ§ëÌïòÏÑ∏Ïöî.');
                }
            }

            // ÏùºÎ∞ò Ï∂îÏ≤ú
            if (recs.length < 3) {
                recs.push('ÌïòÎ£® 4-5ÏãúÍ∞Ñ Ïù¥ÏÉÅ ÌïôÏäµÏùÑ Î™©ÌëúÎ°ú ÌïòÏÑ∏Ïöî.');
                recs.push('Îß§Ïùº Í∏∞Ï∂úÎ¨∏Ï†ú 50Î¨∏Ï†ú Ïù¥ÏÉÅÏùÑ ÌíÄÏù¥ÌïòÎäî Í≤ÉÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§.');
            }

            return recs.slice(0, 5);
        }

        // ===== Ïú†Ìã∏Î¶¨Ìã∞: Ï†ëÏùÑ Ïàò ÏûàÎäî ÏÑπÏÖò =====
        function toggleCollapse(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('-section', '-icon'));

            if (!section || !icon) return; // ÏöîÏÜåÍ∞Ä ÏóÜÏúºÎ©¥ Î¶¨ÌÑ¥

            // active ÌÅ¥ÎûòÏä§Î•º ÌÜ†Í∏ÄÌïòÏó¨ ÌëúÏãú/Ïà®ÍπÄ
            section.classList.toggle('active');
            icon.classList.toggle('collapsed');
        }

        // ===== Îç∞Ïù¥ÌÑ∞ Import/Export Í∏∞Îä• =====

        /**
         * Î™®Îì† ÌïôÏäµ Îç∞Ïù¥ÌÑ∞Î•º JSON ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞
         */
        function exportData() {
            try {
                // ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ (ÎØºÍ∞êÌïú Ï†ïÎ≥¥ Ï†úÏô∏, Î∂àÌïÑÏöîÌïú ÌïÑÎìú Ï†úÍ±∞)
                const exportData = {
                    version: '3.2.0',
                    exportDate: new Date().toISOString(),
                    data: {
                        examType: studyData.examType,
                        examDates: studyData.examDates,
                        subjects1st: studyData.subjects1st,
                        subjects2nd: studyData.subjects2nd,
                        timeBlocks: studyData.timeBlocks,
                        mockScores: studyData.mockScores,
                        weeklyHours: studyData.weeklyHours,
                        notes: studyData.notes,
                        streak: studyData.streak,
                        goals: studyData.goals,
                        subjectTimeSpent: studyData.subjectTimeSpent,
                        studyHistory: studyData.studyHistory
                    }
                };

                // JSONÏúºÎ°ú Î≥ÄÌôò
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                // ÌååÏùº Îã§Ïö¥Î°úÎìú
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;

                // ÌååÏùºÎ™Ö: study-data-YYYY-MM-DD.json
                const today = new Date().toISOString().split('T')[0];
                link.download = `study-data-${today}.json`;

                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Î©îÎ™®Î¶¨ Ï†ïÎ¶¨
                URL.revokeObjectURL(url);

                showToast('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§', 'success');
                console.log('Data exported successfully');

            } catch (error) {
                console.error('Export error:', error);
                showToast('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
            }
        }

        /**
         * JSON ÌååÏùºÏóêÏÑú ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
         */
        let pendingImportData = null;

        function importData(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ÌååÏùº ÌôïÏû•Ïûê Í≤ÄÏ¶ù
            if (!file.name.endsWith('.json')) {
                showToast('JSON ÌååÏùºÎßå Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§', 'error');
                event.target.value = ''; // ÌååÏùº ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    // JSON ÌååÏã±
                    const importedData = JSON.parse(e.target.result);

                    // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Í≤ÄÏ¶ù
                    if (!validateImportData(importedData)) {
                        showToast('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§', 'error');
                        event.target.value = '';
                        return;
                    }

                    // ÏûÑÏãúÎ°ú Ï†ÄÏû•ÌïòÍ≥† ÌôïÏù∏ Î™®Îã¨ ÌëúÏãú
                    pendingImportData = importedData.data;
                    showImportPreview(importedData);

                } catch (error) {
                    console.error('Import parsing error:', error);
                    showToast('ÌååÏùºÏùÑ ÏùΩÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Ïò¨Î∞îÎ•∏ JSON ÌååÏùºÏù∏ÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.', 'error');
                    event.target.value = '';
                }
            };

            reader.onerror = function() {
                showToast('ÌååÏùº ÏùΩÍ∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        /**
         * Í∞ÄÏ†∏Ïò® Îç∞Ïù¥ÌÑ∞Ïùò Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù
         */
        function validateImportData(data) {
            try {
                // ÌïÑÏàò Íµ¨Ï°∞ Í≤ÄÏ¶ù
                if (!data || typeof data !== 'object') {
                    console.error('Invalid data structure: not an object');
                    return false;
                }

                if (!data.data || typeof data.data !== 'object') {
                    console.error('Invalid data structure: missing data property');
                    return false;
                }

                const d = data.data;

                // ÌïÑÏàò Î∞∞Ïó¥ ÌïÑÎìú Í≤ÄÏ¶ù
                const requiredArrays = ['subjects1st', 'subjects2nd'];
                for (const field of requiredArrays) {
                    if (!Array.isArray(d[field])) {
                        console.error(`Invalid data structure: ${field} is not an array`);
                        return false;
                    }
                }

                // ÏÑ†ÌÉùÏ†Å Î∞∞Ïó¥ ÌïÑÎìú Í≤ÄÏ¶ù (ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥Î°ú Ï¥àÍ∏∞Ìôî)
                const optionalArrays = ['timeBlocks', 'mockScores', 'goals', 'studyHistory'];
                for (const field of optionalArrays) {
                    if (d[field] !== undefined && !Array.isArray(d[field])) {
                        console.error(`Invalid data structure: ${field} is not an array`);
                        return false;
                    }
                }

                // Í≥ºÎ™© Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù
                if (d.subjects1st.length === 0) {
                    console.error('Invalid data: subjects1st is empty');
                    return false;
                }

                // Í∏∞Î≥∏ Íµ¨Ï°∞Í∞Ä Ïò¨Î∞îÎ•∏ÏßÄ ÌôïÏù∏
                const sample = d.subjects1st[0];
                if (!sample.name || typeof sample.total !== 'number' || typeof sample.completed !== 'number') {
                    console.error('Invalid subject structure');
                    return false;
                }

                console.log('Data validation passed');
                return true;

            } catch (error) {
                console.error('Validation error:', error);
                return false;
            }
        }

        /**
         * Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
         */
        function showImportPreview(importedData) {
            const previewContainer = document.getElementById('importPreviewContainer');
            const data = importedData.data;

            // ÎØ∏Î¶¨Î≥¥Í∏∞ HTML ÏÉùÏÑ±
            let previewHTML = '<h4 style="margin-bottom: 15px; color: var(--primary-dark);">Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞ ÎØ∏Î¶¨Î≥¥Í∏∞</h4>';

            // ÌååÏùº Ï†ïÎ≥¥
            if (importedData.version) {
                previewHTML += `
                    <div class="import-preview-item">
                        <span class="import-preview-label">ÌååÏùº Î≤ÑÏ†Ñ</span>
                        <span class="import-preview-value">${importedData.version}</span>
                    </div>
                `;
            }

            if (importedData.exportDate) {
                const exportDate = new Date(importedData.exportDate);
                previewHTML += `
                    <div class="import-preview-item">
                        <span class="import-preview-label">ÎÇ¥Î≥¥ÎÇ∏ ÎÇ†Ïßú</span>
                        <span class="import-preview-value">${exportDate.toLocaleDateString('ko-KR')}</span>
                    </div>
                `;
            }

            // Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ
            previewHTML += `
                <div class="import-preview-item">
                    <span class="import-preview-label">1Ï∞® Í≥ºÎ™© Ïàò</span>
                    <span class="import-preview-value">${data.subjects1st?.length || 0}Í∞ú</span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">2Ï∞® Í≥ºÎ™© Ïàò</span>
                    <span class="import-preview-value">${data.subjects2nd?.length || 0}Í∞ú</span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">ÌïôÏäµ Î∏îÎ°ù Ïàò</span>
                    <span class="import-preview-value">${data.timeBlocks?.length || 0}Í∞ú</span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">Î™®ÏùòÍ≥†ÏÇ¨ Í∏∞Î°ù</span>
                    <span class="import-preview-value">${data.mockScores?.length || 0}Í∞ú</span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">ÌïôÏäµ Î™©Ìëú</span>
                    <span class="import-preview-value">${data.goals?.length || 0}Í∞ú</span>
                </div>
                <div class="import-preview-item">
                    <span class="import-preview-label">ÌïôÏäµ Ïä§Ìä∏Î¶≠</span>
                    <span class="import-preview-value">${data.streak?.current || 0}Ïùº Ïó∞ÏÜç</span>
                </div>
            `;

            previewContainer.innerHTML = previewHTML;

            // ÌôïÏù∏ Î≤ÑÌäºÏóê Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ ÏÑ§Ï†ï
            const confirmBtn = document.getElementById('confirmImportBtn');
            confirmBtn.onclick = function() {
                confirmImport();
            };

            // Î™®Îã¨ ÌëúÏãú
            document.getElementById('importConfirmModal').classList.add('show');
        }

        /**
         * Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÏµúÏ¢Ö ÌôïÏù∏ Î∞è Ïã§Ìñâ
         */
        function confirmImport() {
            if (!pendingImportData) {
                showToast('Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', 'error');
                closeModal('importConfirmModal');
                return;
            }

            try {
                // ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Î•º ÏûÑÏãúÎ°ú Î∞±ÏóÖ (ÌòπÏãú Î™®Î•º ÏÉÅÌô© ÎåÄÎπÑ - ÏÑ∏ÏÖò Ïä§ÌÜ†Î¶¨ÏßÄÏóê)
                try {
                    sessionStorage.setItem('studyDataBackup', JSON.stringify(studyData));
                } catch (backupError) {
                    console.warn('Failed to create session backup:', backupError);
                }

                // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const imported = pendingImportData;

                // Í∏∞Î≥∏Í∞íÍ≥º Î≥ëÌï© (ÎàÑÎùΩÎêú ÌïÑÎìú Ï≤òÎ¶¨)
                studyData = {
                    examType: imported.examType || '1Ï∞®',
                    examDates: imported.examDates || { '1Ï∞®': null, '2Ï∞®': null },
                    timer: {
                        seconds: 0,
                        isRunning: false,
                        interval: null
                    },
                    pomodoro: {
                        seconds: 1500,
                        isRunning: false,
                        interval: null,
                        mode: 'work',
                        completedSessions: 0
                    },
                    subjects1st: imported.subjects1st || [],
                    subjects2nd: imported.subjects2nd || [],
                    subjects: [],
                    timeBlocks: imported.timeBlocks || [],
                    mockScores: imported.mockScores || [],
                    weeklyHours: imported.weeklyHours || {},
                    notes: imported.notes || {},
                    streak: imported.streak || {
                        current: 0,
                        longest: 0,
                        lastStudyDate: null,
                        totalDays: 0
                    },
                    goals: imported.goals || [],
                    subjectTimeSpent: imported.subjectTimeSpent || {},
                    studyHistory: imported.studyHistory || []
                };

                // Í≥ºÎ™© ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
                updateSubjectsByExamType();

                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                saveData();

                // Î™®Îã¨ Îã´Í∏∞
                closeModal('importConfirmModal');

                // ÏÑ±Í≥µ ÌÜ†Ïä§Ìä∏
                showToast('Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§! ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï©ÎãàÎã§.', 'success');

                // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ® (Î™®Îì† UI ÏóÖÎç∞Ïù¥Ìä∏)
                setTimeout(() => {
                    location.reload();
                }, 1500);

                // ÏûÑÏãú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
                pendingImportData = null;

                console.log('Data imported successfully');

            } catch (error) {
                console.error('Import error:', error);
                showToast('Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', 'error');

                // Î∞±ÏóÖ Î≥µÍµ¨ ÏãúÎèÑ
                try {
                    const backup = sessionStorage.getItem('studyDataBackup');
                    if (backup) {
                        studyData = JSON.parse(backup);
                        saveData();
                        showToast('Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞Î°ú Î≥µÍµ¨ÎêòÏóàÏäµÎãàÎã§', 'info');
                    }
                } catch (restoreError) {
                    console.error('Failed to restore backup:', restoreError);
                }
            } finally {
                // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
                const fileInput = document.getElementById('importFileInput');
                if (fileInput) {
                    fileInput.value = '';
                }
            }
        }

        // ===== DARK MODE FUNCTIONALITY =====
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Update icon
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }

            showToast(`${newTheme === 'dark' ? 'Îã§ÌÅ¨' : 'ÎùºÏù¥Ìä∏'} Î™®ÎìúÎ°ú Ï†ÑÌôòÎêòÏóàÏäµÎãàÎã§`, 'info');
        }

        // ===== ÌÜµÌï© Ï¥àÍ∏∞Ìôî ÏãúÏä§ÌÖú =====
        // CRITICAL FIX v3.2.3: DOMÏù¥ ÏôÑÏ†ÑÌûà Î°úÎìúÎêú ÌõÑ Î™®Îì† Ï¥àÍ∏∞Ìôî ÏûëÏóÖ ÏàòÌñâ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Loaded - Starting initialization...');

            // 1. ÌÖåÎßà Î°úÎìú (Í∞ÄÏû• Î®ºÏ†Ä - ÍπúÎπ°ÏûÑ Î∞©ÏßÄ)
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const themeIcon = document.getElementById('theme-icon');
            if (themeIcon) {
                themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }

            // 2. Î©îÏù∏ Ï¥àÍ∏∞Ìôî Ìï®Ïàò Ïã§Ìñâ
            init();
            console.log('‚úÖ Main init() completed');

            // 3. Ìï®Ïàò ÎûòÌïë ÏÑ§Ï†ï (init Ïù¥ÌõÑÏóê Ïã§ÌñâÌïòÏó¨ Ìï®Ïàò Ï†ïÏùò Î≥¥Ïû•)
            const originalStartTimer = startTimer;
            startTimer = function() {
                originalStartTimer();
                updateStreak();
                renderAnalytics();
            };

            const originalToggleTimeBlock = toggleTimeBlock;
            toggleTimeBlock = function(id) {
                originalToggleTimeBlock(id);
                updateStreak();
                renderAnalytics();
            };
            console.log('‚úÖ Function wrappers configured');

            // 4. Ï∂îÍ∞Ä UI ÏóÖÎç∞Ïù¥Ìä∏ (ÏïΩÍ∞ÑÏùò ÎîúÎ†àÏù¥Î°ú Î†åÎçîÎßÅ ÏµúÏ†ÅÌôî)
            setTimeout(() => {
                updateFocusHero();
                updateJourneyVisualization();

                // ÎßàÏùºÏä§ÌÜ§ Ï≤¥ÌÅ¨
                const totalHours = calculateTotalHours();
                checkMilestones(totalHours);

                console.log('‚úÖ Secondary UI updates completed');
            }, 100);  // 500ms ‚Üí 100msÎ°ú Îã®Ï∂ïÌïòÏó¨ UX Í∞úÏÑ†

            // 5. Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
            // Close FAB menu when clicking outside
            document.addEventListener('click', function(e) {
                const fab = document.getElementById('fab');
                const menu = document.getElementById('fab-menu');

                if (menu && fab && menu.classList.contains('active')) {
                    if (!fab.contains(e.target) && !menu.contains(e.target)) {
                        toggleFABMenu();
                    }
                }
            });

            // Close achievement modal when clicking outside
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('achievement-modal');

                if (modal && modal.classList.contains('show')) {
                    if (e.target === modal) {
                        closeAchievement();
                    }
                }
            });

            // Close regular modals when clicking outside
            document.addEventListener('click', function(e) {
                // Get all modals with 'show' class
                const modals = document.querySelectorAll('.modal.show');

                modals.forEach(modal => {
                    // Check if click is on the modal backdrop (not modal-content)
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });

            console.log('‚úÖ Event listeners configured');
        });


    

        // ===== SECOND SCRIPT BLOCK MERGED HERE =====

        // ===== V3.0.0: NEW HUMAN-CENTERED UX FEATURES =====

        /**
         * Toggle FAB Speed Dial Menu
         */
        function toggleFABMenu() {
            const menu = document.getElementById('fab-menu');
            const fab = document.getElementById('fab');
            const isActive = menu.classList.contains('active');

            if (isActive) {
                menu.classList.remove('active');
                fab.querySelector('.fab-icon').textContent = '+';
            } else {
                menu.classList.add('active');
                fab.querySelector('.fab-icon').textContent = '√ó';
            }
        }

        /**
         * Quick Log Study - Simplified quick logging interface
         */
        function quickLogStudy() {
            toggleFABMenu();

            // Show simplified inline form or modal for quick logging
            const subject = prompt('Í≥ºÎ™©Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (!subject) return;

            const hours = parseFloat(prompt('ÌïôÏäµ ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏãúÍ∞Ñ):'));
            if (!hours || isNaN(hours)) return;

            // Create time block
            const timeBlock = {
                id: Date.now(),
                time: new Date().toISOString().split('T')[0],
                subject: subject,
                hours: hours,
                completed: true
            };

            studyData.timeBlocks.push(timeBlock);

            // Update subject time tracking
            if (!studyData.subjectTimeSpent[subject]) {
                studyData.subjectTimeSpent[subject] = 0;
            }
            studyData.subjectTimeSpent[subject] += hours;

            saveData();
            renderTimeBlocks();
            renderAnalytics();
            updateJourneyVisualization();
            updateFocusHero();

            // Check for milestones
            const totalHours = calculateTotalHours();
            checkMilestones(totalHours);

            showToast(`${subject} ${hours}ÏãúÍ∞Ñ ÌïôÏäµ Í∏∞Î°ù ÏôÑÎ£å!`, 'success');
        }

        /**
         * Quick Start Study from Hero Section
         */
        function quickStartStudy() {
            // Find first incomplete time block or start timer
            const incompleteBlock = studyData.timeBlocks.find(block => !block.completed);

            if (incompleteBlock) {
                showToast(`${incompleteBlock.subject} ÌïôÏäµÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!`, 'info');
                // Scroll to time blocks section
                document.querySelector('.time-blocks')?.scrollIntoView({ behavior: 'smooth' });
            } else {
                // Start timer if no incomplete blocks
                if (!studyData.timer.isRunning) {
                    startTimer();
                    showToast('ÌïôÏäµ ÌÉÄÏù¥Î®∏Î•º ÏãúÏûëÌñàÏäµÎãàÎã§!', 'success');
                } else {
                    showToast('ÌÉÄÏù¥Î®∏Í∞Ä Ïù¥ÎØ∏ Ïã§Ìñâ Ï§ëÏûÖÎãàÎã§', 'info');
                }
            }
        }

        /**
         * Show Confetti Animation
         */
        function showConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#A8E6CF'];

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.cssText = `
                    position: fixed;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}%`;
                confetti.style.top = '-20px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.zIndex = '10000';
                confetti.style.animation = `confetti-fall ${Math.random() * 2 + 2}s linear forwards`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;

                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 4000);
            }
        }

        /**
         * Celebrate Milestone Achievement
         */
        function celebrateMilestone(milestone) {
            const modal = document.getElementById('achievement-modal');
            const badge = document.getElementById('achievement-badge');
            const title = document.getElementById('achievement-title');
            const message = document.getElementById('achievement-message');

            // Set milestone-specific content
            const milestoneData = {
                10: { badge: 'üéØ', title: 'Ï≤´ Í±∏Ïùå!', message: '10ÏãúÍ∞Ñ ÌïôÏäµ ÏôÑÎ£å! Ï¢ãÏùÄ ÏãúÏûëÏûÖÎãàÎã§!' },
                25: { badge: '‚≠ê', title: 'Íæ∏Ï§ÄÌï®Ïùò Ìûò!', message: '25ÏãúÍ∞Ñ ÎèåÌåå! ÏäµÍ¥ÄÏù¥ ÎßåÎì§Ïñ¥ÏßÄÍ≥† ÏûàÏäµÎãàÎã§!' },
                50: { badge: 'üî•', title: 'Ïó¥Ï†ï Î∞úÌôî!', message: '50ÏãúÍ∞Ñ Îã¨ÏÑ±! ÌïôÏäµ Î¶¨Îì¨ÏùÑ Ïûò ÌÉÄÍ≥† ÏûàÏñ¥Ïöî!' },
                100: { badge: 'üí™', title: 'Î∞± ÏãúÍ∞ÑÏùò Ìûò!', message: '100ÏãúÍ∞Ñ ÏôÑÎ£å! Ïù¥Ï†ú ÏßÑÏßú Ïã§Î†•Ïù¥ ÏåìÏù¥Í≥† ÏûàÏäµÎãàÎã§!' },
                200: { badge: 'üöÄ', title: 'Î°úÏºì ÏÜçÎèÑ!', message: '200ÏãúÍ∞Ñ ÎèåÌåå! Ìï©Í≤©Ïùò Í∏∏Ïù¥ Î≥¥ÏûÖÎãàÎã§!' },
                500: { badge: 'üëë', title: 'ÎßàÏä§ÌÑ∞ Î†àÎ≤®!', message: '500ÏãúÍ∞Ñ Îã¨ÏÑ±! ÎÜÄÎùºÏö¥ ÏÑ±Ï∑®ÏûÖÎãàÎã§!' },
                800: { badge: 'üèÜ', title: 'Ìï©Í≤©Í∂å ÏßÑÏûÖ!', message: '800ÏãúÍ∞Ñ ÏôÑÎ£å! Ìï©Í≤©Ïûê ÌèâÍ∑†ÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!' }
            };

            const data = milestoneData[milestone] || { badge: 'üéâ', title: 'Ï∂ïÌïòÌï©ÎãàÎã§!', message: `${milestone}ÏãúÍ∞ÑÏùÑ Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!` };

            badge.textContent = data.badge;
            title.textContent = data.title;
            message.textContent = data.message;

            // Show modal with animation
            modal.classList.add('show');

            // Show confetti
            showConfetti();

            // Play sound (if available)
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYHGGe67OihUBELTKXh8LJnHgU2jdXzzn0vBSaAzvLaizsIGGS56+mjTxELSKPh8LNoCQU7ldz03I8+CRtqvvDpqFYUDFCn4/G4aiEGPJPY8tGGOwccbsLu7qVSEQxPpuPxt28gBT+V3PPTjEIIHG7C7+6nVRQMUKfj8bltIwU+lNvy1I5CCA==');
                audio.volume = 0.3;
                audio.play().catch(() => {}); // Ignore errors if autoplay blocked
            } catch (e) {
                // Silent fail for audio
            }
        }

        /**
         * Check for Milestone Achievements
         */
        function checkMilestones(totalHours) {
            const milestones = [10, 25, 50, 100, 200, 500, 800];
            const previousHours = parseFloat(localStorage.getItem('lastTotalHours')) || 0;

            for (let milestone of milestones) {
                if (totalHours >= milestone && previousHours < milestone) {
                    celebrateMilestone(milestone);
                    break; // Show one milestone at a time
                }
            }

            localStorage.setItem('lastTotalHours', totalHours.toString());
        }

        /**
         * Update Focus Hero Section with Smart Suggestions
         */
        function updateFocusHero() {
            const hero = document.getElementById('focus-hero');
            if (!hero) return;

            const greeting = document.getElementById('focus-greeting');
            const dateEl = document.getElementById('focus-date');
            const totalHoursEl = document.getElementById('focus-total-hours');
            const streakEl = document.getElementById('focus-streak');
            const suggestionEl = document.getElementById('focus-suggestion');

            // Smart time-based greeting
            const hour = new Date().getHours();
            let greetingText = 'Good Evening, Student! üåô';
            let greetingEmoji = 'üåô';

            if (hour >= 5 && hour < 12) {
                greetingText = 'Good Morning, Student! üåÖ';
                greetingEmoji = 'üåÖ';
            } else if (hour >= 12 && hour < 18) {
                greetingText = 'Good Afternoon, Student! ‚òÄÔ∏è';
                greetingEmoji = '‚òÄÔ∏è';
            }

            if (greeting) greeting.textContent = greetingText;

            // Update date
            const today = new Date();
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dateStr = `Today: ${days[today.getDay()]} ${months[today.getMonth()]} ${today.getDate()}, ${today.getFullYear()}`;
            if (dateEl) dateEl.textContent = dateStr;

            // Update stats
            const totalHours = calculateTotalHours();
            if (totalHoursEl) totalHoursEl.textContent = `${totalHours.toFixed(1)}h`;

            if (streakEl) streakEl.textContent = `${studyData.streak?.current || 0} days`;

            // Smart suggestions based on data
            let suggestion = '';
            const subjects = studyData[`subjects${studyData.examType === '1Ï∞®' ? '1st' : '2nd'}`] || [];

            if (subjects.length === 0) {
                suggestion = 'Í≥ºÎ™©ÏùÑ Ï∂îÍ∞ÄÌïòÍ≥† ÌïôÏäµ Í≥ÑÌöçÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!';
            } else {
                // Find subject with lowest progress
                // FIXED: Calculate progress correctly (v3.2.2)
                const weakSubject = subjects.reduce((min, subject) => {
                    const minProgress = (min.completed / min.total) * 100;
                    const currentProgress = (subject.completed / subject.total) * 100;
                    return currentProgress < minProgress ? subject : min;
                }, subjects[0]);

                const weakProgress = (weakSubject.completed / weakSubject.total) * 100;
                if (weakSubject && weakProgress < 50) {
                    suggestion = `${weakSubject.name} ÏßëÏ§ë ÌïôÏäµÏùÑ Ï∂îÏ≤úÌï©ÎãàÎã§ (ÏßÑÎèÑ: ${weakProgress.toFixed(0)}%)`;
                } else if (studyData.mockScores && studyData.mockScores.length > 0) {
                    const lastScore = studyData.mockScores[studyData.mockScores.length - 1].score;
                    if (lastScore < 60) {
                        suggestion = 'Î™®ÏùòÍ≥†ÏÇ¨ Î≥µÏäµÍ≥º ÏïΩÏ†ê Î≥¥ÏôÑÏù¥ ÌïÑÏöîÌï©ÎãàÎã§';
                    } else {
                        suggestion = 'Ï¢ãÏùÄ ÌéòÏù¥Ïä§ÏûÖÎãàÎã§! Íæ∏Ï§ÄÌûà ÏßÑÌñâÌïòÏÑ∏Ïöî!';
                    }
                } else {
                    suggestion = 'Ïò§ÎäòÎèÑ ÌôîÏù¥ÌåÖ! Íæ∏Ï§ÄÌïú ÌïôÏäµÏù¥ Ìï©Í≤©Ïùò ÏßÄÎ¶ÑÍ∏∏ÏûÖÎãàÎã§!';
                }
            }

            if (suggestionEl) suggestionEl.textContent = suggestion;
        }

        /**
         * Update Journey Visualization
         */
        function updateJourneyVisualization() {
            const totalHours = calculateTotalHours();
            const goalHours = 800; // Target hours for passing
            const percentage = Math.min((totalHours / goalHours) * 100, 100);

            const progressBar = document.getElementById('journey-progress');
            const currentEl = document.getElementById('journey-current');
            const messageEl = document.getElementById('journey-message');

            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }

            if (currentEl) {
                currentEl.textContent = `Current: ${totalHours.toFixed(1)}h`;
            }

            if (messageEl) {
                let message = '';
                if (percentage < 10) {
                    message = 'üå± Just getting started! Every hour counts.';
                } else if (percentage < 25) {
                    message = 'üö∂ Building momentum! Keep going!';
                } else if (percentage < 50) {
                    message = 'üèÉ Making great progress! Stay consistent!';
                } else if (percentage < 75) {
                    message = 'üí™ More than halfway there! You\'re doing amazing!';
                } else if (percentage < 100) {
                    message = 'üî• Almost at the goal! Final push!';
                } else {
                    message = 'üèÜ Goal achieved! You\'re in the passing zone!';
                }
                messageEl.textContent = message;
            }
        }

        /**
         * Close Achievement Modal
         */
        function closeAchievement() {
            const modal = document.getElementById('achievement-modal');
            modal.classList.remove('show');
        }

        // ===== V3.0.0: INITIALIZATION =====

        // Override renderAnalytics to include journey and hero updates
        // NOTE: Ïù¥ ÏΩîÎìúÎäî DOMContentLoaded Ï†ÑÏóê Ïã§ÌñâÎêòÏñ¥ÎèÑ ÏïàÏ†Ñ (Ìï®ÏàòÎßå Ïû¨Ï†ïÏùò)
        const originalRenderAnalytics = renderAnalytics;
        renderAnalytics = function() {
            originalRenderAnalytics();
            updateJourneyVisualization();
            updateFocusHero();
        };

    </script>

    <!-- V3.0.0: Îπ†Î•∏ ÏûëÏóÖ Î≤ÑÌäº (FAB) -->
    <button class="fab" id="fab" onclick="toggleFABMenu()" title="Îπ†Î•∏ ÏûëÏóÖ">
        <span class="fab-icon">+</span>
    </button>

    <div class="fab-menu" id="fab-menu">
        <div class="fab-menu-item" onclick="quickLogStudy()">
            <div class="fab-menu-item-icon" style="background: #4ECDC4;">‚è±Ô∏è</div>
            <div class="fab-menu-item-label">Îπ†Î•∏ Í∏∞Î°ù</div>
        </div>
        <div class="fab-menu-item" onclick="toggleFABMenu(); addTimeBlock();">
            <div class="fab-menu-item-icon" style="background: #FFE66D;">üìö</div>
            <div class="fab-menu-item-label">ÌïôÏäµ Í≥ÑÌöç Ï∂îÍ∞Ä</div>
        </div>
        <div class="fab-menu-item" onclick="toggleFABMenu(); showScoreModal();">
            <div class="fab-menu-item-icon" style="background: #FF6B6B;">üìù</div>
            <div class="fab-menu-item-label">Î™®ÏùòÍ≥†ÏÇ¨ Ï†êÏàò Ï∂îÍ∞Ä</div>
        </div>
    </div>

    <!-- V3.0.0: ÏóÖÏ†Å Îã¨ÏÑ± Î™®Îã¨ -->
    <div class="achievement-modal" id="achievement-modal">
        <div class="achievement-badge" id="achievement-badge">üèÜ</div>
        <div class="achievement-title" id="achievement-title">ÏóÖÏ†Å Îã¨ÏÑ±!</div>
        <div class="achievement-message" id="achievement-message">ÏÉàÎ°úÏö¥ Ïù¥Ï†ïÌëúÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§!</div>
        <button class="achievement-close-btn" onclick="closeAchievement()">Î©ãÏ†∏Ïöî!</button>
    </div>

    </script>

</body>
</html>